# ì˜¤í”„ë¼ì¸ ë©”ëª¨ ì‘ì„± ë° ë™ê¸°í™” ì„¤ê³„

> **ëª©ì **: ë„¤íŠ¸ì›Œí¬ê°€ ì—†ëŠ” í™˜ê²½ì—ì„œ ë©”ëª¨ë¥¼ ì‘ì„±í•˜ê³ , ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìë™ìœ¼ë¡œ ì„œë²„ì— ë™ê¸°í™”í•˜ëŠ” ê¸°ëŠ¥ êµ¬í˜„  
> **ë¹„ê¸°ëŠ¥ í’ˆì§ˆ**: Fault Tolerance (ì¥ì•  í—ˆìš©)  
> **ì‹œë‚˜ë¦¬ì˜¤**: ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œ ë©”ëª¨ ì‘ì„± â†’ ë¡œì»¬ ì €ì¥ â†’ ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìë™ ë™ê¸°í™”
> **ë°ì´í„° ì •ë¦¬ ì „ëµ**: í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ (ìµœê·¼ 7ì¼ ë©”ëª¨ ë³´ê´€, ì˜¤ë˜ëœ ë©”ëª¨ ìë™ ì •ë¦¬)

---

## ğŸ“‹ ëª©ì°¨

1. [ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„](#ì‹œë‚˜ë¦¬ì˜¤-ë¶„ì„)
2. [í•´ê²° ë°©ë²• ê°œìš”](#í•´ê²°-ë°©ë²•-ê°œìš”)
3. [ê¸°ìˆ  ìŠ¤íƒ ë° ì•„í‚¤í…ì²˜](#ê¸°ìˆ -ìŠ¤íƒ-ë°-ì•„í‚¤í…ì²˜)
4. [ë°ì´í„° ëª¨ë¸](#ë°ì´í„°-ëª¨ë¸)
5. [êµ¬í˜„ ë°©ë²•](#êµ¬í˜„-ë°©ë²•)
6. [ë™ê¸°í™” ì „ëµ](#ë™ê¸°í™”-ì „ëµ)
7. [ì¶©ëŒ í•´ê²°](#ì¶©ëŒ-í•´ê²°)
8. [ì—ëŸ¬ ì²˜ë¦¬](#ì—ëŸ¬-ì²˜ë¦¬)
9. [êµ¬í˜„ ë‹¨ê³„ë³„ ê°€ì´ë“œ](#êµ¬í˜„-ë‹¨ê³„ë³„-ê°€ì´ë“œ)
10. [í…ŒìŠ¤íŠ¸ ë°©ë²•](#í…ŒìŠ¤íŠ¸-ë°©ë²•)

---

## ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„

### ìš”êµ¬ì‚¬í•­

1. **ì˜¤í”„ë¼ì¸ í™˜ê²½ì—ì„œ ë©”ëª¨ ì‘ì„±**
   - ë„¤íŠ¸ì›Œí¬ê°€ ì—†ì–´ë„ ë©”ëª¨ ì‘ì„± ê°€ëŠ¥
   - ëª¨ë“  ë©”ëª¨ëŠ” ë‚´ ì„œì¬(userBookId)ì— ì €ì¥ëœ ì±…ì— ëŒ€í•´ì„œë§Œ ì‘ì„± ê°€ëŠ¥
   - ë‚´ìš© ì†ì‹¤ ì—†ì´ UIì— ì¦‰ì‹œ í‘œì‹œ

2. **ì˜¤í”„ë¼ì¸ í™˜ê²½ì—ì„œ ë©”ëª¨ ìˆ˜ì •**
   - ë„¤íŠ¸ì›Œí¬ê°€ ì—†ì–´ë„ ë©”ëª¨ ìˆ˜ì • ê°€ëŠ¥
   - ê¸°ì¡´ ë©”ëª¨ì˜ ë‚´ìš©, íƒœê·¸, í˜ì´ì§€ ë²ˆí˜¸ ë“±ì„ ìˆ˜ì • ê°€ëŠ¥
   - ìˆ˜ì • ë‚´ìš©ì´ ì¦‰ì‹œ UIì— ë°˜ì˜
   - ë™ê¸°í™” ëŒ€ê¸° ìƒíƒœë¡œ í‘œì‹œ

3. **ì˜¤í”„ë¼ì¸ í™˜ê²½ì—ì„œ ë©”ëª¨ ì‚­ì œ**
   - ë„¤íŠ¸ì›Œí¬ê°€ ì—†ì–´ë„ ë©”ëª¨ ì‚­ì œ ê°€ëŠ¥
   - ì‚­ì œëœ ë©”ëª¨ëŠ” UIì—ì„œ ì¦‰ì‹œ ì œê±°
   - ë™ê¸°í™” ëŒ€ê¸° ìƒíƒœë¡œ í‘œì‹œ (ì„œë²„ì—ì„œ ì‹¤ì œ ì‚­ì œë˜ê¸° ì „ê¹Œì§€)

4. **ë¡œì»¬ ì €ì¥**
   - ì„œë²„ì— ì €ì¥í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ë¡œì»¬ ì €ì¥ì†Œì— ì„ì‹œ ì €ì¥
   - ë¸Œë¼ìš°ì € ì¬ì‹œì‘ í›„ì—ë„ ë°ì´í„° ìœ ì§€
   - ìˆ˜ì •/ì‚­ì œ ì‘ì—…ë„ ë¡œì»¬ì— ì €ì¥

5. **ìë™ ë™ê¸°í™”**
   - ë„¤íŠ¸ì›Œí¬ ì¬ì—°ê²° ì‹œ ìë™ìœ¼ë¡œ ì„œë²„ì— ë™ê¸°í™”
   - ë°ì´í„° ì†ì‹¤ ì—†ì´ ëª¨ë“  ë©”ëª¨ ì‘ì—…(ìƒì„±/ìˆ˜ì •/ì‚­ì œ) ì €ì¥
   - ë™ê¸°í™” ìƒíƒœ UI í‘œì‹œ
   - ì‘ì—… ìˆœì„œ ë³´ì¥ (ì‘ì„± ì‹œê°„ ìˆœì„œëŒ€ë¡œ ë™ê¸°í™”)

### ì œì•½ì‚¬í•­

- **ë©”ëª¨ ì‘ì„± ì¡°ê±´**: `userBookId`ê°€ ë‚´ ì„œì¬ì— ì¡´ì¬í•˜ëŠ” ì±…ì´ì–´ì•¼ í•¨
- **ë°ì´í„° ìœ íš¨ì„±**: ì„œë²„ì™€ ë™ì¼í•œ ê²€ì¦ ê·œì¹™ ì ìš© í•„ìš”
  - `userBookId`: í•„ìˆ˜
  - `pageNumber`: í•„ìˆ˜, 1 ì´ìƒ
  - `content`: í•„ìˆ˜, ìµœëŒ€ 5000ì
  - `tags`: ì„ íƒ (ë¬¸ìì—´ ë¦¬ìŠ¤íŠ¸)
  - `memoStartTime`: í•„ìˆ˜

### ê³ ë ¤ì‚¬í•­

1. **ë¡œì»¬ ID ìƒì„±**: ì„œë²„ IDëŠ” ì„œë²„ì—ì„œ ìƒì„±ë˜ë¯€ë¡œ ì„ì‹œ ID í•„ìš” (ìƒì„± ì‹œì—ë§Œ)
2. **ë™ê¸°í™” ìˆœì„œ**: ì˜¤í”„ë¼ì¸ ë©”ëª¨ ì‘ì—…ë“¤ì€ ì‘ì„± ì‹œê°„ ìˆœìœ¼ë¡œ ë™ê¸°í™”
3. **ì¤‘ë³µ ë°©ì§€**: ë™ì¼í•œ ë©”ëª¨ê°€ ì¤‘ë³µ ì €ì¥ë˜ì§€ ì•Šë„ë¡ ë³´ì¥
4. **ë¶€ë¶„ ì‹¤íŒ¨**: ì¼ë¶€ ë©”ëª¨ë§Œ ë™ê¸°í™” ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ë¡œì§
5. **í•˜ì´ë¸Œë¦¬ë“œ ë°ì´í„° ì •ë¦¬ ì „ëµ**: ìµœê·¼ 7ì¼ ë©”ëª¨ëŠ” IndexedDBì— ë³´ê´€í•˜ì—¬ ì˜¤í”„ë¼ì¸ ì¡°íšŒë¥¼ ì§€ì›í•˜ê³ , ì˜¤ë˜ëœ ë©”ëª¨ëŠ” ìë™ìœ¼ë¡œ ì •ë¦¬í•˜ì—¬ ìš©ëŸ‰ì„ ê´€ë¦¬
6. **ë©”ëª¨ ìˆ˜ì • ì‹œ ì¶©ëŒ í•´ê²°**: ì˜¤í”„ë¼ì¸ì—ì„œ ìˆ˜ì •í•œ ë©”ëª¨ì™€ ì„œë²„ì˜ ë©”ëª¨ê°€ ë‹¤ë¥¼ ê²½ìš° ì²˜ë¦¬ ì „ëµ í•„ìš”
7. **ë©”ëª¨ ì‚­ì œ ì‹œ ìˆœì„œ ë³´ì¥**: ë©”ëª¨ ìˆ˜ì • í›„ ì‚­ì œí•˜ëŠ” ê²½ìš°, ìˆ˜ì •ì´ ë¨¼ì € ë™ê¸°í™”ë˜ì–´ì•¼ í•¨
8. **ì„œë²„ ID í•„ìš”**: ë©”ëª¨ ìˆ˜ì •/ì‚­ì œëŠ” ì„œë²„ì— ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë©”ëª¨ì— ëŒ€í•œ ì‘ì—…ì´ë¯€ë¡œ `serverId` í•„ìš”

---

## í•´ê²° ë°©ë²• ê°œìš”

### Offline-First ì ‘ê·¼ë²•

**í•µì‹¬ ì² í•™**:

Offline-First ì•„í‚¤í…ì²˜ëŠ” **ë„¤íŠ¸ì›Œí¬ë¥¼ í•„ìˆ˜ ì¡°ê±´ì´ ì•„ë‹Œ, ì„ íƒì ì¸ ê¸°ëŠ¥ìœ¼ë¡œ ê°„ì£¼**í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ëŠ” ì „í†µì ì¸ ì˜¨ë¼ì¸ ìš°ì„ (Online-First) ì ‘ê·¼ë²•ê³¼ ê·¼ë³¸ì ìœ¼ë¡œ ë‹¤ë¥¸ ì‚¬ê³ ë°©ì‹ì…ë‹ˆë‹¤.

#### 1. ì‹ ë¢°ì˜ ì›ì²œ ì „í™˜

**ì „í†µì ì¸ ì ‘ê·¼ë²• (Online-First)**:
- ì„œë²„ê°€ ë°ì´í„°ì˜ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì†ŒìŠ¤
- í´ë¼ì´ì–¸íŠ¸ëŠ” ì„œë²„ ì‘ë‹µì„ ê¸°ë‹¤ë ¤ì•¼ UI ì—…ë°ì´íŠ¸
- ë„¤íŠ¸ì›Œí¬ê°€ ì—†ìœ¼ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‚¬ìš© ë¶ˆê°€

**Offline-First ì ‘ê·¼ë²•**:
- **í´ë¼ì´ì–¸íŠ¸(ë¸Œë¼ìš°ì €)ì˜ ë¡œì»¬ ë°ì´í„° ì €ì¥ì†Œë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê¸°ë³¸ ë°ì´í„° ì†ŒìŠ¤ë¡œ ì‚¬ìš©**
- UIëŠ” ì„œë²„ì˜ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ëŒ€ì‹  **ë¡œì»¬ ë°ì´í„°ë¥¼ ì¦‰ì‹œ ë Œë”ë§**
- ì„œë²„ëŠ” ë°ì´í„°ì˜ ìµœì¢… ì €ì¥ì†Œì´ì§€ë§Œ, í´ë¼ì´ì–¸íŠ¸ì˜ ê¸°ë³¸ ë°ì´í„° ì†ŒìŠ¤ëŠ” ì•„ë‹˜

**êµ¬í˜„ ì˜ˆì‹œ**:
```javascript
// Offline-First ë°©ì‹
async createMemo(memoData) {
    // 1. ë¡œì»¬ ì €ì¥ì†Œì— ë¨¼ì € ì €ì¥ (ì¦‰ì‹œ)
    const localMemo = await dbManager.saveMemo(memoData);
    
    // 2. UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (ì„œë²„ ì‘ë‹µ ëŒ€ê¸° ì—†ìŒ)
    renderMemo(localMemo);
    
    // 3. ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì„œë²„ ë™ê¸°í™” (ë¹„ë™ê¸°)
    if (networkMonitor.isOnline) {
        syncToServer(localMemo).catch(handleError);
    }
}
```

#### 2. ë„¤íŠ¸ì›Œí¬ì˜ ì—­í•  ì¬ì •ì˜

**ì „í†µì ì¸ ì ‘ê·¼ë²•**:
- ë„¤íŠ¸ì›Œí¬ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ë™ì‘ì˜ **ì „ì œ ì¡°ê±´**
- ë„¤íŠ¸ì›Œí¬ ì—†ì´ëŠ” ê¸°ëŠ¥ ì‚¬ìš© ë¶ˆê°€

**Offline-First ì ‘ê·¼ë²•**:
- **ë„¤íŠ¸ì›Œí¬ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë™ì‘ì„ ìœ„í•œ ì „ì œ ì¡°ê±´ì´ ì•„ë‹ˆë¼, ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë¡œì»¬ ë°ì´í„°ì™€ ì„œë²„ ë°ì´í„°ë¥¼ ë™ê¸°í™”(Synchronization)í•˜ëŠ” ì—­í• ë¡œ ê²©ìƒ**
- ë„¤íŠ¸ì›Œí¬ê°€ ì—†ì–´ë„ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì •ìƒ ë™ì‘
- ë„¤íŠ¸ì›Œí¬ëŠ” ë°ì´í„° ë™ê¸°í™”ë¥¼ ìœ„í•œ ì„ íƒì  ì±„ë„

**ë™ì‘ íë¦„**:
```
[ì‚¬ìš©ì ì•¡ì…˜]
    â†“
[ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥] â† í•­ìƒ ë¨¼ì € ì‹¤í–‰
    â†“
[UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸] â† ì„œë²„ ì‘ë‹µ ëŒ€ê¸° ì—†ìŒ
    â†“
[ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸]
    â”œâ”€ ì˜¨ë¼ì¸ â†’ [ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™”] â† ì„ íƒì 
    â””â”€ ì˜¤í”„ë¼ì¸ â†’ [ëŒ€ê¸° ìƒíƒœ í‘œì‹œ] â† ì •ìƒ ë™ì‘
```

**í•µì‹¬ ì›ì¹™**:
1. **ë¡œì»¬ ìš°ì„ **: í•­ìƒ ë¡œì»¬ ì €ì¥ì†Œì— ë¨¼ì € ì €ì¥
2. **ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™”**: ë„¤íŠ¸ì›Œí¬ ìƒíƒœì™€ ë¬´ê´€í•˜ê²Œ ë™ì‘
3. **ë‚™ê´€ì  ì—…ë°ì´íŠ¸**: ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸, ë‚˜ì¤‘ì— ì„œë²„ ë™ê¸°í™”
4. **ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜**: ë™ê¸°í™” ì‹¤íŒ¨ ì‹œ ìë™ ì¬ì‹œë„

### ì•„í‚¤í…ì²˜ í”Œë¡œìš°

#### ë©”ëª¨ ìƒì„± í”Œë¡œìš°

```
[ì‚¬ìš©ì ë©”ëª¨ ì‘ì„±]
        â†“
[ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥] â† IndexedDB
        â†“
[UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸]
        â†“
[ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸]
        â”œâ”€ ì˜¨ë¼ì¸ â†’ [ë™ê¸°í™” íì— ì¶”ê°€ (CREATE)] â†’ [ì„œë²„ë¡œ ì „ì†¡]
        â””â”€ ì˜¤í”„ë¼ì¸ â†’ [ëŒ€ê¸° ìƒíƒœ í‘œì‹œ]
                            â†“
                    [ë„¤íŠ¸ì›Œí¬ ì¬ì—°ê²° ê°ì§€]
                            â†“
                    [ëŒ€ê¸° ì¤‘ì¸ ë©”ëª¨ ë™ê¸°í™”]
                            â†“
                    [ì„œë²„ ì‘ë‹µ ì²˜ë¦¬]
                            â”œâ”€ ì„±ê³µ â†’ [ë¡œì»¬ ë©”ëª¨ ì—…ë°ì´íŠ¸ (ì„œë²„ ID)]
                            â””â”€ ì‹¤íŒ¨ â†’ [ì¬ì‹œë„ íì— ì¶”ê°€]
```

#### ë©”ëª¨ ìˆ˜ì • í”Œë¡œìš°

```
[ì‚¬ìš©ì ë©”ëª¨ ìˆ˜ì •]
        â†“
[IndexedDBì—ì„œ ê¸°ì¡´ ë©”ëª¨ ì¡°íšŒ] â† serverId í•„ìš”
        â†“
[ìˆ˜ì • ë‚´ìš© ë°˜ì˜] â† ë¡œì»¬ ë©”ëª¨ ì—…ë°ì´íŠ¸
        â†“
[ê¸°ì¡´ ë™ê¸°í™” í í•­ëª© ì œê±°] â† ì¤‘ë³µ ë°©ì§€
        â†“
[ë™ê¸°í™” íì— ì¶”ê°€ (UPDATE)] â† serverId í¬í•¨
        â†“
[UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸]
        â†“
[ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸]
        â”œâ”€ ì˜¨ë¼ì¸ â†’ [ì„œë²„ë¡œ ì „ì†¡ (PUT /memos/{id})]
        â””â”€ ì˜¤í”„ë¼ì¸ â†’ [ëŒ€ê¸° ìƒíƒœ í‘œì‹œ]
                            â†“
                    [ë„¤íŠ¸ì›Œí¬ ì¬ì—°ê²° ê°ì§€]
                            â†“
                    [ëŒ€ê¸° ì¤‘ì¸ ìˆ˜ì • ë™ê¸°í™”]
                            â†“
                    [ì„œë²„ ì‘ë‹µ ì²˜ë¦¬]
                            â”œâ”€ ì„±ê³µ â†’ [ë¡œì»¬ ë©”ëª¨ ìƒíƒœ ì—…ë°ì´íŠ¸ (synced)]
                            â””â”€ ì‹¤íŒ¨ â†’ [ì¬ì‹œë„ íì— ì¶”ê°€]
```

#### ë©”ëª¨ ì‚­ì œ í”Œë¡œìš°

```
[ì‚¬ìš©ì ë©”ëª¨ ì‚­ì œ]
        â†“
[IndexedDBì—ì„œ ê¸°ì¡´ ë©”ëª¨ ì¡°íšŒ] â† serverId í•„ìš”
        â†“
[ë™ê¸°í™” íì— ì¶”ê°€ (DELETE)] â† serverId í¬í•¨
        â†“
[ë¡œì»¬ ë©”ëª¨ëŠ” ì‚­ì œ í‘œì‹œë§Œ] â† ì‹¤ì œ ì‚­ì œëŠ” ë™ê¸°í™” ì™„ë£Œ í›„
        â†“
[UIì—ì„œ ì¦‰ì‹œ ì œê±°] â† ë‚™ê´€ì  ì—…ë°ì´íŠ¸
        â†“
[ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸]
        â”œâ”€ ì˜¨ë¼ì¸ â†’ [ì„œë²„ë¡œ ì „ì†¡ (DELETE /memos/{id})]
        â””â”€ ì˜¤í”„ë¼ì¸ â†’ [ëŒ€ê¸° ìƒíƒœ í‘œì‹œ]
                            â†“
                    [ë„¤íŠ¸ì›Œí¬ ì¬ì—°ê²° ê°ì§€]
                            â†“
                    [ëŒ€ê¸° ì¤‘ì¸ ì‚­ì œ ë™ê¸°í™”]
                            â†“
                    [ì„œë²„ ì‘ë‹µ ì²˜ë¦¬]
                            â”œâ”€ ì„±ê³µ â†’ [ë¡œì»¬ ë©”ëª¨ ì‹¤ì œ ì‚­ì œ]
                            â””â”€ ì‹¤íŒ¨ â†’ [ì¬ì‹œë„ íì— ì¶”ê°€]
```

**ì°¸ê³ **: ì•„ì§ ë™ê¸°í™”ë˜ì§€ ì•Šì€ ë©”ëª¨(serverIdê°€ ì—†ëŠ” ë©”ëª¨)ë¥¼ ì‚­ì œí•˜ëŠ” ê²½ìš°:
- ë¡œì»¬ì—ì„œ ì¦‰ì‹œ ì‚­ì œ
- ë™ê¸°í™” íì˜ CREATE í•­ëª©ë„ ì œê±°
- ì„œë²„ ë™ê¸°í™” ë¶ˆí•„ìš”

### ë„¤íŠ¸ì›Œí¬ ì—°ê²° ê°ì§€ ë° ìë™ ë™ê¸°í™” ë©”ì»¤ë‹ˆì¦˜

#### 1. ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ê°ì§€ ë°©ë²•

**í•µì‹¬ ì›ë¦¬:**
- **`navigator.onLine` API**: í˜„ì¬ ë¸Œë¼ìš°ì €ì˜ ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ìƒíƒœë¥¼ í™•ì¸
- **`online` / `offline` ì´ë²¤íŠ¸**: ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ ì´ë²¤íŠ¸ ë°œìƒ
- **2ë‹¨ê³„ í—¬ìŠ¤ì²´í¬**: ë¡œì»¬ ë°±ì—”ë“œ ì„œë²„ ì—°ê²° ê°€ëŠ¥ ì—¬ë¶€ + ì™¸ë¶€ ì„œë¹„ìŠ¤(ì•Œë¼ë”˜ API) ì—°ê²° ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ê°ê° í™•ì¸

**ê°ì§€ ë©”ì»¤ë‹ˆì¦˜:**

```javascript
// 1. ì´ˆê¸° ìƒíƒœ í™•ì¸
const isOnline = navigator.onLine;  // boolean: true/false

// 2. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
window.addEventListener('online', () => {
    // ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë³µêµ¬ ê°ì§€
    console.log('ë„¤íŠ¸ì›Œí¬ê°€ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!');
});

window.addEventListener('offline', () => {
    // ë„¤íŠ¸ì›Œí¬ ì—°ê²° ëŠê¹€ ê°ì§€
    console.log('ë„¤íŠ¸ì›Œí¬ê°€ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤!');
});
```

**âš ï¸ ì¤‘ìš”: 2ë‹¨ê³„ í—¬ìŠ¤ì²´í¬ì˜ í•„ìš”ì„±**

í˜„ì¬ `navigator.onLine`ê³¼ ê¸°ë³¸ í—¬ìŠ¤ì²´í¬ë§Œìœ¼ë¡œëŠ” ë‹¤ìŒ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ê°ì§€í•˜ì§€ ëª»í•©ë‹ˆë‹¤:

**ë¬¸ì œ ì‹œë‚˜ë¦¬ì˜¤:**
- í•™êµ Wi-Fiì— ì—°ê²°ë˜ì–´ ìˆì§€ë§Œ, í•™êµ ë°©í™”ë²½ì´ ì•Œë¼ë”˜ API ì„œë²„ë¡œì˜ ì™¸ë¶€ ìš”ì²­ì„ ì°¨ë‹¨
- `navigator.onLine`: `true` (ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ ì–´ëŒ‘í„°ëŠ” ì—°ê²°ë¨)
- ê¸°ë³¸ í—¬ìŠ¤ì²´í¬(`/api/v1/health`): ì„±ê³µ (ë¡œì»¬ ë°±ì—”ë“œ ì„œë²„ëŠ” ì ‘ê·¼ ê°€ëŠ¥)
- **ê²°ê³¼**: í”„ë¡ íŠ¸ì—”ë“œëŠ” "ì˜¨ë¼ì¸ ìƒíƒœì´ë©° ë™ê¸°í™” ë° ê²€ìƒ‰ ê°€ëŠ¥"í•˜ë‹¤ê³  íŒë‹¨
- **ì‹¤ì œ**: ì‚¬ìš©ìê°€ ë„ì„œ ê²€ìƒ‰ì„ ì‹œë„í•˜ë©´ ë°±ì—”ë“œ ì„œë²„ê°€ ì•Œë¼ë”˜ API ì—°ê²°ì— ì‹¤íŒ¨í•˜ì—¬ 500 ì—ëŸ¬ ë°˜í™˜ â†’ ì‚¬ìš©ì í˜¼ë€ ìœ ë°œ

**í•´ê²° ë°©ì•ˆ:**
- **1ë‹¨ê³„**: ë¡œì»¬ ë°±ì—”ë“œ ì„œë²„ ì—°ê²° í™•ì¸ (`/api/v1/health`)
- **2ë‹¨ê³„**: ì™¸ë¶€ ì„œë¹„ìŠ¤(ì•Œë¼ë”˜ API) ì—°ê²° í™•ì¸ (`/api/v1/health/aladin`)
- ë‘ ë‹¨ê³„ ëª¨ë‘ ì„±ê³µí•´ì•¼ ì™„ì „í•œ ì˜¨ë¼ì¸ ìƒíƒœë¡œ íŒë‹¨

**ì‘ë™ ì›ë¦¬:**
1. ë¸Œë¼ìš°ì €ê°€ ì‹œìŠ¤í…œì˜ ë„¤íŠ¸ì›Œí¬ ì–´ëŒ‘í„° ìƒíƒœë¥¼ ëª¨ë‹ˆí„°ë§
2. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ê°ì§€ë˜ë©´ `online` ì´ë²¤íŠ¸ ìë™ ë°œìƒ
3. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ëŠì–´ì§€ë©´ `offline` ì´ë²¤íŠ¸ ìë™ ë°œìƒ
4. ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ë“±ë¡ëœ ì½œë°± í•¨ìˆ˜ ì‹¤í–‰

#### 2. ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ê°ì§€ ì‹œ ìë™ ë™ê¸°í™” í”Œë¡œìš°

**ë‹¨ê³„ë³„ ì²˜ë¦¬ ê³¼ì •:**

```
[Step 1] ë„¤íŠ¸ì›Œí¬ ì—°ê²° ê°ì§€
    â†“
    ë¸Œë¼ìš°ì €: 'online' ì´ë²¤íŠ¸ ë°œìƒ
    â†“
    NetworkMonitor.onNetworkOnline() í˜¸ì¶œ
    â†“
    
[Step 2] ë„¤íŠ¸ì›Œí¬ ì•ˆì •í™” ëŒ€ê¸°
    â†“
    setTimeout(1000ms) - ë„¤íŠ¸ì›Œí¬ ì•ˆì •í™” ëŒ€ê¸°
    (ë„ˆë¬´ ë¹ ë¥¸ ë™ê¸°í™” ì‹œë„ ë°©ì§€)
    â†“
    
[Step 3] ëŒ€ê¸° ì¤‘ì¸ ë©”ëª¨ ì¡°íšŒ
    â†“
    IndexedDBì—ì„œ syncStatus = 'pending'ì¸ ë©”ëª¨ë“¤ ì¡°íšŒ
    â†“
    memoStartTime ê¸°ì¤€ ì •ë ¬ (ì‘ì„± ìˆœì„œ ë³´ì¥)
    â†“
    
[Step 4] ìˆœì°¨ ë™ê¸°í™” ì‹¤í–‰
    â†“
    for each (ëŒ€ê¸° ì¤‘ì¸ ë©”ëª¨) {
        [4-1] ë™ê¸°í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            - syncStatus: 'pending' â†’ 'syncing'
            â†“
        [4-2] ì„œë²„ API í˜¸ì¶œ
            POST /api/v1/memos
            Request Body: MemoCreateRequest
            â†“
        [4-3] ì„œë²„ ì‘ë‹µ ì²˜ë¦¬
            â”œâ”€ ì„±ê³µ (200 OK)
            â”‚   â†“
            â”‚   - ì„œë²„ì—ì„œ ìƒì„±ëœ ID ë°›ìŒ
            â”‚   - ë¡œì»¬ ë©”ëª¨ì— serverId ì €ì¥
            â”‚   - syncStatus: 'syncing' â†’ 'synced'
            â”‚   - ë™ê¸°í™” í í•­ëª© status: 'SUCCESS'
            â”‚
            â””â”€ ì‹¤íŒ¨ (4xx/5xx ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜)
                â†“
                - syncStatus: 'syncing' â†’ 'failed'
                - ë™ê¸°í™” íì— ì—ëŸ¬ ê¸°ë¡
                - ì¬ì‹œë„ ë¡œì§ íŠ¸ë¦¬ê±° (Exponential Backoff)
    }
    â†“
    
[Step 5] ë™ê¸°í™” ì™„ë£Œ í›„ ì²˜ë¦¬
    â†“
    - ì„±ê³µí•œ ë©”ëª¨: IndexedDB ì—…ë°ì´íŠ¸ (serverId ì„¤ì •)
    - ì‹¤íŒ¨í•œ ë©”ëª¨: ì¬ì‹œë„ íì— ì¶”ê°€
    - UI ì—…ë°ì´íŠ¸ (ë™ê¸°í™” ìƒíƒœ í‘œì‹œ)
```

#### 3. ì‹¤ì œ ë°ì´í„° ì „ë‹¬ ê³¼ì •

**ë¡œì»¬ ì €ì¥ì†Œ â†’ ì„œë²„ â†’ DB íë¦„:**

```javascript
// [ë¡œì»¬ ì €ì¥ì†Œ (IndexedDB)]
{
  localId: "550e8400-e29b-41d4-a716-446655440000",
  userBookId: 123,
  pageNumber: 50,
  content: "ë©”ëª¨ ë‚´ìš©",
  tags: ["íƒœê·¸1", "íƒœê·¸2"],
  memoStartTime: "2024-01-01T10:30:00Z",
  syncStatus: "pending"
}
    â†“
// [ë™ê¸°í™” ìš”ì²­ ìƒì„±]
{
  type: "CREATE",
  localMemoId: "550e8400-e29b-41d4-a716-446655440000",
  data: {
    userBookId: 123,
    pageNumber: 50,
    content: "ë©”ëª¨ ë‚´ìš©",
    tags: ["íƒœê·¸1", "íƒœê·¸2"],
    memoStartTime: "2024-01-01T10:30:00Z"
  }
}
    â†“
// [HTTP ìš”ì²­: POST /api/v1/memos]
fetch('http://localhost:8080/api/v1/memos', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer <access_token>'
  },
  body: JSON.stringify({
    userBookId: 123,
    pageNumber: 50,
    content: "ë©”ëª¨ ë‚´ìš©",
    tags: ["íƒœê·¸1", "íƒœê·¸2"],
    memoStartTime: "2024-01-01T10:30:00Z"
  })
})
    â†“
// [ì„œë²„ ì²˜ë¦¬]
Spring Boot Controller â†’ Service â†’ Repository â†’ MySQL
    â†“
// [ì„œë²„ ì‘ë‹µ]
{
  "ok": true,
  "data": {
    "id": 456,  // ì„œë²„ì—ì„œ ìƒì„±ëœ ID
    "userBookId": 123,
    "content": "ë©”ëª¨ ë‚´ìš©",
    ...
    "createdAt": "2024-01-01T10:35:00Z"
  }
}
    â†“
// [ë¡œì»¬ ì €ì¥ì†Œ ì—…ë°ì´íŠ¸]
{
  localId: "550e8400-e29b-41d4-a716-446655440000",
  serverId: 456,  // â† ì„œë²„ ID ì €ì¥
  ...
  syncStatus: "synced"  // â† ë™ê¸°í™” ì™„ë£Œ
}
```

#### 4. ë„¤íŠ¸ì›Œí¬ ê°ì§€ ì‹ ë¢°ì„± ë³´ì¥

**ë¬¸ì œì :**
- `navigator.onLine`ì€ ë„¤íŠ¸ì›Œí¬ ì–´ëŒ‘í„° ìƒíƒœë§Œ í™•ì¸
- ì‹¤ì œ ì„œë²„ ì—°ê²° ê°€ëŠ¥ ì—¬ë¶€ì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ
- ì˜ˆ: Wi-Fi ì—°ê²°ë˜ì–´ ìˆì§€ë§Œ ì¸í„°ë„· ì ‘ì† ë¶ˆê°€
- **ì¶”ê°€ ë¬¸ì œ**: ë¡œì»¬ ë°±ì—”ë“œ ì„œë²„ëŠ” ì ‘ê·¼ ê°€ëŠ¥í•˜ì§€ë§Œ, ì™¸ë¶€ ì„œë¹„ìŠ¤(ì•Œë¼ë”˜ API)ëŠ” ì ‘ê·¼ ë¶ˆê°€ëŠ¥í•œ ê²½ìš°ë¥¼ ê°ì§€í•˜ì§€ ëª»í•¨

**í•´ê²° ë°©ë²•:**

**2ë‹¨ê³„ í—¬ìŠ¤ì²´í¬ë¥¼ í†µí•œ ë„¤íŠ¸ì›Œí¬ ê°ì§€ (ê¶Œì¥)** â­

**1ë‹¨ê³„: ë°±ì—”ë“œ Heartbeat ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„**

ë°±ì—”ë“œ ì„œë²„ì— ë‹¤ìŒ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤:

**ì—”ë“œí¬ì¸íŠ¸**: `GET /api/v1/health/aladin`

**ë¡œì§**:
- ìš”ì²­ ì‹œ, ì•Œë¼ë”˜ APIì˜ ê°€ì¥ ê°€ë²¼ìš´ API(ì˜ˆ: ì¹´í…Œê³ ë¦¬ ëª©ë¡)ì— ì‹¤ì œ API í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
- ì„±ê³µ ì‹œ: `200 OK` ì‘ë‹µ
- ì‹¤íŒ¨ ì‹œ (ì—°ê²° ë¶ˆê°€, 401 ì¸ì¦ ì‹¤íŒ¨ ë“±): `503 Service Unavailable` ì‘ë‹µ

**ë°±ì—”ë“œ êµ¬í˜„ ì˜ˆì‹œ**:
```java
@RestController
@RequestMapping("/api/v1/health")
public class HealthController {
    
    @Autowired
    private AladinApiService aladinApiService;
    
    /**
     * ì•Œë¼ë”˜ API ì—°ê²° ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
     * @return 200 OK (ì—°ê²° ê°€ëŠ¥) ë˜ëŠ” 503 Service Unavailable (ì—°ê²° ë¶ˆê°€)
     */
    @GetMapping("/aladin")
    public ResponseEntity<Void> checkAladinHealth() {
        try {
            // ì•Œë¼ë”˜ APIì˜ ê°€ì¥ ê°€ë²¼ìš´ ìš”ì²­ìœ¼ë¡œ ì—°ê²° í…ŒìŠ¤íŠ¸
            // ì˜ˆ: ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì¡°íšŒ (TTBKeyë§Œ í•„ìš”, ìµœì†Œí•œì˜ ë°ì´í„°)
            aladinApiService.testConnection();
            return ResponseEntity.ok().build();
        } catch (Exception e) {
            // ì—°ê²° ì‹¤íŒ¨, ì¸ì¦ ì‹¤íŒ¨, íƒ€ì„ì•„ì›ƒ ë“± ëª¨ë“  ì˜ˆì™¸ ì²˜ë¦¬
            return ResponseEntity.status(HttpStatus.SERVICE_UNAVAILABLE).build();
        }
    }
}
```

**2ë‹¨ê³„: í´ë¼ì´ì–¸íŠ¸ Heartbeat ë¡œì§ í™•ì¥**

`NetworkMonitor` í´ë˜ìŠ¤ë¥¼ ìˆ˜ì •í•˜ì—¬ ì™¸ë¶€ ì„œë¹„ìŠ¤ ìƒíƒœê¹Œì§€ í™•ì¸í•©ë‹ˆë‹¤:

```javascript
// utils/network-monitor.js (2ë‹¨ê³„ í—¬ìŠ¤ì²´í¬ ê°œì„  ë²„ì „)
import { showToast } from './toast.js';
import { offlineMemoService } from '../services/offline-memo-service.js';

class NetworkMonitor {
    constructor() {
        this.isLocalServerReachable = false;
        this.isExternalServiceReachable = false;
    }
    
    async onNetworkOnline() {
        // 1ì´ˆ ëŒ€ê¸° (ë„¤íŠ¸ì›Œí¬ ì•ˆì •í™”)
        await this.delay(1000);
        
        // 1ë‹¨ê³„: ë¡œì»¬ ë°±ì—”ë“œ ì„œë²„ ì—°ê²° ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
        this.isLocalServerReachable = await this.checkServerHealth();
        
        if (!this.isLocalServerReachable) {
            // ë¡œì»¬ ì„œë²„ ì ‘ê·¼ ë¶ˆê°€
            console.warn('ë„¤íŠ¸ì›Œí¬ëŠ” ì—°ê²°ë˜ì—ˆì§€ë§Œ ì„œë²„ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            this.notifyNetworkStatus(false, false);
            // ì¬ì‹œë„ ì˜ˆì•½
            setTimeout(() => this.onNetworkOnline(), 5000);
            return;
        }
        
        // 2ë‹¨ê³„: ì™¸ë¶€ ì„œë¹„ìŠ¤(ì•Œë¼ë”˜ API) ì—°ê²° ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
        this.isExternalServiceReachable = await this.checkExternalServiceHealth();
        
        if (this.isExternalServiceReachable) {
            // ëª¨ë“  ì„œë¹„ìŠ¤ ì—°ê²° ê°€ëŠ¥ â†’ ë™ê¸°í™” ì‹œì‘ ë° ë„ì„œ ê²€ìƒ‰ í™œì„±í™”
            this.notifyNetworkStatus(true, true);
            // ë™ê¸°í™” ì™„ë£Œ í›„ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
            await this.handleSyncSuccess();
        } else {
            // ë¡œì»¬ ì„œë²„ëŠ” ì ‘ê·¼ ê°€ëŠ¥í•˜ì§€ë§Œ ì™¸ë¶€ ì„œë¹„ìŠ¤ ì ‘ê·¼ ë¶ˆê°€
            // ë™ê¸°í™”ëŠ” ê°€ëŠ¥í•˜ì§€ë§Œ ë„ì„œ ê²€ìƒ‰ì€ ì œí•œë¨
            console.warn('ì™¸ë¶€ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê²€ìƒ‰ ê¸°ëŠ¥ì´ ì œí•œë©ë‹ˆë‹¤.');
            this.notifyNetworkStatus(true, false);
            // ì™¸ë¶€ ì„œë¹„ìŠ¤ ì¬ì‹œë„ ì˜ˆì•½
            setTimeout(() => this.checkExternalServiceHealth(), 5000);
            // ë™ê¸°í™”ëŠ” ì§„í–‰ (ë¡œì»¬ ì„œë²„ëŠ” ì ‘ê·¼ ê°€ëŠ¥í•˜ë¯€ë¡œ)
            // ë™ê¸°í™” ì™„ë£Œ í›„ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ (ì™¸ë¶€ ì„œë¹„ìŠ¤ ê²½ê³  í¬í•¨)
            await this.handleSyncSuccess(false);
        }
    }
    
    /**
     * 1ë‹¨ê³„: ë¡œì»¬ ë°±ì—”ë“œ ì„œë²„ í—¬ìŠ¤ì²´í¬
     * @returns {Promise<boolean>} ì„œë²„ ì—°ê²° ê°€ëŠ¥ ì—¬ë¶€
     */
    async checkServerHealth() {
        try {
            const response = await fetch('http://localhost:8080/api/v1/health', {
                method: 'HEAD',
                signal: AbortSignal.timeout(3000)  // 3ì´ˆ íƒ€ì„ì•„ì›ƒ
            });
            return response.ok;
        } catch (error) {
            console.error('ë¡œì»¬ ì„œë²„ í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨:', error);
            return false;
        }
    }
    
    /**
     * 2ë‹¨ê³„: ì™¸ë¶€ ì„œë¹„ìŠ¤(ì•Œë¼ë”˜ API) í—¬ìŠ¤ì²´í¬
     * @returns {Promise<boolean>} ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ê²° ê°€ëŠ¥ ì—¬ë¶€
     */
    async checkExternalServiceHealth() {
        try {
            const response = await fetch('http://localhost:8080/api/v1/health/aladin', {
                method: 'GET',
                signal: AbortSignal.timeout(5000)  // 5ì´ˆ íƒ€ì„ì•„ì›ƒ (ì™¸ë¶€ APIì´ë¯€ë¡œ ë” ê¸´ íƒ€ì„ì•„ì›ƒ)
            });
            
            if (response.ok) {
                // 200 OK: ì•Œë¼ë”˜ API ì—°ê²° ê°€ëŠ¥
                return true;
            } else if (response.status === 503) {
                // 503 Service Unavailable: ì•Œë¼ë”˜ API ì—°ê²° ë¶ˆê°€
                return false;
            } else {
                // ê¸°íƒ€ ìƒíƒœ ì½”ë“œ
                return false;
            }
        } catch (error) {
            console.error('ì™¸ë¶€ ì„œë¹„ìŠ¤ í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨:', error);
            return false;
        }
    }
    
    /**
     * ë„¤íŠ¸ì›Œí¬ ìƒíƒœë¥¼ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì— ì•Œë¦¼ (DOM ì´ë²¤íŠ¸)
     * @param {boolean} isLocalServerReachable ë¡œì»¬ ì„œë²„ ì—°ê²° ê°€ëŠ¥ ì—¬ë¶€
     * @param {boolean} isExternalServiceReachable ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ê²° ê°€ëŠ¥ ì—¬ë¶€
     */
    notifyNetworkStatus(isLocalServerReachable, isExternalServiceReachable) {
        // ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ ë°œìƒ
        const event = new CustomEvent('networkStatusChanged', {
            detail: {
                isLocalServerReachable,
                isExternalServiceReachable,
                isFullyOnline: isLocalServerReachable && isExternalServiceReachable
            }
        });
        window.dispatchEvent(event);
    }
    
    /**
     * ë™ê¸°í™” ì„±ê³µ ì²˜ë¦¬ ë° í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
     * Heartbeat ì„±ê³µ í›„, ëª¨ë“  ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì‘ì—…ì´ ì™„ë£Œëœ ì§í›„ í˜¸ì¶œë¨
     * @param {boolean} isExternalServiceAvailable ì™¸ë¶€ ì„œë¹„ìŠ¤(ì•Œë¼ë”˜ API) ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€ (ê¸°ë³¸ê°’: true)
     */
    async handleSyncSuccess(isExternalServiceAvailable = true) {
        try {
            // ëª¨ë“  ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì‘ì—… ì‹¤í–‰
            // syncPendingMemos()ëŠ” { successCount: number, failedCount: number } í˜•íƒœì˜ ê²°ê³¼ë¥¼ ë°˜í™˜
            const syncResult = await offlineMemoService.syncPendingMemos();
            
            // ë™ê¸°í™” ì™„ë£Œ í›„ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ (ì„±ê³µ ë˜ëŠ” ì‹¤íŒ¨ ì‘ë‹µì„ ë°›ì€ í›„)
            if (syncResult && syncResult.successCount > 0) {
                // ë™ê¸°í™” ì„±ê³µ ë©”ì‹œì§€ (ìš°ì¸¡ í•˜ë‹¨ì— í† ìŠ¤íŠ¸ í‘œì‹œ)
                showToast(`âœ… ${syncResult.successCount}ê°œì˜ ë©”ëª¨ ë™ê¸°í™” ì™„ë£Œ.`, 'success');
            }
            
            // ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ê²° ë¶ˆê°€ ì‹œ ê²½ê³  ë©”ì‹œì§€
            if (!isExternalServiceAvailable) {
                showToast('âš ï¸ ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ê²° ë¶ˆê°€. ê²€ìƒ‰ ì œí•œë¨.', 'warning');
            }
        } catch (error) {
            console.error('ë™ê¸°í™” ì‹¤íŒ¨:', error);
            showToast('âŒ ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
        }
    }
}
```

**í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜:**

```javascript
// utils/toast.js
/**
 * í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
 * @param {string} message í‘œì‹œí•  ë©”ì‹œì§€
 * @param {string} type ë©”ì‹œì§€ íƒ€ì… ('success', 'warning', 'error', 'info')
 * @param {number} duration í‘œì‹œ ì‹œê°„ (ë°€ë¦¬ì´ˆ, ê¸°ë³¸ê°’: 3000)
 */
function showToast(message, type = 'info', duration = 3000) {
    // í† ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆê°€ ì—†ìœ¼ë©´ ìƒì„±
    let toastContainer = document.getElementById('toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        toastContainer.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        `;
        document.body.appendChild(toastContainer);
    }
    
    // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ìš”ì†Œ ìƒì„±
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.style.cssText = `
        background-color: ${getToastColor(type)};
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        min-width: 250px;
        max-width: 400px;
        animation: slideIn 0.3s ease-out;
        display: flex;
        align-items: center;
        gap: 10px;
    `;
    
    toast.textContent = message;
    
    // í† ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆì— ì¶”ê°€
    toastContainer.appendChild(toast);
    
    // ì§€ì •ëœ ì‹œê°„ í›„ ìë™ ì œê±°
    setTimeout(() => {
        toast.style.animation = 'slideOut 0.3s ease-out';
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 300);
    }, duration);
}

/**
 * í† ìŠ¤íŠ¸ ë©”ì‹œì§€ íƒ€ì…ë³„ ìƒ‰ìƒ ë°˜í™˜
 * @param {string} type ë©”ì‹œì§€ íƒ€ì…
 * @returns {string} CSS ìƒ‰ìƒ ê°’
 */
function getToastColor(type) {
    const colors = {
        success: '#4caf50',
        warning: '#ff9800',
        error: '#f44336',
        info: '#2196f3'
    };
    return colors[type] || colors.info;
}

// CSS ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ (í•œ ë²ˆë§Œ ì¶”ê°€)
if (!document.getElementById('toast-styles')) {
    const style = document.createElement('style');
    style.id = 'toast-styles';
    style.textContent = `
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
    `;
    document.head.appendChild(style);
}

export { showToast };
```

**ì»´í¬ë„ŒíŠ¸ì—ì„œ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ìˆ˜ì‹  ë° UI ì—…ë°ì´íŠ¸:**

```javascript
// components/BookSearchComponent.js
import { showToast } from '../utils/toast.js';

class BookSearchComponent {
    constructor() {
        // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        window.addEventListener('networkStatusChanged', (event) => {
            const { isLocalServerReachable, isExternalServiceReachable, isFullyOnline } = event.detail;
            
            if (isFullyOnline) {
                // ëª¨ë“  ì„œë¹„ìŠ¤ ì—°ê²° ê°€ëŠ¥ â†’ ë„ì„œ ê²€ìƒ‰ í™œì„±í™”
                this.enableBookSearch();
                this.hideWarningMessage();
            } else if (isLocalServerReachable && !isExternalServiceReachable) {
                // ë¡œì»¬ ì„œë²„ëŠ” ì ‘ê·¼ ê°€ëŠ¥í•˜ì§€ë§Œ ì™¸ë¶€ ì„œë¹„ìŠ¤ ì ‘ê·¼ ë¶ˆê°€
                // â†’ ë„ì„œ ê²€ìƒ‰ ë¹„í™œì„±í™” ë° ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ
                this.disableBookSearch();
                this.showWarningMessage('ì™¸ë¶€ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê²€ìƒ‰ ê¸°ëŠ¥ì´ ì œí•œë©ë‹ˆë‹¤.');
            } else {
                // ë¡œì»¬ ì„œë²„ë„ ì ‘ê·¼ ë¶ˆê°€
                this.disableBookSearch();
                this.showWarningMessage('ì„œë²„ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        });
    }
    
    enableBookSearch() {
        // ë„ì„œ ê²€ìƒ‰ ë²„íŠ¼ í™œì„±í™”
        this.searchButton.disabled = false;
    }
    
    disableBookSearch() {
        // ë„ì„œ ê²€ìƒ‰ ë²„íŠ¼ ë¹„í™œì„±í™”
        this.searchButton.disabled = true;
    }
    
    showWarningMessage(message) {
        // ê²½ê³  ë©”ì‹œì§€ UIì— í‘œì‹œ
        this.warningMessageElement.textContent = message;
        this.warningMessageElement.style.display = 'block';
    }
    
    hideWarningMessage() {
        // ê²½ê³  ë©”ì‹œì§€ ìˆ¨ê¹€
        this.warningMessageElement.style.display = 'none';
    }
}
```

**ë™ì‘ íë¦„:**

```
[ë„¤íŠ¸ì›Œí¬ ì—°ê²° ê°ì§€]
    â†“
[1ë‹¨ê³„: ë¡œì»¬ ë°±ì—”ë“œ ì„œë²„ í—¬ìŠ¤ì²´í¬]
    â”œâ”€ ì‹¤íŒ¨ â†’ ì¬ì‹œë„ ì˜ˆì•½, UIì— "ì„œë²„ ì ‘ê·¼ ë¶ˆê°€" ë©”ì‹œì§€ í‘œì‹œ
    â””â”€ ì„±ê³µ â†“
        [2ë‹¨ê³„: ì™¸ë¶€ ì„œë¹„ìŠ¤(ì•Œë¼ë”˜ API) í—¬ìŠ¤ì²´í¬]
            â”œâ”€ ì‹¤íŒ¨ â†’ 
            â”‚   - UIì— "ì™¸ë¶€ ì„œë¹„ìŠ¤ ì ‘ê·¼ ë¶ˆê°€, ê²€ìƒ‰ ê¸°ëŠ¥ ì œí•œ" ë©”ì‹œì§€ í‘œì‹œ
            â”‚   - ë„ì„œ ê²€ìƒ‰ ë²„íŠ¼ ë¹„í™œì„±í™”
            â”‚   - ë™ê¸°í™”ëŠ” ì§„í–‰ (ë¡œì»¬ ì„œë²„ëŠ” ì ‘ê·¼ ê°€ëŠ¥)
            â”‚   - ì™¸ë¶€ ì„œë¹„ìŠ¤ ì¬ì‹œë„ ì˜ˆì•½
            â”‚   - handleSyncSuccess(false) í˜¸ì¶œ
            â”‚       â†“
            â”‚   [ë™ê¸°í™” ì™„ë£Œ í›„]
            â”‚       - í† ìŠ¤íŠ¸ ë©”ì‹œì§€: "âœ… Nê°œì˜ ë©”ëª¨ ë™ê¸°í™” ì™„ë£Œ." (ì„±ê³µ ì‹œ)
            â”‚       - í† ìŠ¤íŠ¸ ë©”ì‹œì§€: "âš ï¸ ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ê²° ë¶ˆê°€. ê²€ìƒ‰ ì œí•œë¨."
            â”‚
            â””â”€ ì„±ê³µ â†’
                - ëª¨ë“  ê¸°ëŠ¥ í™œì„±í™”
                - handleSyncSuccess(true) í˜¸ì¶œ
                    â†“
                [ë™ê¸°í™” ì‹œì‘]
                    â†“
                [ë™ê¸°í™” ì™„ë£Œ í›„]
                    - í† ìŠ¤íŠ¸ ë©”ì‹œì§€: "âœ… Nê°œì˜ ë©”ëª¨ ë™ê¸°í™” ì™„ë£Œ." (ì„±ê³µ ì‹œ)
                    - í† ìŠ¤íŠ¸ ë©”ì‹œì§€: "âŒ ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤." (ì‹¤íŒ¨ ì‹œ)
                - ë„ì„œ ê²€ìƒ‰ ë²„íŠ¼ í™œì„±í™”
```

**í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ ì‹œì :**

1. **Heartbeat ì„±ê³µ í›„**: 2ë‹¨ê³„ í—¬ìŠ¤ì²´í¬(ë¡œì»¬ ì„œë²„ + ì™¸ë¶€ ì„œë¹„ìŠ¤)ê°€ ëª¨ë‘ ì„±ê³µí•œ ê²½ìš°
2. **ëª¨ë“  ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì‘ì—… ì™„ë£Œ ì§í›„**: `syncPendingMemos()` í˜¸ì¶œì´ ì™„ë£Œë˜ê³  ì„±ê³µ/ì‹¤íŒ¨ ì‘ë‹µì„ ë°›ì€ í›„
3. **ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ê²° ë¶ˆê°€ ì‹œ**: ì™¸ë¶€ ì„œë¹„ìŠ¤ í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨ ì‹œ ì¦‰ì‹œ ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ

**í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ì˜ˆì‹œ:**

- âœ… **ì„±ê³µ**: `"âœ… 3ê°œì˜ ë©”ëª¨ ë™ê¸°í™” ì™„ë£Œ."`
- âš ï¸ **ê²½ê³ **: `"âš ï¸ ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ê²° ë¶ˆê°€. ê²€ìƒ‰ ì œí•œë¨."`
- âŒ **ì—ëŸ¬**: `"âŒ ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."`

**í† ìŠ¤íŠ¸ ë©”ì‹œì§€ íŠ¹ì§•:**

- **ìœ„ì¹˜**: ìš°ì¸¡ í•˜ë‹¨ì— í‘œì‹œ
- **ìŠ¤íƒ€ì¼**: ê°„ê²°í•˜ê³  ì¼ì‹œì ì¸ ì•Œë¦¼
- **ìë™ ì œê±°**: 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ì‚¬ë¼ì§ (ì‚¬ìš©ì ì„¤ì • ê°€ëŠ¥)
- **ì‚¬ìš©ì ê²½í—˜**: ì‹œìŠ¤í…œ ë‚´ë¶€ ê³¼ì •ì„ ì•Œ í•„ìš” ì—†ì´ ê²°ê³¼ë§Œ í™•ì¸ ê°€ëŠ¥

**ì„œë²„ì˜ ì—­í• :**
- ì„œë²„ëŠ” ì™¸ë¶€ í™˜ê²½(ì•Œë¼ë”˜ API)ê³¼ì˜ ì—°ê²° ê°€ëŠ¥ ì—¬ë¶€ë¼ëŠ” ë°ì´í„°ë§Œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬
- `200 OK` ë˜ëŠ” `503 Service Unavailable` ì‘ë‹µ ì½”ë“œë¥¼ ë°˜í™˜
- í”„ë¡ íŠ¸ì—”ë“œëŠ” ì„œë²„ê°€ ë³´ë‚´ì¤€ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ **"ë„ì„œ ê²€ìƒ‰ ë²„íŠ¼ì„ í™œì„±í™”í• ì§€, ë¹„í™œì„±í™”í•˜ê³  ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì¤„ì§€"**ë¥¼ ìŠ¤ìŠ¤ë¡œ ê²°ì •í•˜ê³  ì‹¤í–‰

**Option 3: ë™ê¸°í™” ì‹œë„ ì‹œ ì‹¤ì œ ì—°ê²° í™•ì¸**
```javascript
// ë™ê¸°í™” ì‹œë„ ì‹œ ì‹¤ì œ API í˜¸ì¶œë¡œ ì—°ê²° ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
// ì‹¤íŒ¨ ì‹œ ìë™ìœ¼ë¡œ ì¬ì‹œë„ íì— ì¶”ê°€
// (í˜„ì¬ êµ¬í˜„ ë°©ì‹)
```

#### 5. ë„¤íŠ¸ì›Œí¬ ê°ì§€ ë° ë™ê¸°í™” í†µí•© í”Œë¡œìš°

**ì „ì²´ ì‹œìŠ¤í…œ ë™ì‘ íë¦„:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ì‚¬ìš©ì ì•¡ì…˜]                                       â”‚
â”‚  ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œ ë©”ëª¨ ì‘ì„±                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ë¡œì»¬ ì €ì¥]                                         â”‚
â”‚  1. IndexedDBì— ë©”ëª¨ ì €ì¥                           â”‚
â”‚  2. syncStatus = 'pending' ì„¤ì •                     â”‚
â”‚  3. ë™ê¸°í™” íì— í•­ëª© ì¶”ê°€                           â”‚
â”‚  4. UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ê°ì§€ ëŒ€ê¸°]                           â”‚
â”‚  NetworkMonitorê°€ online ì´ë²¤íŠ¸ ê°ì§€ ëŒ€ê¸°           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        [ì‚¬ìš©ìê°€ ë„¤íŠ¸ì›Œí¬ ì—°ê²°]
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ë„¤íŠ¸ì›Œí¬ ì—°ê²° ê°ì§€]                                â”‚
â”‚  1. ë¸Œë¼ìš°ì €: 'online' ì´ë²¤íŠ¸ ë°œìƒ                   â”‚
â”‚  2. NetworkMonitor.onNetworkOnline() í˜¸ì¶œ          â”‚
â”‚  3. navigator.onLine = true í™•ì¸                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ë„¤íŠ¸ì›Œí¬ ì•ˆì •í™” ëŒ€ê¸°]                              â”‚
â”‚  setTimeout(1000ms) - ì•ˆì •í™” ëŒ€ê¸°                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ëŒ€ê¸° ì¤‘ì¸ ë©”ëª¨ ì¡°íšŒ]                               â”‚
â”‚  1. IndexedDBì—ì„œ syncStatus='pending' ì¡°íšŒ        â”‚
â”‚  2. memoStartTime ê¸°ì¤€ ì •ë ¬                         â”‚
â”‚  3. ë™ê¸°í™”í•  ë©”ëª¨ ëª©ë¡ ìƒì„±                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ìˆœì°¨ ë™ê¸°í™” ì‹¤í–‰]                                  â”‚
â”‚  for each ë©”ëª¨:                                     â”‚
â”‚    1. syncStatus â†’ 'syncing'                        â”‚
â”‚    2. POST /api/v1/memos ìš”ì²­                       â”‚
â”‚    3. ì„œë²„ ì‘ë‹µ ëŒ€ê¸°                                â”‚
â”‚       â”œâ”€ ì„±ê³µ â†’ serverId ì €ì¥, 'synced' ì„¤ì •       â”‚
â”‚       â””â”€ ì‹¤íŒ¨ â†’ 'failed' ì„¤ì •, ì¬ì‹œë„ í ì¶”ê°€      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ì„œë²„ ì²˜ë¦¬]                                         â”‚
â”‚  1. MemoController.createMemo()                     â”‚
â”‚  2. MemoService.createMemo()                        â”‚
â”‚  3. MemoRepository.save()                           â”‚
â”‚  4. MySQL ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥                       â”‚
â”‚  5. ì„œë²„ ìƒì„± ID ë°˜í™˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ë¡œì»¬ ì €ì¥ì†Œ ì—…ë°ì´íŠ¸]                              â”‚
â”‚  1. IndexedDBì—ì„œ í•´ë‹¹ localId ì°¾ê¸°                 â”‚
â”‚  2. serverId í•„ë“œ ì—…ë°ì´íŠ¸                          â”‚
â”‚  3. syncStatus â†’ 'synced' ì—…ë°ì´íŠ¸                  â”‚
â”‚  4. ë™ê¸°í™” í í•­ëª© â†’ 'SUCCESS' ì—…ë°ì´íŠ¸             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [UI ì—…ë°ì´íŠ¸]                                       â”‚
â”‚  ë™ê¸°í™” ìƒíƒœ ì•„ì´ì½˜ ë³€ê²½:                            â”‚
â”‚  â³ ëŒ€ê¸° ì¤‘ â†’ ğŸ”„ ë™ê¸°í™” ì¤‘ â†’ âœ“ ë™ê¸°í™” ì™„ë£Œ         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 6. ë„¤íŠ¸ì›Œí¬ ê°ì§€ ì´ë²¤íŠ¸ ì˜ˆì œ

**ì‹¤ì œ ì½”ë“œì—ì„œì˜ ë™ì‘:**

```javascript
// ì•± ì‹œì‘ ì‹œ NetworkMonitor ì´ˆê¸°í™”
const networkMonitor = new NetworkMonitor();

// ë„¤íŠ¸ì›Œí¬ ì—°ê²° ê°ì§€ ì‹œ ìë™ ì‹¤í–‰ë˜ëŠ” íë¦„:

// 1. ì‚¬ìš©ìê°€ Wi-Fi ì—°ê²° ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ì¼€ì´ë¸” ì—°ê²°
//    â†“
// 2. ë¸Œë¼ìš°ì €ê°€ 'online' ì´ë²¤íŠ¸ ë°œìƒ
window.addEventListener('online', () => {
    // â†“
    // 3. NetworkMonitor.onNetworkOnline() ìë™ í˜¸ì¶œ
    networkMonitor.onNetworkOnline();
});

// 4. 1ì´ˆ í›„ (ì•ˆì •í™” ëŒ€ê¸°)
setTimeout(async () => {
    // â†“
    // 5. ëŒ€ê¸° ì¤‘ì¸ ë©”ëª¨ ë™ê¸°í™” ì‹œì‘
    await offlineMemoService.syncPendingMemos();
}, 1000);

// 6. IndexedDBì—ì„œ ëŒ€ê¸° ì¤‘ì¸ ë©”ëª¨ ì¡°íšŒ
const pendingMemos = await dbManager.getPendingMemos();
// ê²°ê³¼: [{ localId: "...", content: "...", ... }, ...]

// 7. ê° ë©”ëª¨ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ë™ê¸°í™”
for (const memo of pendingMemos) {
    // 7-1. ë™ê¸°í™” ìƒíƒœ ì—…ë°ì´íŠ¸
    memo.syncStatus = 'syncing';
    await dbManager.saveMemo(memo);
    
    // 7-2. ì„œë²„ API í˜¸ì¶œ
    const response = await apiClient.post('/memos', {
        userBookId: memo.userBookId,
        pageNumber: memo.pageNumber,
        content: memo.content,
        tags: memo.tags,
        memoStartTime: memo.memoStartTime
    });
    
    // 7-3. ì„œë²„ ì‘ë‹µìœ¼ë¡œ ë¡œì»¬ ë©”ëª¨ ì—…ë°ì´íŠ¸
    await dbManager.updateMemoWithServerId(memo.localId, response.data.id);
    // IndexedDB ì—…ë°ì´íŠ¸: serverId = 456, syncStatus = 'synced'
}
```

#### 7. ë„¤íŠ¸ì›Œí¬ ê°ì§€ì˜ í•œê³„ ë° ë³´ì™„ì±…

**í•œê³„ì :**
1. `navigator.onLine`ì€ ë„¤íŠ¸ì›Œí¬ ì–´ëŒ‘í„° ìƒíƒœë§Œ í™•ì¸ (ì‹¤ì œ ì¸í„°ë„· ì—°ê²°ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ)
2. ì¼ë¶€ í™˜ê²½ì—ì„œëŠ” `online` ì´ë²¤íŠ¸ê°€ ì§€ì—°ë˜ê±°ë‚˜ ë°œìƒí•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ
3. ì„œë²„ê°€ ë‹¤ìš´ë˜ì–´ ìˆìœ¼ë©´ ë„¤íŠ¸ì›Œí¬ëŠ” ì—°ê²°ë˜ì–´ë„ ë™ê¸°í™” ë¶ˆê°€

**ë³´ì™„ì±…:**

**1. ì£¼ê¸°ì  í—¬ìŠ¤ì²´í¬ (Polling)**
```javascript
// ì£¼ê¸°ì ìœ¼ë¡œ ì„œë²„ ì—°ê²° ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
setInterval(async () => {
    if (navigator.onLine) {
        const isServerReachable = await checkServerHealth();
        if (isServerReachable) {
            // ëŒ€ê¸° ì¤‘ì¸ ë©”ëª¨ê°€ ìˆìœ¼ë©´ ë™ê¸°í™” ì‹œë„
            const pendingCount = await getPendingMemoCount();
            if (pendingCount > 0) {
                await offlineMemoService.syncPendingMemos();
            }
        }
    }
}, 30000); // 30ì´ˆë§ˆë‹¤ í™•ì¸
```

**2. ë™ê¸°í™” ì‹¤íŒ¨ ì‹œ ìë™ ì¬ì‹œë„**
```javascript
// ì´ë¯¸ êµ¬í˜„ë¨: Exponential Backoff ì¬ì‹œë„
// 5ì´ˆ, 10ì´ˆ, 20ì´ˆ í›„ ìë™ ì¬ì‹œë„
```

---

## ê¸°ìˆ  ìŠ¤íƒ ë° ì•„í‚¤í…ì²˜

### í´ë¼ì´ì–¸íŠ¸ ì¸¡ ê¸°ìˆ 

#### 1. ë¡œì»¬ ì €ì¥ì†Œ ì„ íƒ

**IndexedDB ì‚¬ìš©** â­
- âœ… ëŒ€ìš©ëŸ‰ ë°ì´í„° ì €ì¥ ê°€ëŠ¥
- âœ… ë¹„ë™ê¸° API (ë…¼ë¸”ë¡œí‚¹)
- âœ… êµ¬ì¡°í™”ëœ ë°ì´í„° ì €ì¥
- âœ… ë³µì¡í•œ ì¿¼ë¦¬ ì§€ì›
- âš ï¸ êµ¬í˜„ ë³µì¡ë„ ë†’ìŒ

**ì„ íƒ ì´ìœ **: ìš©ëŸ‰ ì œí•œ ì—†ê³ , ë©”ëª¨ê°€ ë§ì•„ì§ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ IndexedDBë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

#### 2. ë™ê¸°í™” í ê´€ë¦¬

```javascript
// ë™ê¸°í™” í êµ¬ì¡°
{
  id: "sync-queue-item-id",        // ê³ ìœ  ID
  type: "CREATE" | "UPDATE" | "DELETE",  // ì‘ì—… íƒ€ì…
  localMemoId: "local-memo-id",    // ë¡œì»¬ ì„ì‹œ ID (CREATE/UPDATE/DELETE ëª¨ë‘)
  serverMemoId: number | null,     // ì„œë²„ ë©”ëª¨ ID (UPDATE/DELETE ì‹œ í•„ìˆ˜)
  data: object,                     // ìš”ì²­ ë°ì´í„°
    // CREATE: MemoCreateRequest
    // UPDATE: MemoUpdateRequest (id, content, tags, pageNumber, memoStartTime)
    // DELETE: { id: number }
  status: "PENDING",                // PENDING, SYNCING, SUCCESS, FAILED
  retryCount: 0,                    // ì¬ì‹œë„ íšŸìˆ˜
  createdAt: Date,                  // ìƒì„± ì‹œê°„
  lastRetryAt: Date                 // ë§ˆì§€ë§‰ ì¬ì‹œë„ ì‹œê°„
}
```

#### 3. ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ê°ì§€

- `navigator.onLine` API
- `online` / `offline` ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
- ì£¼ê¸°ì ì¸ í—¬ìŠ¤ì²´í¬ (ì„ íƒì‚¬í•­)

#### 4. Service Worker â­ (í•„ìˆ˜)

**Service Workerë€**:
- ë¸Œë¼ìš°ì € ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ ì›Œì»¤
- ì›¹ í˜ì´ì§€ì™€ ë„¤íŠ¸ì›Œí¬ ì‚¬ì´ì˜ í”„ë¡ì‹œ ì—­í• ì„ ìˆ˜í–‰
- ëª¨ë“  ë‚˜ê°€ëŠ” ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ê°€ë¡œì±„ê³ (intercept) ì œì–´ ê°€ëŠ¥

**ì‚¬ìš© ê²°ì • ì´ìœ **:

1. **í˜ì´ì§€ ì¢…ë£Œ í›„ ë™ê¸°í™” ì§€ì›**
   - Background Sync APIë¥¼ í†µí•œ í˜ì´ì§€ ì¢…ë£Œ í›„ì—ë„ ë™ê¸°í™” ê°€ëŠ¥
   - ì‚¬ìš©ìê°€ í˜ì´ì§€ë¥¼ ë‹«ì•„ë„ ë©”ëª¨ ë™ê¸°í™”ê°€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì§„í–‰
   - ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìë™ìœ¼ë¡œ ë™ê¸°í™” ì¬ì‹œë„

2. **ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì— ëŒ€í•œ ì„¸ë°€í•œ ì œì–´**
   - ë©”ëª¨ ë°ì´í„°ëŠ” ë…ì„œ ê¸°ë¡ ì‚¬ì´íŠ¸ì˜ í•µì‹¬ ë°ì´í„°
   - ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œ ì•ˆì •ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ì˜¨ë¼ì¸ ìƒíƒœì—ì„œ íš¨ìœ¨ì ìœ¼ë¡œ ì„œë²„ì™€ ë™ê¸°í™” í•„ìš”
   - ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì‹¤íŒ¨ ì‹œ ìë™ ì¬ì‹œë„, ìš°ì„ ìˆœìœ„ ê´€ë¦¬, ìš”ì²­ë³„ ì „ëµ ì ìš© ê°€ëŠ¥

3. **ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ**
   - í˜ì´ì§€ë¥¼ ë‹«ì•„ë„ ë™ê¸°í™” ì§„í–‰ìœ¼ë¡œ ì‚¬ìš©ì ëŒ€ê¸° ì‹œê°„ ê°ì†Œ
   - ë„¤íŠ¸ì›Œí¬ ë¶ˆì•ˆì • ì‹œ ìë™ ì¬ì‹œë„ë¡œ ë°ì´í„° ì†ì‹¤ ë°©ì§€

**ì£¼ìš” ê¸°ëŠ¥**:

1. **Background Sync API**
   - í˜ì´ì§€ê°€ ë‹«í˜€ë„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë™ê¸°í™” ì‘ì—… ìˆ˜í–‰
   - ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìë™ìœ¼ë¡œ ë™ê¸°í™” ì¬ì‹œë„

2. **ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ê°€ë¡œì±„ê¸° (Fetch API)**
   - ëª¨ë“  ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ Service Workerê°€ ë¨¼ì € ì²˜ë¦¬
   - ìš”ì²­ë³„ ì¬ì‹œë„ ì „ëµ, ìš°ì„ ìˆœìœ„ ê´€ë¦¬ ê°€ëŠ¥
   - **Failure Handling**: ë„¤íŠ¸ì›Œí¬ ì‹¤íŒ¨ ì‹œ ìë™ìœ¼ë¡œ IndexedDB ë™ê¸°í™” í(Outbox)ì— ì €ì¥

3. **ìºì‹œëœ ì‘ë‹µ ì œê³µ**
   - ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œ ìºì‹œëœ ë°ì´í„° ë°˜í™˜
   - ë©”ëª¨ ì¡°íšŒ(GET) ìš”ì²­ì— í™œìš© ê°€ëŠ¥ (ì„ íƒì )
   - **íƒœê·¸ ë°ì´í„° ìºì‹± (í•„ìˆ˜)**: Service Workerì˜ Cache-First ì „ëµìœ¼ë¡œ íƒœê·¸ ëª©ë¡ ìºì‹±
   - **ë‚´ ì„œì¬ ì •ë³´ ìºì‹± (í•„ìˆ˜)**: Service Workerì˜ Stale-While-Revalidate ì „ëµìœ¼ë¡œ ë‚´ ì„œì¬ ì •ë³´ ìºì‹±

**êµ¬í˜„ ì˜ˆì‹œ**:

```javascript
// service-worker.js

// 1. Background Sync: í˜ì´ì§€ ì¢…ë£Œ í›„ ë™ê¸°í™”
self.addEventListener('sync', (event) => {
    if (event.tag === 'sync-memos') {
        event.waitUntil(syncPendingMemos());
    }
});

// 2. ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ê°€ë¡œì±„ê¸°: ë©”ëª¨ ê´€ë ¨ ìš”ì²­ ì œì–´
self.addEventListener('fetch', (event) => {
    // ë©”ëª¨ ê´€ë ¨ ìš”ì²­ë§Œ ì²˜ë¦¬
    if (event.request.url.includes('/api/v1/memos')) {
        event.respondWith(
            fetch(event.request)
                .then(response => {
                    // ì„±ê³µ ì‹œ ì‘ë‹µ ì²˜ë¦¬
                    if (response.ok && event.request.method === 'GET') {
                        // GET ìš”ì²­ì€ ì„ íƒì ìœ¼ë¡œ ìºì‹± (ìµœê·¼ ë©”ëª¨ ì¡°íšŒìš©)
                        const responseClone = response.clone();
                        caches.open('memos-cache').then(cache => {
                            cache.put(event.request, responseClone);
                        });
                    }
                    return response;
                })
                .catch(error => {
                    // ë„¤íŠ¸ì›Œí¬ ì‹¤íŒ¨ ì‹œ ì²˜ë¦¬ (Failure Handling)
                    // POST ìš”ì²­(ë©”ëª¨ ì‘ì„±)ì˜ ê²½ìš°: IndexedDB ë™ê¸°í™” íì— ì €ì¥
                    if (event.request.method === 'POST') {
                        return handleFailedPostRequest(event.request);
                    }
                    // PUT ìš”ì²­(ë©”ëª¨ ìˆ˜ì •)ì˜ ê²½ìš°: IndexedDB ë™ê¸°í™” íì— ì €ì¥
                    if (event.request.method === 'PUT') {
                        return handleFailedPutRequest(event.request);
                    }
                    // DELETE ìš”ì²­(ë©”ëª¨ ì‚­ì œ)ì˜ ê²½ìš°: IndexedDB ë™ê¸°í™” íì— ì €ì¥
                    if (event.request.method === 'DELETE') {
                        return handleFailedDeleteRequest(event.request);
                    }
                    // GET ìš”ì²­ì˜ ê²½ìš°: ìºì‹œì—ì„œ ë°˜í™˜ ë˜ëŠ” ì—ëŸ¬ ì²˜ë¦¬
                    return handleFailedGetRequest(event.request, error);
                })
        );
    } else if (event.request.url.includes('/api/v1/tags') && 
               event.request.method === 'GET') {
        // íƒœê·¸ ë°ì´í„° ìºì‹±: Service Workerì˜ Cache-First ì „ëµ
        event.respondWith(
            caches.open('tags-cache-v1').then(cache => {
                return cache.match(event.request).then(cachedResponse => {
                    // 1. ìºì‹œì— ìˆìœ¼ë©´ ì¦‰ì‹œ ë°˜í™˜ (Cache-First)
                    if (cachedResponse) {
                        return cachedResponse;
                    }
                    
                    // 2. ì—†ìœ¼ë©´ ë„¤íŠ¸ì›Œí¬ ìš”ì²­
                    return fetch(event.request).then(response => {
                        // 3. ì„±ê³µ ì‹œ ìºì‹œì— ì €ì¥
                        if (response.ok) {
                            cache.put(event.request, response.clone());
                        }
                        return response;
                    }).catch(error => {
                        // 4. ë„¤íŠ¸ì›Œí¬ ì‹¤íŒ¨ ì‹œ ìºì‹œì—ì„œ ë°˜í™˜ (ì˜¤í”„ë¼ì¸ ì§€ì›)
                        return cachedResponse || new Response(JSON.stringify({
                            ok: false,
                            error: 'íƒœê·¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
                        }), {
                            status: 503,
                            headers: { 'Content-Type': 'application/json' }
                        });
                    });
                });
            })
        );
    } else if (event.request.url.includes('/api/v1/user/books') && 
               event.request.method === 'GET') {
        // ë‚´ ì„œì¬ ì •ë³´ ìºì‹±: Service Workerì˜ Stale-While-Revalidate ì „ëµ
        event.respondWith(
            caches.open('user-shelf-cache-v1').then(cache => {
                return cache.match(event.request).then(cachedResponse => {
                    // 1. ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì‹œì‘ (ìµœì‹ ì„± ë³´ì¥)
                    const fetchPromise = fetch(event.request).then(response => {
                        // 2. ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì´ ì„±ê³µí•˜ë©´ ìºì‹œ ì—…ë°ì´íŠ¸
                        if (response.ok) {
                            cache.put(event.request, response.clone());
                        }
                        return response;
                    }).catch(error => {
                        console.error('ë‚´ ì„œì¬ ì •ë³´ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì‹¤íŒ¨:', error);
                        // ë„¤íŠ¸ì›Œí¬ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ëŠ” ë¬´ì‹œ (ìºì‹œ ì‘ë‹µ ì‚¬ìš©)
                    });
                    
                    // 3. ìºì‹œì— ìˆìœ¼ë©´ ì¦‰ì‹œ ë°˜í™˜ (Stale í—ˆìš©)
                    if (cachedResponse) {
                        // ë°±ê·¸ë¼ìš´ë“œ ì—…ë°ì´íŠ¸ëŠ” ê³„ì† ì§„í–‰
                        return cachedResponse;
                    }
                    
                    // 4. ìºì‹œê°€ ì—†ìœ¼ë©´ ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ ëŒ€ê¸°
                    return fetchPromise.then(response => {
                        if (response.ok) {
                            // ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì„ ìºì‹œì— ì €ì¥
                            cache.put(event.request, response.clone());
                        }
                        return response;
                    }).catch(error => {
                        // ë„¤íŠ¸ì›Œí¬ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ì‘ë‹µ
                        return new Response(JSON.stringify({
                            ok: false,
                            error: 'ë‚´ ì„œì¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
                        }), {
                            status: 503,
                            headers: { 'Content-Type': 'application/json' }
                        });
                    });
                });
            })
        );
    } else {
        // ê¸°íƒ€ ìš”ì²­ì€ ê·¸ëŒ€ë¡œ ì „ë‹¬
        event.respondWith(fetch(event.request));
    }
});

// POST ìš”ì²­ ì‹¤íŒ¨ ì²˜ë¦¬: IndexedDB ë™ê¸°í™” í(Outbox)ì— ì €ì¥
async function handleFailedPostRequest(request) {
    try {
        // ìš”ì²­ ë³¸ë¬¸ íŒŒì‹±
        const requestBody = await request.clone().json();
        
        // IndexedDBì— ë™ê¸°í™” í í•­ëª©ìœ¼ë¡œ ì €ì¥
        const queueItem = {
            id: generateId(),
            type: 'CREATE',
            data: requestBody,
            status: 'PENDING',
            retryCount: 0,
            error: null,
            createdAt: new Date().toISOString(),
            lastRetryAt: null,
            requestUrl: request.url,
            requestMethod: request.method
        };
        
        // IndexedDBì— ì €ì¥
        await saveToSyncQueue(queueItem);
        
        // Background Sync ë“±ë¡ (ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìë™ ì¬ì‹œë„)
        if ('sync' in self.registration) {
            await self.registration.sync.register('sync-memos');
        }
        
        // ì„±ê³µ ì‘ë‹µ ë°˜í™˜ (ì‚¬ìš©ìì—ê²ŒëŠ” ì„±ê³µì²˜ëŸ¼ ë³´ì´ê²Œ)
        return new Response(JSON.stringify({
            ok: true,
            message: 'ë©”ëª¨ê°€ ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìë™ ë™ê¸°í™”ë©ë‹ˆë‹¤.'
        }), {
            status: 200,
            headers: { 'Content-Type': 'application/json' }
        });
    } catch (error) {
        console.error('Failed to save request to sync queue:', error);
        // ì‹¤íŒ¨ ì‹œ ì›ë˜ ì—ëŸ¬ ë°˜í™˜
        return new Response(JSON.stringify({
            ok: false,
            error: 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë° ë¡œì»¬ ì €ì¥ ì‹¤íŒ¨'
        }), {
            status: 500,
            headers: { 'Content-Type': 'application/json' }
        });
    }
}

// PUT ìš”ì²­ ì‹¤íŒ¨ ì²˜ë¦¬: IndexedDB ë™ê¸°í™” í(Outbox)ì— ì €ì¥
async function handleFailedPutRequest(request) {
    try {
        // ìš”ì²­ ë³¸ë¬¸ íŒŒì‹±
        const requestBody = await request.clone().json();
        
        // URLì—ì„œ ë©”ëª¨ ID ì¶”ì¶œ (ì˜ˆ: /api/v1/memos/123)
        const urlParts = request.url.split('/');
        const memoId = urlParts[urlParts.length - 1];
        
        // IndexedDBì— ë™ê¸°í™” í í•­ëª©ìœ¼ë¡œ ì €ì¥
        const queueItem = {
            id: generateId(),
            type: 'UPDATE',
            serverMemoId: parseInt(memoId),
            data: requestBody,
            status: 'PENDING',
            retryCount: 0,
            error: null,
            createdAt: new Date().toISOString(),
            lastRetryAt: null,
            requestUrl: request.url,
            requestMethod: request.method
        };
        
        // IndexedDBì— ì €ì¥
        await saveToSyncQueue(queueItem);
        
        // Background Sync ë“±ë¡ (ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìë™ ì¬ì‹œë„)
        if ('sync' in self.registration) {
            await self.registration.sync.register('sync-memos');
        }
        
        // ì„±ê³µ ì‘ë‹µ ë°˜í™˜ (ì‚¬ìš©ìì—ê²ŒëŠ” ì„±ê³µì²˜ëŸ¼ ë³´ì´ê²Œ)
        return new Response(JSON.stringify({
            ok: true,
            message: 'ë©”ëª¨ ìˆ˜ì •ì´ ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìë™ ë™ê¸°í™”ë©ë‹ˆë‹¤.'
        }), {
            status: 200,
            headers: { 'Content-Type': 'application/json' }
        });
    } catch (error) {
        console.error('Failed to save PUT request to sync queue:', error);
        return new Response(JSON.stringify({
            ok: false,
            error: 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë° ë¡œì»¬ ì €ì¥ ì‹¤íŒ¨'
        }), {
            status: 500,
            headers: { 'Content-Type': 'application/json' }
        });
    }
}

// DELETE ìš”ì²­ ì‹¤íŒ¨ ì²˜ë¦¬: IndexedDB ë™ê¸°í™” í(Outbox)ì— ì €ì¥
async function handleFailedDeleteRequest(request) {
    try {
        // URLì—ì„œ ë©”ëª¨ ID ì¶”ì¶œ (ì˜ˆ: /api/v1/memos/123)
        const urlParts = request.url.split('/');
        const memoId = urlParts[urlParts.length - 1];
        
        // IndexedDBì— ë™ê¸°í™” í í•­ëª©ìœ¼ë¡œ ì €ì¥
        const queueItem = {
            id: generateId(),
            type: 'DELETE',
            serverMemoId: parseInt(memoId),
            data: { id: parseInt(memoId) },
            status: 'PENDING',
            retryCount: 0,
            error: null,
            createdAt: new Date().toISOString(),
            lastRetryAt: null,
            requestUrl: request.url,
            requestMethod: request.method
        };
        
        // IndexedDBì— ì €ì¥
        await saveToSyncQueue(queueItem);
        
        // Background Sync ë“±ë¡ (ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìë™ ì¬ì‹œë„)
        if ('sync' in self.registration) {
            await self.registration.sync.register('sync-memos');
        }
        
        // ì„±ê³µ ì‘ë‹µ ë°˜í™˜ (ì‚¬ìš©ìì—ê²ŒëŠ” ì„±ê³µì²˜ëŸ¼ ë³´ì´ê²Œ)
        return new Response(JSON.stringify({
            ok: true,
            message: 'ë©”ëª¨ ì‚­ì œê°€ ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìë™ ë™ê¸°í™”ë©ë‹ˆë‹¤.'
        }), {
            status: 200,
            headers: { 'Content-Type': 'application/json' }
        });
    } catch (error) {
        console.error('Failed to save DELETE request to sync queue:', error);
        return new Response(JSON.stringify({
            ok: false,
            error: 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë° ë¡œì»¬ ì €ì¥ ì‹¤íŒ¨'
        }), {
            status: 500,
            headers: { 'Content-Type': 'application/json' }
        });
    }
}

// GET ìš”ì²­ ì‹¤íŒ¨ ì²˜ë¦¬: ìºì‹œì—ì„œ ë°˜í™˜
async function handleFailedGetRequest(request, error) {
    // ìºì‹œì—ì„œ ì‘ë‹µ ì°¾ê¸°
    const cachedResponse = await caches.match(request);
    if (cachedResponse) {
        return cachedResponse;
    }
    // ìºì‹œê°€ ì—†ìœ¼ë©´ ì—ëŸ¬ ë°˜í™˜
    return new Response(JSON.stringify({
        ok: false,
        error: 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë° ìºì‹œ ì—†ìŒ'
    }), {
        status: 503,
        headers: { 'Content-Type': 'application/json' }
    });
}

// IndexedDB ë™ê¸°í™” íì— ì €ì¥ (Service Worker ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‹¤í–‰)
async function saveToSyncQueue(queueItem) {
    return new Promise((resolve, reject) => {
        const request = indexedDB.open('reading-tracker', 1);
        request.onsuccess = () => {
            const db = request.result;
            const transaction = db.transaction(['sync_queue'], 'readwrite');
            const store = transaction.objectStore('sync_queue');
            const putRequest = store.put(queueItem);
            putRequest.onsuccess = () => resolve();
            putRequest.onerror = () => reject(putRequest.error);
        };
        request.onerror = () => reject(request.error);
    });
}

function generateId() {
    return 'sync-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
}

// 3. ë™ê¸°í™” í•¨ìˆ˜ (Service Worker ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‹¤í–‰)
// Sync Strategy: ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìˆœì„œëŒ€ë¡œ ìš”ì²­ ì¬ì „ì†¡(Replay)
async function syncPendingMemos() {
    // 1. ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸
    if (!await checkNetworkStatus()) {
        console.log('ë„¤íŠ¸ì›Œí¬ê°€ ì˜¤í”„ë¼ì¸ ìƒíƒœì…ë‹ˆë‹¤. ë™ê¸°í™” ëŒ€ê¸°...');
        return;
    }
    
    // 2. IndexedDBì—ì„œ ëŒ€ê¸° ì¤‘ì¸ ë™ê¸°í™” í í•­ëª© ì¡°íšŒ
    const pendingQueueItems = await getPendingQueueItemsFromIndexedDB();
    
    if (pendingQueueItems.length === 0) {
        console.log('ë™ê¸°í™”í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    
    // 3. ìˆœì„œ ë³´ì¥: memoStartTime ë˜ëŠ” createdAt ê¸°ì¤€ ì •ë ¬
    pendingQueueItems.sort((a, b) => {
        const timeA = new Date(a.data.memoStartTime || a.createdAt);
        const timeB = new Date(b.data.memoStartTime || b.createdAt);
        return timeA - timeB;
    });
    
    console.log(`ë™ê¸°í™”í•  í•­ëª© ìˆ˜: ${pendingQueueItems.length}`);
    
    // 4. ìˆœì°¨ì ìœ¼ë¡œ ë™ê¸°í™” (Replay)
    for (const queueItem of pendingQueueItems) {
        try {
            // ë™ê¸°í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            await updateQueueItemStatus(queueItem.id, 'SYNCING');
            
            // 5. ì›ë³¸ ìš”ì²­ ì¬í˜„(Replay): ë™ê¸°í™” íì˜ ë°ì´í„°ë¡œ API í˜¸ì¶œ
            const response = await replayRequest(queueItem);
            
            if (response.ok) {
                // ì„±ê³µ: ë™ê¸°í™” í í•­ëª© ìƒíƒœë¥¼ SUCCESSë¡œ ì—…ë°ì´íŠ¸
                await updateQueueItemStatus(queueItem.id, 'SUCCESS');
                console.log(`ë™ê¸°í™” ì„±ê³µ: ${queueItem.id}`);
            } else {
                // ì‹¤íŒ¨: ì¬ì‹œë„ ë¡œì§ ì ìš©
                throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`);
            }
        } catch (error) {
            console.error(`ë™ê¸°í™” ì‹¤íŒ¨ (${queueItem.id}):`, error);
            
            // ì¬ì‹œë„ ë¡œì§: Exponential Backoff
            await handleSyncFailure(queueItem, error);
        }
    }
}

// ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸ (Service Worker ì»¨í…ìŠ¤íŠ¸)
async function checkNetworkStatus() {
    try {
        // ì‹¤ì œ ì„œë²„ ì—°ê²° ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸ (í—¬ìŠ¤ì²´í¬)
        const response = await fetch('/api/v1/health', {
            method: 'HEAD',
            signal: AbortSignal.timeout(3000) // 3ì´ˆ íƒ€ì„ì•„ì›ƒ
        });
        return response.ok;
    } catch (error) {
        return false;
    }
}

// ë™ê¸°í™” í í•­ëª© ì¡°íšŒ (Service Worker ì»¨í…ìŠ¤íŠ¸)
async function getPendingQueueItemsFromIndexedDB() {
    return new Promise((resolve, reject) => {
        const request = indexedDB.open('reading-tracker', 1);
        request.onsuccess = () => {
            const db = request.result;
            const transaction = db.transaction(['sync_queue'], 'readonly');
            const store = transaction.objectStore('sync_queue');
            const index = store.index('status');
            const getAllRequest = index.getAll('PENDING');
            getAllRequest.onsuccess = () => resolve(getAllRequest.result || []);
            getAllRequest.onerror = () => reject(getAllRequest.error);
        };
        request.onerror = () => reject(request.error);
    });
}

// ì›ë³¸ ìš”ì²­ ì¬í˜„(Replay): ë™ê¸°í™” íì˜ ë°ì´í„°ë¡œ API í˜¸ì¶œ
async function replayRequest(queueItem) {
    const { type, serverMemoId, data, requestUrl, requestMethod } = queueItem;
    
    let url, method, body;
    
    // íƒ€ì…ì— ë”°ë¼ URLê³¼ ë©”ì„œë“œ ê²°ì •
    switch (type) {
        case 'CREATE':
            url = '/api/v1/memos';
            method = 'POST';
            body = JSON.stringify(data);
            break;
        case 'UPDATE':
            url = `/api/v1/memos/${serverMemoId}`;
            method = 'PUT';
            body = JSON.stringify(data);
            break;
        case 'DELETE':
            url = `/api/v1/memos/${serverMemoId}`;
            method = 'DELETE';
            body = null;
            break;
        default:
            // ê¸°ì¡´ ë°©ì‹ (requestUrl, requestMethod ì‚¬ìš©)
            url = requestUrl || '/api/v1/memos';
            method = requestMethod || 'POST';
            body = data ? JSON.stringify(data) : null;
    }
    
    return fetch(url, {
        method: method,
        headers: {
            'Content-Type': 'application/json',
            // Authorization í—¤ë”ëŠ” Service Workerì—ì„œ ê´€ë¦¬
            'Authorization': await getAuthToken()
        },
        body: body
    });
}

// ë™ê¸°í™” í í•­ëª© ìƒíƒœ ì—…ë°ì´íŠ¸
async function updateQueueItemStatus(queueItemId, status) {
    return new Promise((resolve, reject) => {
        const request = indexedDB.open('reading-tracker', 1);
        request.onsuccess = () => {
            const db = request.result;
            const transaction = db.transaction(['sync_queue'], 'readwrite');
            const store = transaction.objectStore('sync_queue');
            const getRequest = store.get(queueItemId);
            getRequest.onsuccess = () => {
                const item = getRequest.result;
                if (item) {
                    item.status = status;
                    item.updatedAt = new Date().toISOString();
                    if (status === 'SYNCING') {
                        item.lastRetryAt = new Date().toISOString();
                    }
                    const putRequest = store.put(item);
                    putRequest.onsuccess = () => resolve();
                    putRequest.onerror = () => reject(putRequest.error);
                } else {
                    resolve();
                }
            };
            getRequest.onerror = () => reject(getRequest.error);
        };
        request.onerror = () => reject(request.error);
    });
}

// ë™ê¸°í™” ì‹¤íŒ¨ ì²˜ë¦¬: Exponential Backoff ì¬ì‹œë„
async function handleSyncFailure(queueItem, error) {
    const retryCount = (queueItem.retryCount || 0) + 1;
    const maxRetries = 3;
    
    if (retryCount < maxRetries) {
        // ì¬ì‹œë„ ì˜ˆì•½: Exponential Backoff (5ì´ˆ, 10ì´ˆ, 20ì´ˆ)
        const delay = 5000 * Math.pow(2, retryCount - 1);
        
        // í í•­ëª© ì—…ë°ì´íŠ¸
        await updateQueueItemWithRetry(queueItem.id, retryCount, error.message);
        
        // ì§€ì—° í›„ ì¬ì‹œë„
        setTimeout(async () => {
            // Background Sync ì¬ë“±ë¡
            if ('sync' in self.registration) {
                await self.registration.sync.register('sync-memos');
            }
        }, delay);
    } else {
        // ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼: ì‹¤íŒ¨ ìƒíƒœë¡œ í‘œì‹œ
        await updateQueueItemStatus(queueItem.id, 'FAILED');
        console.error(`ë™ê¸°í™” ìµœì¢… ì‹¤íŒ¨ (ì¬ì‹œë„ ${retryCount}íšŒ): ${queueItem.id}`);
    }
}
```

**í˜ì´ì§€ì—ì„œ Service Worker ë“±ë¡**:

```javascript
// app.js ë˜ëŠ” main.js
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js')
        .then(registration => {
            console.log('Service Worker ë“±ë¡ ì„±ê³µ');
            
            // ë™ê¸°í™” ìš”ì²­ ë“±ë¡
            if ('sync' in registration) {
                // Background Sync ì§€ì›
                registration.sync.register('sync-memos');
            } else {
                // í´ë°±: online ì´ë²¤íŠ¸ ì‚¬ìš©
                window.addEventListener('online', () => {
                    syncPendingMemos();
                });
            }
        })
        .catch(error => {
            console.error('Service Worker ë“±ë¡ ì‹¤íŒ¨:', error);
        });
}
```

**ì¥ì **:
- âœ… í˜ì´ì§€ê°€ ë‹«í˜€ë„ ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ê°€ëŠ¥ (Background Sync)
- âœ… ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì— ëŒ€í•œ ì •êµí•œ ì œì–´ (ì¬ì‹œë„, ìš°ì„ ìˆœìœ„ ê´€ë¦¬)
- âœ… ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œë„ ìºì‹œëœ ë¦¬ì†ŒìŠ¤ ì œê³µ (ì„ íƒì )
- âœ… ë©”ëª¨ ë°ì´í„°ì˜ ì•ˆì •ì ì¸ ë™ê¸°í™” ë³´ì¥

**Failure Handling (ë„¤íŠ¸ì›Œí¬ ì‹¤íŒ¨ ì²˜ë¦¬)**:

**ì§ˆë¬¸**: ì‚¬ìš©ìê°€ ë©”ëª¨ ì‘ì„± í›„ 'ì €ì¥' ë²„íŠ¼ì„ ëˆŒë €ëŠ”ë° ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ì—†ëŠ” ê²½ìš°, Service WorkerëŠ” ì´ ìš”ì²­(API Call)ì„ ê°€ë¡œì±„ê³  **IndexedDBì˜ ë™ê¸°í™” í(Outbox)**ì— ì €ì¥í•©ë‹ˆê¹Œ?

**ë‹µë³€**: âœ… **ì˜ˆ, ì €ì¥í•©ë‹ˆë‹¤.**

**ë™ì‘ íë¦„**:

1. **ì‚¬ìš©ìê°€ 'ì €ì¥' ë²„íŠ¼ í´ë¦­**
   ```javascript
   // í˜ì´ì§€ì—ì„œ ì¼ë°˜ API í˜¸ì¶œ
   fetch('/api/v1/memos', {
       method: 'POST',
       headers: { 'Content-Type': 'application/json' },
       body: JSON.stringify({
           userBookId: 123,
           pageNumber: 50,
           content: "ë©”ëª¨ ë‚´ìš©",
           tags: ["íƒœê·¸1"],
           memoStartTime: "2024-01-01T10:30:00Z"
       })
   });
   ```

2. **Service Workerê°€ ìš”ì²­ ê°€ë¡œì±„ê¸°**
   ```javascript
   // Service Workerì˜ fetch ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬
   self.addEventListener('fetch', (event) => {
       if (event.request.url.includes('/api/v1/memos')) {
           event.respondWith(
               fetch(event.request)
                   .catch(error => {
                       // ë„¤íŠ¸ì›Œí¬ ì‹¤íŒ¨ ì‹œ IndexedDB ë™ê¸°í™” íì— ì €ì¥
                       if (event.request.method === 'POST') {
                           return handleFailedPostRequest(event.request);
                       }
                   })
           );
       }
   });
   ```

3. **ë„¤íŠ¸ì›Œí¬ ì‹¤íŒ¨ ì‹œ IndexedDB ë™ê¸°í™” í(Outbox)ì— ì €ì¥**
   - ìš”ì²­ ë³¸ë¬¸ì„ íŒŒì‹±í•˜ì—¬ ë™ê¸°í™” í í•­ëª© ìƒì„±
   - IndexedDBì˜ `sync_queue` í…Œì´ë¸”ì— ì €ì¥
   - Background Sync ë“±ë¡ (ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìë™ ì¬ì‹œë„)
   - ì‚¬ìš©ìì—ê²ŒëŠ” ì„±ê³µ ì‘ë‹µ ë°˜í™˜ (ë‚™ê´€ì  ì—…ë°ì´íŠ¸)

**êµ¬í˜„ ì˜ˆì‹œ** (ìœ„ ì½”ë“œì— í¬í•¨ë¨):
```javascript
// POST ìš”ì²­ ì‹¤íŒ¨ ì²˜ë¦¬: IndexedDB ë™ê¸°í™” í(Outbox)ì— ì €ì¥
async function handleFailedPostRequest(request) {
    // ìš”ì²­ ë³¸ë¬¸ íŒŒì‹±
    const requestBody = await request.clone().json();
    
    // IndexedDBì— ë™ê¸°í™” í í•­ëª©ìœ¼ë¡œ ì €ì¥
    const queueItem = {
        id: generateId(),
        type: 'CREATE',
        data: requestBody,
        status: 'PENDING',
        retryCount: 0,
        error: null,
        createdAt: new Date().toISOString(),
        lastRetryAt: null,
        requestUrl: request.url,
        requestMethod: request.method
    };
    
    // IndexedDBì— ì €ì¥
    await saveToSyncQueue(queueItem);
    
    // Background Sync ë“±ë¡ (ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìë™ ì¬ì‹œë„)
    if ('sync' in self.registration) {
        await self.registration.sync.register('sync-memos');
    }
    
    // ì„±ê³µ ì‘ë‹µ ë°˜í™˜ (ì‚¬ìš©ìì—ê²ŒëŠ” ì„±ê³µì²˜ëŸ¼ ë³´ì´ê²Œ)
    return new Response(JSON.stringify({
        ok: true,
        message: 'ë©”ëª¨ê°€ ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìë™ ë™ê¸°í™”ë©ë‹ˆë‹¤.'
    }), {
        status: 200,
        headers: { 'Content-Type': 'application/json' }
    });
}
```

**ì¥ì **:
- âœ… ì‚¬ìš©ìê°€ ì¼ë°˜ API í˜¸ì¶œë§Œ í•˜ë©´ ë¨ (ì˜¤í”„ë¼ì¸ ì²˜ë¦¬ ë¡œì§ ë¶ˆí•„ìš”)
- âœ… Service Workerê°€ ìë™ìœ¼ë¡œ ì˜¤í”„ë¼ì¸ ì²˜ë¦¬
- âœ… ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìë™ ì¬ì‹œë„
- âœ… ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ (ë‚™ê´€ì  ì—…ë°ì´íŠ¸)

**ì°¸ê³ **: ë³¸ í”„ë¡œì íŠ¸ì—ì„œëŠ” **í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ ë°©ì‹**ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:
- **ë©”ëª¨ ì‘ì„± ì‹œ**: ë¨¼ì € IndexedDBì— ì €ì¥í•˜ê³  ë™ê¸°í™” íì— ì¶”ê°€ (Offline-First)
- **Service Worker**: Background Syncë¥¼ í†µí•´ ë‚˜ì¤‘ì— ë™ê¸°í™”
- **ë„¤íŠ¸ì›Œí¬ ì‹¤íŒ¨ ì‹œ**: Service Workerê°€ ì¶”ê°€ë¡œ ë™ê¸°í™” íì— ì €ì¥í•˜ì—¬ ì´ì¤‘ ë³´ì¥

**íƒœê·¸ ë°ì´í„° ìºì‹± ì „ëµ** â­ (í´ë¼ì´ì–¸íŠ¸ ì¸¡: Service Worker):

**âš ï¸ ë ˆì´ì–´ë³„ ìš©ì–´ êµ¬ë¶„**:
- **Cache-First, Stale-While-Revalidate**: í´ë¼ì´ì–¸íŠ¸(Service Worker)ì˜ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì²˜ë¦¬ ë¡œì§ì„ ì„¤ëª…í•˜ëŠ” ìš©ì–´
- **Redis ìºì‹œì˜ TTL**: ì„œë²„(Redis)ì˜ ë°ì´í„° ì €ì¥ ë° ê´€ë¦¬ ì •ì±…ì„ ì„¤ëª…í•˜ëŠ” ìš©ì–´
- ì´ ì„¹ì…˜ì€ **í´ë¼ì´ì–¸íŠ¸ ì¸¡(Service Worker)**ì˜ ìºì‹± ì „ëµì„ ì„¤ëª…í•©ë‹ˆë‹¤.
- ì„œë²„ ì¸¡(Redis) ìºì‹± ì •ì±…ì€ OFFLINE_SYNC_DATA_INTEGRITY_ANALYSIS.md ë¬¸ì„œ ì°¸ì¡°

**ë°ì´í„° ì„±ê²©**:
- **ê°œë°œì í†µì œ ê³µìœ  ìì›**: ê°œë°œìê°€ ì§ì ‘ DBë¥¼ ìˆ˜ì •í•˜ì§€ ì•ŠëŠ” í•œ ë³€ë™ì´ ì—†ìŒ
- **ì „ì—­ ê³µìœ  ë°ì´í„°**: ëª¨ë“  ì‚¬ìš©ìê°€ ë™ì¼í•œ íƒœê·¸ ë°ì´í„°ë¥¼ ì‚¬ìš©
- **ë³€ë™ì„±**: ê±°ì˜ ì—†ìŒ (ê°œë°œìê°€ ìˆ˜ë™ìœ¼ë¡œ ë³€ê²½í•  ë•Œë§Œ ë³€ë™)
- **ì˜¤í”„ë¼ì¸ í•„ìˆ˜ ë°ì´í„°**: ì˜¤í”„ë¼ì¸ ë©”ëª¨ ì‘ì„± ì‹œ ë°˜ë“œì‹œ í•„ìš”í•œ ë°ì´í„°

**ì „ëµ ì„ íƒ**: **Service Workerì˜ Stale-While-Revalidate (SWR) ì „ëµ + Etag ê¸°ë°˜ ê²€ì¦** ì‚¬ìš©

**ì „ëµ ì„ íƒ ì´ìœ **:

1. **ì˜¤í”„ë¼ì¸ ìš°ì„ ì„± (Offline-First)**
   - íƒœê·¸ëŠ” ì˜¤í”„ë¼ì¸ ë©”ëª¨ ì‘ì„± ì‹œ ë°˜ë“œì‹œ í•„ìš”í•œ ë°ì´í„°
   - ìºì‹œëœ ë°ì´í„°(v1)ê°€ ìµœì‹  ìƒíƒœ(v2)ê°€ ì•„ë‹ˆë”ë¼ë„, ì˜¤í”„ë¼ì¸ í™˜ê²½ì—ì„œ ì‚¬ìš©ì ì‘ì—…ì„ ë§‰ì§€ ì•ŠëŠ” ê²ƒì´ ìµœìš°ì„ 
   - SWRì€ v1ì„ ë³´ì—¬ì£¼ë©´ì„œ ë°±ê·¸ë¼ìš´ë“œì—ì„œ v2ë¥¼ ê°€ì ¸ì™€ ë‹¤ìŒë²ˆ ì‚¬ìš©ì„ ìœ„í•´ ìºì‹œë¥¼ ê°±ì‹ 
   - ì‚¬ìš©ìê°€ ìµœì‹  íƒœê·¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë”ë¼ë„ ì¦‰ì‹œ ì‘ì—…ì„ ì‹œì‘í•  ìˆ˜ ìˆê²Œ í•¨

2. **ë°ì´í„° ì¼ê´€ì„± ë³´ì¥**
   - Etag ê¸°ë°˜ ê²€ì¦ì„ ì¶”ê°€í•˜ì—¬ ìºì‹œëœ ë°ì´í„°ì˜ ìµœì‹ ì„± í™•ì¸
   - ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ìºì‹œ ê°±ì‹ 
   - ë‹¤ìŒ ìš”ì²­ ì‹œ ìµœì‹  ë°ì´í„° ì‚¬ìš© ê°€ëŠ¥

3. **ë³€ë™ì„± íŠ¹ì„± ë°˜ì˜**
   - íƒœê·¸ ë°ì´í„°ëŠ” ë³€ë™ì´ ê±°ì˜ ì—†ìœ¼ë¯€ë¡œ, ìºì‹œëœ ë°ì´í„°ê°€ ì˜¤ë˜ë˜ì–´ë„ ëŒ€ë¶€ë¶„ ìµœì‹  ìƒíƒœ
   - ê°œë°œìê°€ ë³€ê²½í–ˆì„ ë•Œë§Œ ìˆ˜ë™ìœ¼ë¡œ ë¬´íš¨í™”ë˜ë¯€ë¡œ, SWRë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ìµœì‹  ë°ì´í„° í™•ë³´ ê°€ëŠ¥

**êµ¬í˜„ ë°©ì‹** (Service Worker ì½”ë“œ):
```javascript
// íƒœê·¸ ë°ì´í„°: Service Workerì˜ Stale-While-Revalidate (SWR) ì „ëµ + Etag ê¸°ë°˜ ê²€ì¦
if (event.request.url.includes('/api/v1/tags') && 
    event.request.method === 'GET') {
    event.respondWith(
        caches.open('tags-cache-v1').then(cache => {
            return cache.match(event.request).then(cachedResponse => {
                // 1. ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì‹œì‘ (ìµœì‹ ì„± ë³´ì¥)
                const fetchPromise = fetch(event.request).then(response => {
                    if (response.ok) {
                        // 2. Etag ê¸°ë°˜ ê²€ì¦: ìºì‹œëœ ë°ì´í„°ì™€ ë¹„êµ
                        const cachedEtag = cachedResponse?.headers.get('ETag');
                        const newEtag = response.headers.get('ETag');
                        
                        // 3. Etagê°€ ë‹¤ë¥´ë©´ ìºì‹œ ì—…ë°ì´íŠ¸ (ë°ì´í„° ë³€ê²½ë¨)
                        if (cachedEtag !== newEtag) {
                            cache.put(event.request, response.clone());
                        }
                    }
                    return response;
                }).catch(error => {
                    console.error('íƒœê·¸ ë°ì´í„° ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì‹¤íŒ¨:', error);
                    // ë„¤íŠ¸ì›Œí¬ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ëŠ” ë¬´ì‹œ (ìºì‹œ ì‘ë‹µ ì‚¬ìš©)
                });
                
                // 4. ìºì‹œì— ìˆìœ¼ë©´ ì¦‰ì‹œ ë°˜í™˜ (Stale í—ˆìš© - ì˜¤í”„ë¼ì¸ ìš°ì„ )
                if (cachedResponse) {
                    // ë°±ê·¸ë¼ìš´ë“œ ì—…ë°ì´íŠ¸ëŠ” ê³„ì† ì§„í–‰
                    return cachedResponse;
                }
                
                // 5. ìºì‹œê°€ ì—†ìœ¼ë©´ ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ ëŒ€ê¸°
                return fetchPromise.then(response => {
                    if (response.ok) {
                        // ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì„ ìºì‹œì— ì €ì¥
                        cache.put(event.request, response.clone());
                    }
                    return response;
                }).catch(error => {
                    // ë„¤íŠ¸ì›Œí¬ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ì‘ë‹µ
                    return new Response(JSON.stringify({
                        ok: false,
                        error: 'íƒœê·¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
                    }), {
                        status: 503,
                        headers: { 'Content-Type': 'application/json' }
                    });
                });
            });
        })
    );
}
```

**ìºì‹œ ë¬´íš¨í™” ì „ëµ**:

**ì„œë²„ ì¸¡(Redis) ë¬´íš¨í™”**: Purger-Driven Invalidation
- ê°œë°œìê°€ íƒœê·¸ DBë¥¼ ë³€ê²½í•  ë•Œ ìˆ˜ë™ìœ¼ë¡œ Redis ìºì‹œë¥¼ ì‚­ì œ
- Redis TTLì€ 7ì¼ë¡œ ì„¤ì • (ë§¤ìš° ê¸´ ê¸°ê°„)
- ìì„¸í•œ ë‚´ìš©ì€ OFFLINE_SYNC_DATA_INTEGRITY_ANALYSIS.md ë¬¸ì„œ ì°¸ì¡°

**í´ë¼ì´ì–¸íŠ¸ ì¸¡(Service Worker) ë¬´íš¨í™”**: ìë™ ê°±ì‹ 
- SWR ì „ëµìœ¼ë¡œ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìë™ìœ¼ë¡œ ìµœì‹  ë°ì´í„° ê°€ì ¸ì˜´
- Etag ê¸°ë°˜ ê²€ì¦ìœ¼ë¡œ ë°ì´í„° ë³€ê²½ ì‹œ ìë™ ìºì‹œ ì—…ë°ì´íŠ¸
- ê°œë°œìê°€ Redisë¥¼ ë¬´íš¨í™”í•˜ë©´, ë‹¤ìŒ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì‹œ ìì—°ìŠ¤ëŸ½ê²Œ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´

**Service Workerì˜ Stale-While-Revalidate vs Cache-First ë¹„êµ**:

| ì¸¡ë©´ | Service Workerì˜ Cache-First | Service Workerì˜ Stale-While-Revalidate |
|------|------|------------------|
| **ì‘ë‹µ ì†ë„** | âœ… ì¦‰ì‹œ ë°˜í™˜ | âœ… ì¦‰ì‹œ ë°˜í™˜ (ìºì‹œ íˆíŠ¸ ì‹œ) |
| **ì˜¤í”„ë¼ì¸ ì§€ì›** | âœ… ê°€ëŠ¥ | âœ… ê°€ëŠ¥ |
| **ìµœì‹ ì„± ë³´ì¥** | âš ï¸ ë³´ì¥ ì–´ë ¤ì›€ | âœ… ë³´ì¥ (ë°±ê·¸ë¼ìš´ë“œ ì—…ë°ì´íŠ¸ + Etag) |
| **ì˜¤í”„ë¼ì¸ ìš°ì„ ì„±** | âš ï¸ ìµœì‹  ë°ì´í„° ì—†ìœ¼ë©´ ì‹¤íŒ¨ ê°€ëŠ¥ | âœ… Stale ë°ì´í„°ë¼ë„ ì¦‰ì‹œ ì‘ì—… ê°€ëŠ¥ |
| **êµ¬í˜„ ë³µì¡ë„** | âœ… ë‹¨ìˆœ | âš ï¸ ì•½ê°„ ë³µì¡ (Etag ì¶”ê°€) |
| **íƒœê·¸ ë°ì´í„° ì í•©ì„±** | âš ï¸ ë¶€ì í•© (ì˜¤í”„ë¼ì¸ í•„ìˆ˜ ë°ì´í„°) | âœ… **ì í•©** (ì˜¤í”„ë¼ì¸ ìš°ì„  + ìµœì‹ ì„± ë³´ì¥) |

**ê²°ë¡ **: íƒœê·¸ ë°ì´í„°ëŠ” ì˜¤í”„ë¼ì¸ ë©”ëª¨ ì‘ì„± ì‹œ í•„ìˆ˜ ë°ì´í„°ì´ë¯€ë¡œ, **Service Workerì˜ Stale-While-Revalidate ì „ëµ**ì´ ì í•©í•©ë‹ˆë‹¤. ìµœì‹  íƒœê·¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë”ë¼ë„ ì¦‰ì‹œ ì‘ì—…ì„ ì‹œì‘í•  ìˆ˜ ìˆê²Œ í•˜ë©´ì„œ, ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ë‹¤ìŒë²ˆ ì‚¬ìš©ì„ ìœ„í•´ ìºì‹œë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤.

**ì„œë²„ ì¸¡(Redis) ìºì‹±ê³¼ì˜ ê´€ê³„**:
- ì„œë²„ ì¸¡ì—ì„œëŠ” Redis ìºì‹œì˜ TTLì„ 7ì¼ë¡œ ì„¤ì •í•˜ì—¬ íƒœê·¸ ë°ì´í„°ë¥¼ ìºì‹±í•©ë‹ˆë‹¤ (Purger-Driven Invalidation + Long TTL).
- ê°œë°œìê°€ íƒœê·¸ DBë¥¼ ë³€ê²½í•  ë•Œ ìˆ˜ë™ìœ¼ë¡œ Redis ìºì‹œë¥¼ ë¬´íš¨í™”í•©ë‹ˆë‹¤.
- í´ë¼ì´ì–¸íŠ¸ ì¸¡(Service Worker)ê³¼ ì„œë²„ ì¸¡(Redis)ì€ ì„œë¡œ ë‹¤ë¥¸ ê³„ì¸µì—ì„œ ë™ì‘í•˜ë©° ìƒí˜¸ ë³´ì™„ì ì…ë‹ˆë‹¤.
- í´ë¼ì´ì–¸íŠ¸ ìºì‹œ íˆíŠ¸ ì‹œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì´ ì—†ê³ , í´ë¼ì´ì–¸íŠ¸ ìºì‹œ ë¯¸ìŠ¤ ì‹œ ì„œë²„ì˜ Redis ìºì‹œì—ì„œ ë¹ ë¥´ê²Œ ì‘ë‹µí•©ë‹ˆë‹¤.
- ê°œë°œìê°€ Redisë¥¼ ë¬´íš¨í™”í•˜ë©´, Service Workerì˜ SWR ì „ëµìœ¼ë¡œ ë‹¤ìŒ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì‹œ ìì—°ìŠ¤ëŸ½ê²Œ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

**ë‚´ ì„œì¬ ì •ë³´ ìºì‹± ì „ëµ** â­ (í´ë¼ì´ì–¸íŠ¸ ì¸¡: Service Worker):

**âš ï¸ ë ˆì´ì–´ë³„ ìš©ì–´ êµ¬ë¶„**:
- **Cache-First, Network-First, Stale-While-Revalidate**: í´ë¼ì´ì–¸íŠ¸(Service Worker)ì˜ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì²˜ë¦¬ ë¡œì§ì„ ì„¤ëª…í•˜ëŠ” ìš©ì–´
- **Redis ìºì‹œì˜ TTL**: ì„œë²„(Redis)ì˜ ë°ì´í„° ì €ì¥ ë° ê´€ë¦¬ ì •ì±…ì„ ì„¤ëª…í•˜ëŠ” ìš©ì–´
- ì´ ì„¹ì…˜ì€ **í´ë¼ì´ì–¸íŠ¸ ì¸¡(Service Worker)**ì˜ ìºì‹± ì „ëµì„ ì„¤ëª…í•©ë‹ˆë‹¤.
- ì„œë²„ ì¸¡(Redis) ìºì‹± ì •ì±…ì€ OFFLINE_SYNC_DATA_INTEGRITY_ANALYSIS.md ë¬¸ì„œ ì°¸ì¡°

**ë°ì´í„° ì„±ê²©**:
- **ì‚¬ìš©ì í†µì œ ê°œì¸ ìì›**: ì‚¬ìš©ìë§Œì´ ê°œì¸ì˜ ë‚´ ì„œì¬ ì •ë³´ë¥¼ ìƒì„±, ìˆ˜ì •, ì‚­ì œí•  ìˆ˜ ìˆìŒ
- **ê°œë°œìê°€ ì ˆëŒ€ë¡œ ë³€ê²½í•˜ë©´ ì•ˆ ë˜ëŠ” ë°ì´í„°**
- **ë³€ë™ì„±**: ì‚¬ìš©ì ì•¡ì…˜ì— ë”°ë¼ ë¹ˆë²ˆíˆ ë³€ê²½ë¨ (ë„ì„œ ì¶”ê°€/ì‚­ì œ)
- **ì‹ ì†í•œ ìµœì‹  ìƒíƒœ ë°˜ì˜(Freshness)ì´ ì¤‘ìš”**: ì‚¬ìš©ìê°€ ë°©ê¸ˆ ë³€ê²½í•œ ë‚´ìš©ì´ ì¦‰ì‹œ ë°˜ì˜ë˜ì–´ì•¼ í•¨

**ì „ëµ ì„ íƒ**: **Service Workerì˜ Network-First, Fallback to Cache ì „ëµ + Etag ê¸°ë°˜ ê²€ì¦** ì‚¬ìš©

**ì „ëµ ì„ íƒ ì´ìœ **:

1. **ìµœì‹  ìƒíƒœ ë³´ì¥ (Freshness ìš°ì„ )**
   - ë‚´ ì„œì¬ ëª©ë¡ì€ ì‚¬ìš©ìê°€ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ë°ì´í„°ì´ë¯€ë¡œ, ê°€ëŠ¥í•œ í•œ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë ¤ëŠ” ì‹œë„ë¥¼ ë¨¼ì € í•´ì•¼ í•¨
   - Network-First ì „ëµìœ¼ë¡œ ì˜¨ë¼ì¸ ìƒíƒœì¼ ë•Œ ì˜¤ë˜ëœ ëª©ë¡ì„ ë³¼ ê°€ëŠ¥ì„±ì„ ìµœì†Œí™”
   - ì‚¬ìš©ìê°€ ë°©ê¸ˆ ë³€ê²½í•œ ë‚´ìš©ì´ ì¦‰ì‹œ ë°˜ì˜ë˜ì–´ì•¼ í•¨

2. **ì˜¤í”„ë¼ì¸ ì ‘ê·¼ì„± ìœ ì§€**
   - ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ì™„ì „íˆ ëŠê²¼ì„ ë•Œë§Œ Service Workerì˜ ìºì‹œëœ ì„œì¬ ëª©ë¡ì„ ëŒ€ì²´ ìˆ˜ë‹¨(Fallback)ìœ¼ë¡œ ë³´ì—¬ì¤Œ
   - ì˜¤í”„ë¼ì¸ì—ì„œë„ ë©”ëª¨ ì‘ì„± ê°€ëŠ¥ (userBookId ê²€ì¦ì„ ìœ„í•´ í•„ìš”)

3. **ë°ì´í„° ì¼ê´€ì„± ë³´ì¥**
   - Etag ê¸°ë°˜ ê²€ì¦ì„ ì¶”ê°€í•˜ì—¬ ìºì‹œëœ ë°ì´í„°ì˜ ìµœì‹ ì„± í™•ì¸
   - ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì´ ì„±ê³µí•˜ë©´ ìµœì‹  ë°ì´í„°ë¡œ ìºì‹œ ì—…ë°ì´íŠ¸
   - ë‹¤ìŒ ì˜¤í”„ë¼ì¸ ì ‘ê·¼ ì‹œ ìµœì‹  ë°ì´í„° ì‚¬ìš© ê°€ëŠ¥

**êµ¬í˜„ ë°©ì‹** (Service Worker ì½”ë“œ):
```javascript
// Service Worker: ë‚´ ì„œì¬ ì •ë³´ Network-First, Fallback to Cache ì „ëµ + Etag ê¸°ë°˜ ê²€ì¦
if (event.request.url.includes('/api/v1/user/books') && 
    event.request.method === 'GET') {
    event.respondWith(
        caches.open('user-shelf-cache-v1').then(cache => {
            return cache.match(event.request).then(cachedResponse => {
                // 1. Network-First: ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ë¨¼ì € ì‹œë„ (ìµœì‹ ì„± ë³´ì¥)
                return fetch(event.request).then(response => {
                    if (response.ok) {
                        // 2. Etag ê¸°ë°˜ ê²€ì¦: ìºì‹œëœ ë°ì´í„°ì™€ ë¹„êµ
                        const cachedEtag = cachedResponse?.headers.get('ETag');
                        const newEtag = response.headers.get('ETag');
                        
                        // 3. Etagê°€ ë‹¤ë¥´ê±°ë‚˜ ìºì‹œê°€ ì—†ìœ¼ë©´ ìºì‹œ ì—…ë°ì´íŠ¸
                        if (cachedEtag !== newEtag || !cachedResponse) {
                            cache.put(event.request, response.clone());
                        }
                    }
                    return response;
                }).catch(error => {
                    // 4. Fallback to Cache: ë„¤íŠ¸ì›Œí¬ ì‹¤íŒ¨ ì‹œì—ë§Œ ìºì‹œ ì‚¬ìš©
                    console.error('ë‚´ ì„œì¬ ì •ë³´ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì‹¤íŒ¨:', error);
                    
                    if (cachedResponse) {
                        // ìºì‹œëœ ë°ì´í„°ë¥¼ ëŒ€ì²´ ìˆ˜ë‹¨ìœ¼ë¡œ ë°˜í™˜ (ì˜¤í”„ë¼ì¸ ì ‘ê·¼ì„± ìœ ì§€)
                        return cachedResponse;
                    }
                    
                    // ìºì‹œë„ ì—†ìœ¼ë©´ ì—ëŸ¬ ì‘ë‹µ
                    return new Response(JSON.stringify({
                        ok: false,
                        error: 'ë‚´ ì„œì¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
                    }), {
                        status: 503,
                        headers: { 'Content-Type': 'application/json' }
                    });
                });
            });
        })
    );
}
```

**ìºì‹œ ë¬´íš¨í™” ì „ëµ**:

**ì„œë²„ ì¸¡(Redis) ë¬´íš¨í™”**: Write-Through / Cache Aside Pattern
- ì‚¬ìš©ìê°€ ì±…ì„ ì¶”ê°€/ì‚­ì œí•˜ëŠ” API í˜¸ì¶œ ì™„ë£Œ ì‹œ, ì„œë²„ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì¦‰ì‹œ Redis ìºì‹œë¥¼ ë¬´íš¨í™”(ì‚­ì œ)
- ì“°ê¸°(Write) ì‘ì—…ì´ ë°œìƒí•  ë•Œë§ˆë‹¤ ìºì‹œë¥¼ ì‚­ì œí•˜ì—¬ ìµœì‹  ìƒíƒœ ë³´ì¥
- Redis TTLì€ 5ë¶„~10ë¶„ìœ¼ë¡œ ì§§ê²Œ ì„¤ì • (ì•ˆì „ë§ ì—­í• )
- ìì„¸í•œ ë‚´ìš©ì€ OFFLINE_SYNC_DATA_INTEGRITY_ANALYSIS.md ë¬¸ì„œ ì°¸ì¡°

**í´ë¼ì´ì–¸íŠ¸ ì¸¡(Service Worker) ë¬´íš¨í™”**: ìë™ ê°±ì‹ 
- Network-First ì „ëµìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì´ ì„±ê³µí•˜ë©´ ìë™ìœ¼ë¡œ ìµœì‹  ë°ì´í„°ë¡œ ìºì‹œ ì—…ë°ì´íŠ¸
- Etag ê¸°ë°˜ ê²€ì¦ìœ¼ë¡œ ë°ì´í„° ë³€ê²½ ì‹œ ìë™ ìºì‹œ ì—…ë°ì´íŠ¸
- ì„œë²„ì—ì„œ Redisë¥¼ ë¬´íš¨í™”í•˜ë©´, ë‹¤ìŒ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì‹œ ìì—°ìŠ¤ëŸ½ê²Œ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´

**Service Workerì˜ Network-First vs Stale-While-Revalidate vs Cache-First ë¹„êµ**:

| ì¸¡ë©´ | Service Workerì˜ Cache-First | Service Workerì˜ Stale-While-Revalidate | Service Workerì˜ Network-First |
|------|------------|------------------------|------------------------|
| **ì‘ë‹µ ì†ë„** | âœ… ì¦‰ì‹œ ë°˜í™˜ | âœ… ì¦‰ì‹œ ë°˜í™˜ (ìºì‹œ íˆíŠ¸ ì‹œ) | âš ï¸ ë„¤íŠ¸ì›Œí¬ ëŒ€ê¸° (ì˜¨ë¼ì¸ ì‹œ) |
| **ìµœì‹ ì„±** | âš ï¸ ë³´ì¥ ì–´ë ¤ì›€ | âœ… ë³´ì¥ (ë°±ê·¸ë¼ìš´ë“œ ì—…ë°ì´íŠ¸) | âœ… **ìµœìš°ì„  ë³´ì¥** (ë„¤íŠ¸ì›Œí¬ ìš°ì„ ) |
| **ì˜¤í”„ë¼ì¸ ì§€ì›** | âœ… ê°€ëŠ¥ | âœ… ê°€ëŠ¥ | âœ… ê°€ëŠ¥ (Fallback to Cache) |
| **Freshness ìš°ì„ ** | âŒ ë¶€ì í•© | âš ï¸ ë¶€ë¶„ì  | âœ… **ìµœì ** |
| **êµ¬í˜„ ë³µì¡ë„** | âœ… ë‹¨ìˆœ | âš ï¸ ì•½ê°„ ë³µì¡ | âœ… ë‹¨ìˆœ |
| **ë‚´ ì„œì¬ ì •ë³´ ì í•©ì„±** | âŒ ë¶€ì í•© (ìµœì‹ ì„± ì¤‘ìš”) | âš ï¸ ë¶€ë¶„ì  (Stale í—ˆìš©) | âœ… **ì í•©** (ìµœì‹ ì„± ìµœìš°ì„ ) |

**ê²°ë¡ **: ë‚´ ì„œì¬ ì •ë³´ëŠ” ì‚¬ìš©ìê°€ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ë°ì´í„°ì´ë©° ì‹ ì†í•œ ìµœì‹  ìƒíƒœ ë°˜ì˜ì´ ì¤‘ìš”í•˜ë¯€ë¡œ, **Service Workerì˜ Network-First, Fallback to Cache ì „ëµ**ì´ ì í•©í•©ë‹ˆë‹¤. ì˜¨ë¼ì¸ ìƒíƒœì¼ ë•Œ ì˜¤ë˜ëœ ëª©ë¡ì„ ë³¼ ê°€ëŠ¥ì„±ì„ ìµœì†Œí™”í•˜ë©´ì„œ, ì˜¤í”„ë¼ì¸ ì ‘ê·¼ì„±ë„ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì„œë²„ ì¸¡(Redis) ìºì‹±ê³¼ì˜ ê´€ê³„**:
- ì„œë²„ ì¸¡ì—ì„œëŠ” Redis ìºì‹œì˜ TTLì„ 5ë¶„~10ë¶„ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ë‚´ ì„œì¬ ì •ë³´ë¥¼ ìºì‹±í•©ë‹ˆë‹¤ (Write-Through / Cache Aside Pattern + Short TTL).
- ì‚¬ìš©ìê°€ ì±…ì„ ì¶”ê°€/ì‚­ì œí•˜ëŠ” API í˜¸ì¶œ ì™„ë£Œ ì‹œ, ì„œë²„ì—ì„œ ì¦‰ì‹œ Redis ìºì‹œë¥¼ ë¬´íš¨í™”í•˜ì—¬ ìµœì‹  ìƒíƒœë¥¼ ë³´ì¥í•©ë‹ˆë‹¤.
- í´ë¼ì´ì–¸íŠ¸ ì¸¡(Service Worker)ê³¼ ì„œë²„ ì¸¡(Redis)ì€ ì„œë¡œ ë‹¤ë¥¸ ê³„ì¸µì—ì„œ ë™ì‘í•˜ë©° ìƒí˜¸ ë³´ì™„ì ì…ë‹ˆë‹¤.
- í´ë¼ì´ì–¸íŠ¸ëŠ” Network-First ì „ëµìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ìš°ì„ í•˜ë¯€ë¡œ, ì„œë²„ì˜ Redis ìºì‹œ ë¬´íš¨í™”ê°€ ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤.
- ì˜¤í”„ë¼ì¸ ìƒíƒœì¼ ë•Œë§Œ í´ë¼ì´ì–¸íŠ¸ ìºì‹œë¥¼ Fallbackìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ ì˜¤í”„ë¼ì¸ ì ‘ê·¼ì„±ì„ ìœ ì§€í•©ë‹ˆë‹¤.

**ê³ ë ¤ì‚¬í•­**:

1. **HTTPS ìš”êµ¬ì‚¬í•­**
   - Service WorkerëŠ” HTTPS í™˜ê²½ì—ì„œë§Œ ë™ì‘ (í”„ë¡œë•ì…˜ í•„ìˆ˜)
   - ê°œë°œ í™˜ê²½: `localhost`ì—ì„œëŠ” HTTPë„ ë™ì‘

2. **ë¸Œë¼ìš°ì € í˜¸í™˜ì„±**
   - Background Sync: Chrome/Edge ì§€ì›, Firefox ì¼ë¶€ ì§€ì›, Safari ì œí•œì 
   - í´ë°± ì „ëµ í•„ìš”: ë¯¸ì§€ì› ë¸Œë¼ìš°ì €ì—ì„œëŠ” `online` ì´ë²¤íŠ¸ ì‚¬ìš©

3. **êµ¬í˜„ ë³µì¡ë„**
   - ë‹¨ê³„ì  êµ¬í˜„ ê¶Œì¥:
     1. ê¸°ë³¸ Service Worker ë“±ë¡
     2. Background Sync ì¶”ê°€
     3. ë„¤íŠ¸ì›Œí¬ ì œì–´ ë¡œì§ ì¶”ê°€
     4. ìºì‹± ì „ëµ ì¶”ê°€ (ì„ íƒì )

4. **ë””ë²„ê¹…**
   - Chrome DevToolsì˜ Service Worker ë””ë²„ê¹… ë„êµ¬ í™œìš©
   - ìƒì„¸í•œ ë¡œê¹… ë° ë‹¨ê³„ì  í…ŒìŠ¤íŠ¸ í•„ìš”

**ì°¸ê³ **: 
- ë³¸ í”„ë¡œì íŠ¸ì—ì„œëŠ” í˜ì´ì§€ ì¢…ë£Œ í›„ ë™ê¸°í™”ì™€ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì— ëŒ€í•œ ì„¸ë°€í•œ ì œì–´ê°€ í•„ìš”í•˜ë¯€ë¡œ Service Workerë¥¼ í•„ìˆ˜ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [Offline-First ì•„í‚¤í…ì²˜ ì„¤ê³„ ë° ì „ëµ](./OFFLINE_FIRST.md) ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.
- **ìºì‹± ì „ëµ ë ˆì´ì–´ êµ¬ë¶„**: í´ë¼ì´ì–¸íŠ¸ ì¸¡(Service Worker)ì˜ ìºì‹± ì „ëµê³¼ ì„œë²„ ì¸¡(Redis)ì˜ ìºì‹± ì •ì±…ì€ ì„œë¡œ ë‹¤ë¥¸ ê³„ì¸µì—ì„œ ë™ì‘í•©ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [ì˜¤í”„ë¼ì¸ ë™ê¸°í™” ë°ì´í„° ë¬´ê²°ì„± ë¶„ì„](./OFFLINE_SYNC_DATA_INTEGRITY_ANALYSIS.md) ë¬¸ì„œì˜ Redis ì„¹ì…˜ì„ ì°¸ì¡°í•˜ì„¸ìš”.

### ì„œë²„ ì¸¡ ì²˜ë¦¬

#### í˜„ì¬ API êµ¬ì¡° (ë³€ê²½ ë¶ˆí•„ìš”)

```
POST /api/v1/memos
Request: MemoCreateRequest
Response: MemoResponse (ì„œë²„ ìƒì„± ID í¬í•¨)
```

**ì„œë²„ ë³€ê²½ì‚¬í•­**: ì—†ìŒ (ê¸°ì¡´ API ê·¸ëŒ€ë¡œ ì‚¬ìš©)

---

## ë°ì´í„° ëª¨ë¸

### ë¡œì»¬ ë©”ëª¨ ì €ì¥ êµ¬ì¡°

```javascript
// IndexedDB ìŠ¤í‚¤ë§ˆ: offline_memos
{
  localId: string,              // ë¡œì»¬ ì„ì‹œ ID (UUID)
  serverId: number | null,      // ì„œë²„ ID (ë™ê¸°í™” í›„ ì„¤ì •)
  userBookId: number,           // ì‚¬ìš©ì ì±… ID
  pageNumber: number,           // í˜ì´ì§€ ë²ˆí˜¸
  content: string,              // ë©”ëª¨ ë‚´ìš©
  tags: string[],               // íƒœê·¸ ë¦¬ìŠ¤íŠ¸
  memoStartTime: string,        // ISO 8601 í˜•ì‹
  syncStatus: string,           // "pending" | "syncing" | "synced" | "failed"
  createdAt: string,            // ë¡œì»¬ ìƒì„± ì‹œê°„
  updatedAt: string,            // ë¡œì»¬ ìˆ˜ì • ì‹œê°„
  syncQueueId: string | null    // ë™ê¸°í™” í í•­ëª© ID
}
```

### ë™ê¸°í™” í ì €ì¥ êµ¬ì¡°

```javascript
// IndexedDB ìŠ¤í‚¤ë§ˆ: sync_queue
{
  id: string,                   // ê³ ìœ  ID (UUID)
  type: string,                 // "CREATE" | "UPDATE" | "DELETE"
  localMemoId: string,          // ë¡œì»¬ ë©”ëª¨ ID
  serverMemoId: number | null,  // ì„œë²„ ë©”ëª¨ ID (UPDATE/DELETE ì‹œ í•„ìš”)
  data: object,                 // ìš”ì²­ ë°ì´í„° (MemoCreateRequest/MemoUpdateRequest ë“±)
  status: string,               // "PENDING" | "SYNCING" | "SUCCESS" | "FAILED"
  retryCount: number,           // ì¬ì‹œë„ íšŸìˆ˜
  error: string | null,         // ì—ëŸ¬ ë©”ì‹œì§€
  createdAt: string,            // ìƒì„± ì‹œê°„
  lastRetryAt: string | null    // ë§ˆì§€ë§‰ ì¬ì‹œë„ ì‹œê°„
}
```

---

## êµ¬í˜„ ë°©ë²•

### 1. IndexedDB ì´ˆê¸°í™” ë° ìŠ¤í‚¤ë§ˆ ì •ì˜

```javascript
// storage/indexeddb-manager.js
class IndexedDBManager {
    constructor() {
        this.dbName = 'reading-tracker';
        this.version = 1;
        this.db = null;
    }

    async init() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(this.dbName, this.version);

            request.onerror = () => reject(request.error);
            request.onsuccess = () => {
                this.db = request.result;
                resolve(this.db);
            };

            request.onupgradeneeded = (event) => {
                const db = event.target.result;

                // offline_memos í…Œì´ë¸”
                if (!db.objectStoreNames.contains('offline_memos')) {
                    const memoStore = db.createObjectStore('offline_memos', {
                        keyPath: 'localId'
                    });
                    memoStore.createIndex('syncStatus', 'syncStatus', { unique: false });
                    memoStore.createIndex('userBookId', 'userBookId', { unique: false });
                    memoStore.createIndex('memoStartTime', 'memoStartTime', { unique: false });
                    memoStore.createIndex('serverId', 'serverId', { unique: false }); // í•˜ì´ë¸Œë¦¬ë“œ ì „ëµìš©
                }

                // sync_queue í…Œì´ë¸”
                if (!db.objectStoreNames.contains('sync_queue')) {
                    const queueStore = db.createObjectStore('sync_queue', {
                        keyPath: 'id'
                    });
                    queueStore.createIndex('status', 'status', { unique: false });
                    queueStore.createIndex('localMemoId', 'localMemoId', { unique: false });
                }
            };
        });
    }

    // ë©”ëª¨ ì €ì¥
    async saveMemo(memo) {
        const transaction = this.db.transaction(['offline_memos'], 'readwrite');
        const store = transaction.objectStore('offline_memos');
        return store.put(memo);
    }

    // ë™ê¸°í™” ëŒ€ê¸° ì¤‘ì¸ ë©”ëª¨ ì¡°íšŒ
    async getPendingMemos() {
        const transaction = this.db.transaction(['offline_memos'], 'readonly');
        const store = transaction.objectStore('offline_memos');
        const index = store.index('syncStatus');
        return index.getAll('pending');
    }

    // ë©”ëª¨ ì—…ë°ì´íŠ¸ (ì„œë²„ ID ì„¤ì •)
    async updateMemoWithServerId(localId, serverId) {
        const transaction = this.db.transaction(['offline_memos'], 'readwrite');
        const store = transaction.objectStore('offline_memos');
        const memo = await store.get(localId);
        if (memo) {
            memo.serverId = serverId;
            memo.syncStatus = 'synced';
            return store.put(memo);
        }
    }

    // ë¡œì»¬ IDë¡œ ë©”ëª¨ ì¡°íšŒ
    async getMemoByLocalId(localId) {
        const transaction = this.db.transaction(['offline_memos'], 'readonly');
        const store = transaction.objectStore('offline_memos');
        const request = store.get(localId);
        return new Promise((resolve, reject) => {
            request.onsuccess = () => resolve(request.result || null);
            request.onerror = () => reject(request.error);
        });
    }

    // ì„œë²„ IDë¡œ ë©”ëª¨ ì¡°íšŒ (í•˜ì´ë¸Œë¦¬ë“œ ì „ëµìš©)
    async getMemoByServerId(serverId) {
        const transaction = this.db.transaction(['offline_memos'], 'readonly');
        const store = transaction.objectStore('offline_memos');
        const index = store.index('serverId');
        const request = index.get(serverId);
        return new Promise((resolve, reject) => {
            request.onsuccess = () => resolve(request.result || null);
            request.onerror = () => reject(request.error);
        });
    }

    // ë™ê¸°í™” ì™„ë£Œëœ ë©”ëª¨ ì¡°íšŒ (í•˜ì´ë¸Œë¦¬ë“œ ì „ëµìš©)
    async getSyncedMemos() {
        const transaction = this.db.transaction(['offline_memos'], 'readonly');
        const store = transaction.objectStore('offline_memos');
        const index = store.index('syncStatus');
        return index.getAll('synced');
    }

    // ë©”ëª¨ ì‚­ì œ (í•˜ì´ë¸Œë¦¬ë“œ ì „ëµìš©)
    async deleteMemo(localId) {
        const transaction = this.db.transaction(['offline_memos'], 'readwrite');
        const store = transaction.objectStore('offline_memos');
        return store.delete(localId);
    }
}

export const dbManager = new IndexedDBManager();
```

### 2. ì˜¤í”„ë¼ì¸ ë©”ëª¨ ì‘ì„± ì„œë¹„ìŠ¤

```javascript
// services/offline-memo-service.js
import { dbManager } from '../storage/indexeddb-manager.js';
import { syncQueueManager } from './sync-queue-manager.js';
import { networkMonitor } from '../utils/network-monitor.js';

class OfflineMemoService {
    constructor() {
        this.isInitialized = false;
    }

    async init() {
        if (!this.isInitialized) {
            await dbManager.init();
            this.isInitialized = true;
        }
    }

    /**
     * ë©”ëª¨ ì‘ì„± (ì˜¤í”„ë¼ì¸ ì§€ì›)
     * 1. ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥
     * 2. ë™ê¸°í™” íì— ì¶”ê°€
     * 3. ë„¤íŠ¸ì›Œí¬ê°€ ì—°ê²°ë˜ì–´ ìˆìœ¼ë©´ ì¦‰ì‹œ ë™ê¸°í™” ì‹œë„
     */
    async createMemo(memoData) {
        await this.init();

        // ë¡œì»¬ ID ìƒì„± (UUID)
        const localId = this.generateLocalId();

        // ë¡œì»¬ ë©”ëª¨ ê°ì²´ ìƒì„±
        const localMemo = {
            localId,
            serverId: null,
            userBookId: memoData.userBookId,
            pageNumber: memoData.pageNumber,
            content: memoData.content,
            tags: memoData.tags || [],
            memoStartTime: memoData.memoStartTime,
            syncStatus: 'pending',
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString(),
            syncQueueId: null
        };

        // ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥
        await dbManager.saveMemo(localMemo);

        // ë™ê¸°í™” íì— ì¶”ê°€
        const queueItem = await syncQueueManager.enqueue({
            type: 'CREATE',
            localMemoId: localId,
            data: memoData
        });

        // syncQueueId ì—…ë°ì´íŠ¸
        localMemo.syncQueueId = queueItem.id;
        await dbManager.saveMemo(localMemo);

        // ë„¤íŠ¸ì›Œí¬ê°€ ì—°ê²°ë˜ì–´ ìˆìœ¼ë©´ ì¦‰ì‹œ ë™ê¸°í™” ì‹œë„
        if (networkMonitor.isOnline) {
            this.syncPendingMemos();
        }

        return localMemo;
    }

    /**
     * ë©”ëª¨ ìˆ˜ì • (ì˜¤í”„ë¼ì¸ ì§€ì›)
     * 1. IndexedDBì—ì„œ ê¸°ì¡´ ë©”ëª¨ ì¡°íšŒ
     * 2. ìˆ˜ì • ë‚´ìš© ë°˜ì˜
     * 3. ë™ê¸°í™” íì— UPDATE í•­ëª© ì¶”ê°€
     * 4. ë„¤íŠ¸ì›Œí¬ê°€ ì—°ê²°ë˜ì–´ ìˆìœ¼ë©´ ì¦‰ì‹œ ë™ê¸°í™” ì‹œë„
     */
    async updateMemo(memoId, updateData) {
        await this.init();

        // memoIdê°€ localIdì¸ì§€ serverIdì¸ì§€ í™•ì¸
        let localMemo;
        if (typeof memoId === 'string' && memoId.startsWith('local-')) {
            // localIdë¡œ ì¡°íšŒ
            localMemo = await dbManager.getMemoByLocalId(memoId);
        } else {
            // serverIdë¡œ ì¡°íšŒ
            localMemo = await dbManager.getMemoByServerId(memoId);
        }

        if (!localMemo) {
            throw new Error('ë©”ëª¨ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }

        // ì„œë²„ì— ë™ê¸°í™”ëœ ë©”ëª¨ë§Œ ìˆ˜ì • ê°€ëŠ¥ (serverIdê°€ ìˆì–´ì•¼ í•¨)
        if (!localMemo.serverId) {
            throw new Error('ì•„ì§ ë™ê¸°í™”ë˜ì§€ ì•Šì€ ë©”ëª¨ëŠ” ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë™ê¸°í™”ë¥¼ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
        }

        // ìˆ˜ì • ë‚´ìš© ë°˜ì˜
        if (updateData.content !== undefined) {
            localMemo.content = updateData.content;
        }
        if (updateData.tags !== undefined) {
            localMemo.tags = updateData.tags || [];
        }
        if (updateData.pageNumber !== undefined) {
            localMemo.pageNumber = updateData.pageNumber;
        }
        if (updateData.memoStartTime !== undefined) {
            localMemo.memoStartTime = updateData.memoStartTime;
        }
        localMemo.updatedAt = new Date().toISOString();
        localMemo.syncStatus = 'pending'; // ìˆ˜ì • í›„ ë™ê¸°í™” ëŒ€ê¸° ìƒíƒœë¡œ ë³€ê²½

        // ê¸°ì¡´ ë™ê¸°í™” í í•­ëª©ì´ ìˆìœ¼ë©´ ì œê±° (ìƒˆë¡œìš´ ìˆ˜ì • ë‚´ìš©ìœ¼ë¡œ ëŒ€ì²´)
        if (localMemo.syncQueueId) {
            await syncQueueManager.removeQueueItem(localMemo.syncQueueId);
        }

        // ë™ê¸°í™” íì— UPDATE í•­ëª© ì¶”ê°€
        const queueItem = await syncQueueManager.enqueue({
            type: 'UPDATE',
            localMemoId: localMemo.localId,
            serverMemoId: localMemo.serverId, // ì„œë²„ ID í•„ìš”
            data: {
                id: localMemo.serverId,
                content: localMemo.content,
                tags: localMemo.tags,
                pageNumber: localMemo.pageNumber,
                memoStartTime: localMemo.memoStartTime
            }
        });

        // syncQueueId ì—…ë°ì´íŠ¸
        localMemo.syncQueueId = queueItem.id;
        await dbManager.saveMemo(localMemo);

        // ë„¤íŠ¸ì›Œí¬ê°€ ì—°ê²°ë˜ì–´ ìˆìœ¼ë©´ ì¦‰ì‹œ ë™ê¸°í™” ì‹œë„
        if (networkMonitor.isOnline) {
            this.syncPendingMemos();
        }

        return localMemo;
    }

    /**
     * ë©”ëª¨ ì‚­ì œ (ì˜¤í”„ë¼ì¸ ì§€ì›)
     * 1. IndexedDBì—ì„œ ê¸°ì¡´ ë©”ëª¨ ì¡°íšŒ
     * 2. ë™ê¸°í™” íì— DELETE í•­ëª© ì¶”ê°€
     * 3. ë¡œì»¬ ë©”ëª¨ëŠ” ì‚­ì œí•˜ì§€ ì•Šê³  ì‚­ì œ í‘œì‹œë§Œ í•¨ (ë™ê¸°í™” ì™„ë£Œ í›„ ì‚­ì œ)
     * 4. ë„¤íŠ¸ì›Œí¬ê°€ ì—°ê²°ë˜ì–´ ìˆìœ¼ë©´ ì¦‰ì‹œ ë™ê¸°í™” ì‹œë„
     */
    async deleteMemo(memoId) {
        await this.init();

        // memoIdê°€ localIdì¸ì§€ serverIdì¸ì§€ í™•ì¸
        let localMemo;
        if (typeof memoId === 'string' && memoId.startsWith('local-')) {
            // localIdë¡œ ì¡°íšŒ
            localMemo = await dbManager.getMemoByLocalId(memoId);
        } else {
            // serverIdë¡œ ì¡°íšŒ
            localMemo = await dbManager.getMemoByServerId(memoId);
        }

        if (!localMemo) {
            throw new Error('ë©”ëª¨ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }

        // ì„œë²„ì— ë™ê¸°í™”ëœ ë©”ëª¨ë§Œ ì‚­ì œ ê°€ëŠ¥ (serverIdê°€ ìˆì–´ì•¼ í•¨)
        if (!localMemo.serverId) {
            // ì•„ì§ ë™ê¸°í™”ë˜ì§€ ì•Šì€ ë©”ëª¨ëŠ” ë¡œì»¬ì—ì„œ ì¦‰ì‹œ ì‚­ì œ
            await dbManager.deleteMemo(localMemo.localId);
            
            // ë™ê¸°í™” íì— CREATE í•­ëª©ì´ ìˆìœ¼ë©´ ì œê±°
            if (localMemo.syncQueueId) {
                await syncQueueManager.removeQueueItem(localMemo.syncQueueId);
            }
            
            return { deleted: true, localOnly: true };
        }

        // ë™ê¸°í™” íì— DELETE í•­ëª© ì¶”ê°€
        const queueItem = await syncQueueManager.enqueue({
            type: 'DELETE',
            localMemoId: localMemo.localId,
            serverMemoId: localMemo.serverId, // ì„œë²„ ID í•„ìš”
            data: {
                id: localMemo.serverId
            }
        });

        // ë¡œì»¬ ë©”ëª¨ëŠ” ì‚­ì œ í‘œì‹œë§Œ í•˜ê³  ì‹¤ì œ ì‚­ì œëŠ” ë™ê¸°í™” ì™„ë£Œ í›„
        localMemo.syncStatus = 'pending'; // ì‚­ì œ ëŒ€ê¸° ìƒíƒœ
        localMemo.syncQueueId = queueItem.id;
        localMemo.updatedAt = new Date().toISOString();
        await dbManager.saveMemo(localMemo);

        // ë„¤íŠ¸ì›Œí¬ê°€ ì—°ê²°ë˜ì–´ ìˆìœ¼ë©´ ì¦‰ì‹œ ë™ê¸°í™” ì‹œë„
        if (networkMonitor.isOnline) {
            this.syncPendingMemos();
        }

        return { deleted: false, localOnly: false, localMemo };
    }

    /**
     * ëª¨ë“  ì˜¤í”„ë¼ì¸ ë©”ëª¨ ì¡°íšŒ (UI í‘œì‹œìš©)
     */
    async getAllMemos() {
        await this.init();
        const transaction = dbManager.db.transaction(['offline_memos'], 'readonly');
        const store = transaction.objectStore('offline_memos');
        return store.getAll();
    }

    /**
     * íŠ¹ì • ì±…ì˜ ë©”ëª¨ ì¡°íšŒ
     */
    async getMemosByBook(userBookId) {
        await this.init();
        const transaction = dbManager.db.transaction(['offline_memos'], 'readonly');
        const store = transaction.objectStore('offline_memos');
        const index = store.index('userBookId');
        return index.getAll(userBookId);
    }

    /**
     * ì„œë²„ ë©”ëª¨ë¥¼ ë¡œì»¬ ë©”ëª¨ë¡œ ì €ì¥ (í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ)
     * ìµœê·¼ 7ì¼ ë©”ëª¨ë§Œ IndexedDBì— ì €ì¥
     */
    async saveServerMemoAsLocal(serverMemo) {
        await this.init();

        // ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë©”ëª¨ì¸ì§€ í™•ì¸ (serverIdë¡œ)
        const existingMemo = await dbManager.getMemoByServerId(serverMemo.id);
        if (existingMemo) {
            // ì´ë¯¸ ì¡´ì¬í•˜ë©´ ì—…ë°ì´íŠ¸
            existingMemo.content = serverMemo.content;
            existingMemo.tags = serverMemo.tags || [];
            existingMemo.pageNumber = serverMemo.pageNumber;
            existingMemo.memoStartTime = serverMemo.memoStartTime || serverMemo.createdAt;
            existingMemo.updatedAt = new Date().toISOString();
            await dbManager.saveMemo(existingMemo);
            return existingMemo;
        }

        // ìƒˆ ë©”ëª¨ë¡œ ì €ì¥
        const localMemo = {
            localId: this.generateLocalId(),
            serverId: serverMemo.id,
            userBookId: serverMemo.userBookId,
            pageNumber: serverMemo.pageNumber,
            content: serverMemo.content,
            tags: serverMemo.tags || [],
            memoStartTime: serverMemo.memoStartTime || serverMemo.createdAt,
            syncStatus: 'synced', // ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ ë©”ëª¨ëŠ” ì´ë¯¸ ë™ê¸°í™” ì™„ë£Œ
            createdAt: serverMemo.createdAt || new Date().toISOString(),
            updatedAt: serverMemo.updatedAt || new Date().toISOString(),
            syncQueueId: null
        };

        await dbManager.saveMemo(localMemo);
        return localMemo;
    }

    /**
     * ë¡œì»¬ ID ìƒì„± (UUID v4)
     */
    generateLocalId() {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {
            const r = Math.random() * 16 | 0;
            const v = c === 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
    }

    /**
     * ëŒ€ê¸° ì¤‘ì¸ ë©”ëª¨ ë™ê¸°í™”
     * ë™ê¸°í™” íì—ì„œ PENDING í•­ëª©ì„ ê°€ì ¸ì™€ì„œ ì²˜ë¦¬
     * @returns {Promise<{successCount: number, failedCount: number}>} ë™ê¸°í™” ê²°ê³¼ (ì„±ê³µ/ì‹¤íŒ¨ ê°œìˆ˜)
     */
    async syncPendingMemos() {
        if (!networkMonitor.isOnline) {
            console.log('ë„¤íŠ¸ì›Œí¬ê°€ ì˜¤í”„ë¼ì¸ ìƒíƒœì…ë‹ˆë‹¤.');
            return { successCount: 0, failedCount: 0 };
        }

        // ë™ê¸°í™” íì—ì„œ PENDING í•­ëª© ì¡°íšŒ
        const pendingQueueItems = await syncQueueManager.getPendingItems();
        console.log(`ë™ê¸°í™”í•  í•­ëª© ìˆ˜: ${pendingQueueItems.length}`);

        let successCount = 0;
        let failedCount = 0;

        // ìˆœì„œ ë³´ì¥: createdAt ê¸°ì¤€ ì •ë ¬
        pendingQueueItems.sort((a, b) => {
            const timeA = new Date(a.createdAt);
            const timeB = new Date(b.createdAt);
            return timeA - timeB;
        });

        for (const queueItem of pendingQueueItems) {
            try {
                await this.syncQueueItem(queueItem);
                successCount++;
            } catch (error) {
                console.error(`ë™ê¸°í™” ì‹¤íŒ¨ (${queueItem.id}):`, error);
                failedCount++;
                // ì¬ì‹œë„ ë¡œì§ì€ syncQueueManagerì—ì„œ ì²˜ë¦¬
            }
        }
        
        // ë™ê¸°í™” ê²°ê³¼ ë°˜í™˜ (í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œì— ì‚¬ìš©)
        return { successCount, failedCount };
    }

    /**
     * ë™ê¸°í™” í í•­ëª© ì²˜ë¦¬ (CREATE/UPDATE/DELETE)
     */
    async syncQueueItem(queueItem) {
        // ë™ê¸°í™” í í•­ëª© ìƒíƒœ ì—…ë°ì´íŠ¸
        await syncQueueManager.updateStatus(queueItem.id, 'SYNCING');

        try {
            let response;
            let localMemo;

            // ë™ê¸°í™” í í•­ëª© íƒ€ì…ì— ë”°ë¼ ì²˜ë¦¬
            switch (queueItem.type) {
                case 'CREATE':
                    // ë©”ëª¨ ìƒì„±
                    localMemo = await dbManager.getMemoByLocalId(queueItem.localMemoId);
                    if (!localMemo) {
                        throw new Error('ë¡œì»¬ ë©”ëª¨ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }

        localMemo.syncStatus = 'syncing';
        await dbManager.saveMemo(localMemo);

                    response = await apiClient.post('/memos', queueItem.data);

            // ì„œë²„ IDë¡œ ì—…ë°ì´íŠ¸
            await dbManager.updateMemoWithServerId(localMemo.localId, response.data.id);
                    localMemo = await dbManager.getMemoByLocalId(queueItem.localMemoId);

                    // âœ… í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ: ìµœê·¼ 7ì¼ ë©”ëª¨ë§Œ ë³´ê´€
                    const sevenDaysAgo = new Date();
                    sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
                    const memoDate = new Date(localMemo.memoStartTime);

                    if (memoDate < sevenDaysAgo) {
                        await dbManager.deleteMemo(localMemo.localId);
                        console.log(`ë©”ëª¨ ë™ê¸°í™” ì„±ê³µ ë° ì‚­ì œ (ì˜¤ë˜ëœ ë©”ëª¨): ${localMemo.localId} â†’ ${response.data.id}`);
                    } else {
                        localMemo.syncStatus = 'synced';
                        await dbManager.saveMemo(localMemo);
                        console.log(`ë©”ëª¨ ë™ê¸°í™” ì„±ê³µ (ë³´ê´€): ${localMemo.localId} â†’ ${response.data.id}`);
                    }
                    break;

                case 'UPDATE':
                    // ë©”ëª¨ ìˆ˜ì •
                    localMemo = await dbManager.getMemoByLocalId(queueItem.localMemoId);
                    if (!localMemo) {
                        throw new Error('ë¡œì»¬ ë©”ëª¨ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }

                    if (!localMemo.serverId) {
                        throw new Error('ì„œë²„ IDê°€ ì—†ì–´ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }

                    localMemo.syncStatus = 'syncing';
                    await dbManager.saveMemo(localMemo);

                    response = await apiClient.put(`/memos/${queueItem.serverMemoId}`, queueItem.data);

                    // ìˆ˜ì • ì™„ë£Œ í›„ ìƒíƒœ ì—…ë°ì´íŠ¸
                    localMemo.syncStatus = 'synced';
                    localMemo.updatedAt = new Date().toISOString();
                    await dbManager.saveMemo(localMemo);
                    console.log(`ë©”ëª¨ ìˆ˜ì • ë™ê¸°í™” ì„±ê³µ: ${localMemo.localId} â†’ ${queueItem.serverMemoId}`);
                    break;

                case 'DELETE':
                    // ë©”ëª¨ ì‚­ì œ
                    localMemo = await dbManager.getMemoByLocalId(queueItem.localMemoId);
                    if (!localMemo) {
                        // ì´ë¯¸ ì‚­ì œëœ ê²½ìš° í í•­ëª©ë§Œ ì œê±°
                        await syncQueueManager.markAsSuccess(queueItem.id);
                        console.log(`ë©”ëª¨ê°€ ì´ë¯¸ ì‚­ì œë¨: ${queueItem.serverMemoId}`);
                        return;
                    }

                    if (!localMemo.serverId) {
                        throw new Error('ì„œë²„ IDê°€ ì—†ì–´ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }

                    localMemo.syncStatus = 'syncing';
                    await dbManager.saveMemo(localMemo);

                    response = await apiClient.delete(`/memos/${queueItem.serverMemoId}`);

                    // ì‚­ì œ ì™„ë£Œ í›„ ë¡œì»¬ì—ì„œë„ ì‚­ì œ
                    await dbManager.deleteMemo(localMemo.localId);
                    console.log(`ë©”ëª¨ ì‚­ì œ ë™ê¸°í™” ì„±ê³µ: ${localMemo.localId} â†’ ${queueItem.serverMemoId}`);
                    break;

                default:
                    throw new Error(`ì•Œ ìˆ˜ ì—†ëŠ” ë™ê¸°í™” íƒ€ì…: ${queueItem.type}`);
            }

            // ë™ê¸°í™” íì—ì„œ ì œê±°
            await syncQueueManager.markAsSuccess(queueItem.id);
        } catch (error) {
            // ë™ê¸°í™” ì‹¤íŒ¨ ì²˜ë¦¬
            if (queueItem.localMemoId) {
                const localMemo = await dbManager.getMemoByLocalId(queueItem.localMemoId);
                if (localMemo) {
            localMemo.syncStatus = 'failed';
            await dbManager.saveMemo(localMemo);
                }
            }

            // ë™ê¸°í™” íì— ì—ëŸ¬ ê¸°ë¡ ë° ì¬ì‹œë„ ì˜ˆì•½
            await syncQueueManager.markAsFailed(queueItem.id, error.message);
            throw error;
        }
    }

    /**
     * ì£¼ê¸°ì  ì •ë¦¬ ì‘ì—… (í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ)
     * 30ì¼ ì´ìƒ ëœ ë™ê¸°í™” ì™„ë£Œ ë©”ëª¨ ì‚­ì œ
     */
    async periodicCleanup() {
        await this.init();

        const thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);

        // ë™ê¸°í™” ì™„ë£Œëœ ë©”ëª¨ ì¡°íšŒ
        const syncedMemos = await dbManager.getSyncedMemos();

        let deletedCount = 0;
        for (const memo of syncedMemos) {
            const updatedAt = new Date(memo.updatedAt);
            if (updatedAt < thirtyDaysAgo) {
                // 30ì¼ ì´ìƒ ëœ ë™ê¸°í™” ì™„ë£Œ ë©”ëª¨ ì‚­ì œ
                await dbManager.deleteMemo(memo.localId);
                deletedCount++;
            }
        }

        if (deletedCount > 0) {
            console.log(`ì£¼ê¸°ì  ì •ë¦¬ ì™„ë£Œ: ${deletedCount}ê°œì˜ ì˜¤ë˜ëœ ë©”ëª¨ ì‚­ì œ`);
        }

        return deletedCount;
    }
}

export const offlineMemoService = new OfflineMemoService();
```

### 3. ë™ê¸°í™” í ê´€ë¦¬ì

```javascript
// services/sync-queue-manager.js
import { dbManager } from '../storage/indexeddb-manager.js';

class SyncQueueManager {
    constructor() {
        this.maxRetries = 3;
        this.retryDelay = 5000; // 5ì´ˆ
    }

    /**
     * ë™ê¸°í™” íì— í•­ëª© ì¶”ê°€
     */
    async enqueue(item) {
        const queueItem = {
            id: this.generateId(),
            type: item.type,
            localMemoId: item.localMemoId,
            serverMemoId: item.serverMemoId || null, // UPDATE/DELETE ì‹œ í•„ìš”
            data: item.data,
            status: 'PENDING',
            retryCount: 0,
            error: null,
            createdAt: new Date().toISOString(),
            lastRetryAt: null
        };

        const transaction = dbManager.db.transaction(['sync_queue'], 'readwrite');
        const store = transaction.objectStore('sync_queue');
        await store.put(queueItem);

        return queueItem;
    }

    /**
     * ë™ê¸°í™” í í•­ëª© ìƒíƒœ ì—…ë°ì´íŠ¸
     */
    async updateStatus(queueId, status) {
        const transaction = dbManager.db.transaction(['sync_queue'], 'readwrite');
        const store = transaction.objectStore('sync_queue');
        const item = await store.get(queueId);
        if (item) {
            item.status = status;
            item.updatedAt = new Date().toISOString();
            if (status === 'SYNCING') {
                item.lastRetryAt = new Date().toISOString();
            }
            await store.put(item);
        }
    }

    /**
     * ë™ê¸°í™” í í•­ëª© ì œê±°
     */
    async removeQueueItem(queueId) {
        const transaction = dbManager.db.transaction(['sync_queue'], 'readwrite');
        const store = transaction.objectStore('sync_queue');
        await store.delete(queueId);
    }

    /**
     * ë™ê¸°í™” ì„±ê³µ ì²˜ë¦¬
     */
    async markAsSuccess(queueId) {
        const transaction = dbManager.db.transaction(['sync_queue'], 'readwrite');
        const store = transaction.objectStore('sync_queue');
        const item = await store.get(queueId);
        if (item) {
            item.status = 'SUCCESS';
            await store.put(item);
        }
    }

    /**
     * ë™ê¸°í™” ì‹¤íŒ¨ ì²˜ë¦¬ ë° ì¬ì‹œë„ ì˜ˆì•½
     */
    async markAsFailed(queueId, errorMessage) {
        const transaction = dbManager.db.transaction(['sync_queue'], 'readwrite');
        const store = transaction.objectStore('sync_queue');
        const item = await store.get(queueId);

        if (item) {
            item.status = 'FAILED';
            item.error = errorMessage;
            item.retryCount += 1;
            item.lastRetryAt = new Date().toISOString();

            // ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ í™•ì¸
            if (item.retryCount < this.maxRetries) {
                // ì¬ì‹œë„ ì˜ˆì•½ (Exponential Backoff)
                const delay = this.retryDelay * Math.pow(2, item.retryCount - 1);
                setTimeout(() => {
                    this.retrySync(item);
                }, delay);
            }

            await store.put(item);
        }
    }

    /**
     * ì¬ì‹œë„ ì‹¤í–‰
     */
    async retrySync(queueItem) {
        // ë©”ëª¨ ì„œë¹„ìŠ¤ë¥¼ í†µí•´ ì¬ë™ê¸°í™” ì‹œë„
        const localMemo = await dbManager.getMemoByLocalId(queueItem.localMemoId);
        if (localMemo && localMemo.syncStatus !== 'synced') {
            queueItem.status = 'PENDING';
            await this.enqueue(queueItem);
            // offlineMemoService.syncSingleMemo í˜¸ì¶œ
        }
    }

    /**
     * ëª¨ë“  ëŒ€ê¸° ì¤‘ì¸ í í•­ëª© ì¡°íšŒ
     */
    async getPendingItems() {
        const transaction = dbManager.db.transaction(['sync_queue'], 'readonly');
        const store = transaction.objectStore('sync_queue');
        const index = store.index('status');
        return index.getAll('PENDING');
    }

    generateId() {
        return 'sync-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
    }
}

export const syncQueueManager = new SyncQueueManager();
```

### 4. ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ëª¨ë‹ˆí„°

```javascript
// utils/network-monitor.js
class NetworkMonitor {
    constructor() {
        this.isOnline = navigator.onLine;
        this.listeners = [];
        this.init();
    }

    init() {
        window.addEventListener('online', () => {
            console.log('ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë³µêµ¬');
            this.isOnline = true;
            this.notifyListeners(true);
            this.onNetworkOnline();
        });

        window.addEventListener('offline', () => {
            console.log('ë„¤íŠ¸ì›Œí¬ ì—°ê²° ëŠê¹€');
            this.isOnline = false;
            this.notifyListeners(false);
        });
    }

    /**
     * ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ëŒ€ê¸° ì¤‘ì¸ ë©”ëª¨ ë™ê¸°í™”
     */
    async onNetworkOnline() {
        // ì•½ê°„ì˜ ì§€ì—° í›„ ë™ê¸°í™” (ë„¤íŠ¸ì›Œí¬ ì•ˆì •í™” ëŒ€ê¸°)
        setTimeout(async () => {
            try {
                await offlineMemoService.syncPendingMemos();
            } catch (error) {
                console.error('ìë™ ë™ê¸°í™” ì‹¤íŒ¨:', error);
            }
        }, 1000);
    }

    subscribe(callback) {
        this.listeners.push(callback);
        return () => {
            this.listeners = this.listeners.filter(cb => cb !== callback);
        };
    }

    notifyListeners(isOnline) {
        this.listeners.forEach(callback => callback(isOnline));
    }
}

export const networkMonitor = new NetworkMonitor();
```

### 5. í†µí•© API í´ë¼ì´ì–¸íŠ¸ (ì˜¤í”„ë¼ì¸ ì§€ì›)

```javascript
// services/memo-service.js (ê°œì„ ëœ ë²„ì „)
import { offlineMemoService } from './offline-memo-service.js';
import { networkMonitor } from '../utils/network-monitor.js';
import { apiClient } from './api-client.js';

class MemoService {
    /**
     * ë©”ëª¨ ì‘ì„± (ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ìë™ ì²˜ë¦¬)
     */
    async createMemo(memoData) {
        // í•­ìƒ ë¡œì»¬ ì €ì¥ì†Œì— ë¨¼ì € ì €ì¥
        const localMemo = await offlineMemoService.createMemo(memoData);

        // ì˜¨ë¼ì¸ ìƒíƒœë©´ ì¦‰ì‹œ ë™ê¸°í™” ì‹œë„, ì˜¤í”„ë¼ì¸ì´ë©´ ëŒ€ê¸°
        if (networkMonitor.isOnline) {
            // ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë™ê¸°í™” (await í•˜ì§€ ì•ŠìŒ)
            offlineMemoService.syncPendingMemos().catch(error => {
                console.error('ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì‹¤íŒ¨:', error);
            });
        }

        // ë¡œì»¬ ë©”ëª¨ë¥¼ ì¦‰ì‹œ ë°˜í™˜ (ë‚™ê´€ì  ì—…ë°ì´íŠ¸)
        return this.mapLocalMemoToResponse(localMemo);
    }

    /**
     * ë©”ëª¨ ëª©ë¡ ì¡°íšŒ (ë¡œì»¬ + ì„œë²„ í†µí•©)
     * í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ: ìµœê·¼ 7ì¼ ë©”ëª¨ë§Œ IndexedDBì— ì €ì¥
     */
    async getMemos(userBookId, date) {
        // ë¡œì»¬ ë©”ëª¨ ì¡°íšŒ
        const localMemos = await offlineMemoService.getMemosByBook(userBookId);

        // ì˜¨ë¼ì¸ ìƒíƒœë©´ ì„œë²„ì—ì„œë„ ì¡°íšŒí•˜ì—¬ í†µí•©
        if (networkMonitor.isOnline) {
            try {
                const serverResponse = await apiClient.get(`/memos/books/${userBookId}`, {
                    params: { date }
                });
                const serverMemos = serverResponse.data;

                // âœ… í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ: ìµœê·¼ 7ì¼ ë©”ëª¨ë§Œ IndexedDBì— ì €ì¥
                const today = new Date();
                const sevenDaysAgo = new Date(today);
                sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);

                for (const serverMemo of serverMemos) {
                    const memoDate = new Date(serverMemo.memoStartTime || serverMemo.createdAt);
                    
                    // ìµœê·¼ 7ì¼ ë©”ëª¨ë§Œ IndexedDBì— ì €ì¥ (ì˜¤í”„ë¼ì¸ ì¡°íšŒìš©)
                    if (memoDate >= sevenDaysAgo) {
                        await offlineMemoService.saveServerMemoAsLocal(serverMemo);
                    }
                    // ì˜¤ë˜ëœ ë©”ëª¨ëŠ” ì €ì¥í•˜ì§€ ì•ŠìŒ (ì„œë²„ì—ì„œë§Œ ì¡°íšŒ)
                }

                // ë¡œì»¬ ë©”ëª¨ì™€ ì„œë²„ ë©”ëª¨ í†µí•©
                return this.mergeMemos(localMemos, serverMemos);
            } catch (error) {
                console.error('ì„œë²„ ë©”ëª¨ ì¡°íšŒ ì‹¤íŒ¨, ë¡œì»¬ ë©”ëª¨ë§Œ ë°˜í™˜:', error);
                return this.mapLocalMemosToResponse(localMemos);
            }
        } else {
            // ì˜¤í”„ë¼ì¸ ìƒíƒœë©´ ë¡œì»¬ ë©”ëª¨ë§Œ ë°˜í™˜
            // (ìµœê·¼ 7ì¼ ë©”ëª¨ê°€ IndexedDBì— ì €ì¥ë˜ì–´ ìˆìŒ)
            return this.mapLocalMemosToResponse(localMemos);
        }
    }

    /**
     * ë¡œì»¬ ë©”ëª¨ì™€ ì„œë²„ ë©”ëª¨ í†µí•©
     */
    mergeMemos(localMemos, serverMemos) {
        // ì„œë²„ ë©”ëª¨ë¥¼ ë§µìœ¼ë¡œ ë³€í™˜ (ì¤‘ë³µ ì œê±°ìš©)
        const serverMemoMap = new Map();
        serverMemos.forEach(memo => {
            serverMemoMap.set(memo.id, memo);
        });

        // ë¡œì»¬ ë©”ëª¨ ì¤‘ ë™ê¸°í™” ì™„ë£Œëœ ê²ƒì€ ì„œë²„ ë©”ëª¨ë¡œ ëŒ€ì²´
        const result = [];
        localMemos.forEach(localMemo => {
            if (localMemo.syncStatus === 'synced' && localMemo.serverId) {
                // ì„œë²„ ë©”ëª¨ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ë¡œì»¬ ë©”ëª¨ ì‚¬ìš©
                const serverMemo = serverMemoMap.get(localMemo.serverId);
                if (serverMemo) {
                    result.push(serverMemo);
                    serverMemoMap.delete(localMemo.serverId); // ì´ë¯¸ ì²˜ë¦¬ë¨
                } else {
                    result.push(this.mapLocalMemoToResponse(localMemo));
                }
            } else {
                // ë™ê¸°í™” ëŒ€ê¸° ì¤‘ì¸ ë¡œì»¬ ë©”ëª¨
                result.push(this.mapLocalMemoToResponse(localMemo));
            }
        });

        // ì„œë²„ì—ë§Œ ìˆëŠ” ë©”ëª¨ ì¶”ê°€
        serverMemoMap.forEach(memo => {
            result.push(memo);
        });

        // ì‹œê°„ìˆœ ì •ë ¬
        return result.sort((a, b) => {
            const timeA = new Date(a.memoStartTime || a.createdAt);
            const timeB = new Date(b.memoStartTime || b.createdAt);
            return timeA - timeB;
        });
    }

    mapLocalMemoToResponse(localMemo) {
        return {
            id: localMemo.serverId || localMemo.localId, // ì„œë²„ IDê°€ ì—†ìœ¼ë©´ ë¡œì»¬ ID ì‚¬ìš©
            localId: localMemo.localId,
            userBookId: localMemo.userBookId,
            content: localMemo.content,
            tags: localMemo.tags,
            pageNumber: localMemo.pageNumber,
            memoStartTime: localMemo.memoStartTime,
            syncStatus: localMemo.syncStatus,
            createdAt: localMemo.createdAt,
            updatedAt: localMemo.updatedAt
        };
    }

    mapLocalMemosToResponse(localMemos) {
        return localMemos.map(memo => this.mapLocalMemoToResponse(memo));
    }
}

export const memoService = new MemoService();
```

---

## ë™ê¸°í™” ì „ëµ

### ë°ì´í„° ë™ê¸°í™” ì „ëµ ê°œìš”

**ë°ì´í„° ë™ê¸°í™” ì „ëµ**ì€ ë¡œì»¬ ë°ì´í„°ì™€ ì„œë²„ ë°ì´í„°ì˜ ì •í•©ì„±ì„ ìœ ì§€í•˜ê¸° ìœ„í•œ ì „ëµì…ë‹ˆë‹¤. Offline-First ì•„í‚¤í…ì²˜ì—ì„œ í•µì‹¬ì ì¸ ì—­í• ì„ í•©ë‹ˆë‹¤.

**í•µì‹¬ ì›ë¦¬**:
1. **ë¡œì»¬ ìš°ì„  ì €ì¥**: ì‚¬ìš©ìê°€ ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œ ë°ì´í„°ë¥¼ ë³€ê²½í–ˆì„ ë•Œ ì´ë¥¼ ë¡œì»¬ì— ì €ì¥í•´ë‘ì—ˆë‹¤ê°€, ì˜¨ë¼ì¸ì´ ë˜ë©´ ì„œë²„ì— ì „ì†¡
2. **ì •í•©ì„± ìœ ì§€**: ë¡œì»¬ ë°ì´í„°ì™€ ì„œë²„ ë°ì´í„° ê°„ì˜ ì¼ê´€ì„± ë³´ì¥
3. **ì¶©ëŒ í•´ê²°**: ë™ì‹œ ìˆ˜ì • ì‹œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì¶©ëŒ ì²˜ë¦¬

**ë™ì‘ íë¦„**:
```
[ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œ ë°ì´í„° ë³€ê²½]
    â†“
[ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥] â† ì¦‰ì‹œ ì‹¤í–‰
    â†“
[ë™ê¸°í™” íì— ì¶”ê°€] â† ëŒ€ê¸° ìƒíƒœ
    â†“
[ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ê°ì§€]
    â†“
[ì„œë²„ì— ì „ì†¡] â† ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™”
    â†“
[ì„œë²„ ì‘ë‹µ ì²˜ë¦¬]
    â”œâ”€ ì„±ê³µ â†’ ë¡œì»¬ ë°ì´í„° ì—…ë°ì´íŠ¸ (ì„œë²„ ID ë§¤í•‘)
    â””â”€ ì‹¤íŒ¨ â†’ ì¬ì‹œë„ íì— ì¶”ê°€
```

**êµ¬í˜„ ì „ëµ**:

### 1. ì¦‰ì‹œ ë™ê¸°í™” (ë‚™ê´€ì  ì—…ë°ì´íŠ¸)

- ë©”ëª¨ ì‘ì„± ì¦‰ì‹œ ë¡œì»¬ ì €ì¥
- UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸
- ì˜¨ë¼ì¸ ìƒíƒœë©´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë™ê¸°í™”
- ì‚¬ìš©ì ê²½í—˜ ìµœìš°ì„ 

### 2. ìë™ ì¬ì‹œë„

- Exponential Backoff ì „ëµ
- ìµœëŒ€ 3íšŒ ì¬ì‹œë„
- ì¬ì‹œë„ ê°„ê²©: 5ì´ˆ, 10ì´ˆ, 20ì´ˆ

### 3. ë°°ì¹˜ ë™ê¸°í™”

- ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ëª¨ë“  ëŒ€ê¸° ì¤‘ì¸ ë©”ëª¨ ìˆœì°¨ ë™ê¸°í™”
- ìˆœì„œ ë³´ì¥: `memoStartTime` ê¸°ì¤€ ì •ë ¬ í›„ ë™ê¸°í™”

### 6. Service Worker Sync Strategy (ë™ê¸°í™” ì „ëµ) â­

**ì „ëµ ê°œìš”**: Service Workerê°€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë„¤íŠ¸ì›Œí¬ ìƒíƒœë¥¼ ê°ì‹œí•˜ê³ , ë™ê¸°í™” íì— ì €ì¥ëœ ëª¨ë“  ì˜¤í”„ë¼ì¸ ìš”ì²­ë“¤ì„ ìˆœì„œëŒ€ë¡œ ì„œë²„ì— ì „ì†¡(Replay)í•˜ëŠ” ì„¸ë°€í•œ ì œì–´ ì „ëµì…ë‹ˆë‹¤.

**í•µì‹¬ ì›ì¹™**:

1. **ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ê°ì‹œ**
   - Service Workerê°€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì£¼ê¸°ì ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸
   - Background Sync APIë¥¼ í†µí•œ ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ê°ì§€
   - ì‹¤ì œ ì„œë²„ ì—°ê²° ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸ (í—¬ìŠ¤ì²´í¬)

2. **ìˆœì„œ ë³´ì¥ ë™ê¸°í™”**
   - ë™ê¸°í™” íì—ì„œ ìš”ì²­ì„ ìˆœì„œëŒ€ë¡œ êº¼ë‚´ì–´ ì²˜ë¦¬
   - `memoStartTime` ë˜ëŠ” `createdAt` ê¸°ì¤€ ì •ë ¬
   - í•œ ë²ˆì— í•˜ë‚˜ì”© ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬ (ë™ì‹œì„± ì œì–´)

3. **ìš”ì²­ ì¬í˜„(Replay)**
   - ë™ê¸°í™” íì— ì €ì¥ëœ ì›ë³¸ ìš”ì²­ ë°ì´í„°ë¡œ API í˜¸ì¶œ
   - ì›ë³¸ ìš”ì²­ URL, Method, Body ê·¸ëŒ€ë¡œ ì¬ì „ì†¡
   - ì¸ì¦ í† í° ë“± í•„ìš”í•œ í—¤ë” ìë™ ì¶”ê°€

4. **ì„¸ë°€í•œ ì œì–´**
   - ì¬ì‹œë„ ì „ëµ: Exponential Backoff (5ì´ˆ, 10ì´ˆ, 20ì´ˆ)
   - ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜: 3íšŒ
   - ë¶€ë¶„ ì‹¤íŒ¨ ì²˜ë¦¬: ì¼ë¶€ ì‹¤íŒ¨í•´ë„ ë‚˜ë¨¸ì§€ ê³„ì† ì§„í–‰
   - ìƒíƒœ ê´€ë¦¬: PENDING â†’ SYNCING â†’ SUCCESS/FAILED

**ë™ì‘ íë¦„**:

```
[ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ê°ì§€]
    â†“
[Background Sync ì´ë²¤íŠ¸ ë°œìƒ]
    â†“
[Service Worker: syncPendingMemos() í˜¸ì¶œ]
    â†“
[1. ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸]
    â”œâ”€ ì˜¤í”„ë¼ì¸ â†’ ëŒ€ê¸°
    â””â”€ ì˜¨ë¼ì¸ â†’ ë‹¤ìŒ ë‹¨ê³„
    â†“
[2. ë™ê¸°í™” íì—ì„œ PENDING í•­ëª© ì¡°íšŒ]
    â†“
[3. ìˆœì„œ ë³´ì¥: memoStartTime ê¸°ì¤€ ì •ë ¬]
    â†“
[4. ìˆœì°¨ì ìœ¼ë¡œ ê° í•­ëª© ì²˜ë¦¬]
    for each queueItem:
        [4-1] ìƒíƒœ ì—…ë°ì´íŠ¸: PENDING â†’ SYNCING
        â†“
        [4-2] ìš”ì²­ ì¬í˜„(Replay): ì›ë³¸ ìš”ì²­ ë°ì´í„°ë¡œ API í˜¸ì¶œ
        â†“
        [4-3] ì‘ë‹µ ì²˜ë¦¬]
            â”œâ”€ ì„±ê³µ â†’ ìƒíƒœ: SUCCESS, íì—ì„œ ì œê±° ë˜ëŠ” ìœ ì§€
            â””â”€ ì‹¤íŒ¨ â†’ ì¬ì‹œë„ ë¡œì§ ì ìš©
                â”œâ”€ ì¬ì‹œë„ ê°€ëŠ¥ â†’ Exponential Backoff í›„ ì¬ì‹œë„
                â””â”€ ìµœëŒ€ ì¬ì‹œë„ ì´ˆê³¼ â†’ ìƒíƒœ: FAILED
    â†“
[5. ë™ê¸°í™” ì™„ë£Œ]
```

**êµ¬í˜„ ì˜ˆì‹œ** (ìœ„ Service Worker ì½”ë“œì— í¬í•¨ë¨):

```javascript
// Service Worker: Background Sync ì´ë²¤íŠ¸ ì²˜ë¦¬
self.addEventListener('sync', (event) => {
    if (event.tag === 'sync-memos') {
        event.waitUntil(syncPendingMemos());
    }
});

// ë™ê¸°í™” ì „ëµ ì‹¤í–‰
async function syncPendingMemos() {
    // 1. ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸
    if (!await checkNetworkStatus()) {
        return; // ì˜¤í”„ë¼ì¸ ìƒíƒœë©´ ëŒ€ê¸°
    }
    
    // 2. ë™ê¸°í™” íì—ì„œ PENDING í•­ëª© ì¡°íšŒ
    const pendingQueueItems = await getPendingQueueItemsFromIndexedDB();
    
    // 3. ìˆœì„œ ë³´ì¥: memoStartTime ê¸°ì¤€ ì •ë ¬
    pendingQueueItems.sort((a, b) => {
        const timeA = new Date(a.data.memoStartTime || a.createdAt);
        const timeB = new Date(b.data.memoStartTime || b.createdAt);
        return timeA - timeB;
    });
    
    // 4. ìˆœì°¨ì ìœ¼ë¡œ ìš”ì²­ ì¬í˜„(Replay)
    for (const queueItem of pendingQueueItems) {
        try {
            await updateQueueItemStatus(queueItem.id, 'SYNCING');
            
            // ì›ë³¸ ìš”ì²­ ì¬í˜„
            const response = await replayRequest(queueItem);
            
            if (response.ok) {
                await updateQueueItemStatus(queueItem.id, 'SUCCESS');
            } else {
                throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`);
            }
        } catch (error) {
            // ì¬ì‹œë„ ë¡œì§ ì ìš©
            await handleSyncFailure(queueItem, error);
        }
    }
}
```

**ì£¼ê¸°ì  ë„¤íŠ¸ì›Œí¬ ê°ì‹œ**:

```javascript
// Service Worker: ì£¼ê¸°ì ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸
setInterval(async () => {
    const isOnline = await checkNetworkStatus();
    if (isOnline) {
        // ëŒ€ê¸° ì¤‘ì¸ ë™ê¸°í™” í•­ëª©ì´ ìˆìœ¼ë©´ Background Sync ë“±ë¡
        const pendingCount = await getPendingQueueItemCount();
        if (pendingCount > 0) {
            await self.registration.sync.register('sync-memos');
        }
    }
}, 30000); // 30ì´ˆë§ˆë‹¤ í™•ì¸
```

**ì¥ì **:
- âœ… ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìë™ ë™ê¸°í™” (ì‚¬ìš©ì ê°œì… ë¶ˆí•„ìš”)
- âœ… ìˆœì„œ ë³´ì¥ (ì‘ì„± ì‹œê°„ ìˆœì„œëŒ€ë¡œ ë™ê¸°í™”)
- âœ… ì„¸ë°€í•œ ì œì–´ (ì¬ì‹œë„, ìš°ì„ ìˆœìœ„, ìƒíƒœ ê´€ë¦¬)
- âœ… ì•ˆì •ì ì¸ ë™ê¸°í™” (ë¶€ë¶„ ì‹¤íŒ¨ ì²˜ë¦¬, ì¬ì‹œë„ ì „ëµ)

**ê³ ë ¤ì‚¬í•­**:
- Background SyncëŠ” ë¸Œë¼ìš°ì €ê°€ ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ë¥¼ ê°ì§€í•  ë•Œ ìë™ìœ¼ë¡œ íŠ¸ë¦¬ê±°ë¨
- ì£¼ê¸°ì  ê°ì‹œëŠ” ì¶”ê°€ ë³´ì™„ì±…ìœ¼ë¡œ ì‚¬ìš© (30ì´ˆ ê°„ê²©)
- ë™ê¸°í™” íì˜ í¬ê¸°ê°€ í´ ê²½ìš° ë°°ì¹˜ ì²˜ë¦¬ ê³ ë ¤

### 4. ë¶€ë¶„ ì‹¤íŒ¨ ì²˜ë¦¬

- ì¼ë¶€ ë©”ëª¨ë§Œ ë™ê¸°í™” ì‹¤íŒ¨í•´ë„ ë‚˜ë¨¸ì§€ëŠ” ê³„ì† ì§„í–‰
- ì‹¤íŒ¨í•œ ë©”ëª¨ëŠ” ì¬ì‹œë„ íì— ì¶”ê°€

### 5. í•˜ì´ë¸Œë¦¬ë“œ ë°ì´í„° ì •ë¦¬ ì „ëµ â­

**ì „ëµ ê°œìš”**: ìµœê·¼ ë©”ëª¨ëŠ” IndexedDBì— ë³´ê´€í•˜ì—¬ ì˜¤í”„ë¼ì¸ ì¡°íšŒë¥¼ ì§€ì›í•˜ê³ , ì˜¤ë˜ëœ ë©”ëª¨ëŠ” ìë™ìœ¼ë¡œ ì •ë¦¬í•˜ì—¬ ìš©ëŸ‰ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.

**í•µì‹¬ ì›ì¹™**:
1. **ìµœê·¼ ë©”ëª¨ ë³´ê´€**: ìµœê·¼ 7ì¼ ì´ë‚´ ë©”ëª¨ëŠ” IndexedDBì— ë³´ê´€ (ì˜¤í”„ë¼ì¸ ì¡°íšŒ ì§€ì›)
2. **ì˜¤ë˜ëœ ë©”ëª¨ ì •ë¦¬**: 30ì¼ ì´ìƒ ëœ ë™ê¸°í™” ì™„ë£Œ ë©”ëª¨ëŠ” ìë™ ì‚­ì œ
3. **ë™ê¸°í™” ëŒ€ê¸° ë©”ëª¨ ìœ ì§€**: ë™ê¸°í™” ëŒ€ê¸°/ì‹¤íŒ¨ ë©”ëª¨ëŠ” ì¬ì‹œë„ë¥¼ ìœ„í•´ ìœ ì§€

**êµ¬í˜„ ë°©ì‹**:

```javascript
// ë™ê¸°í™” ì™„ë£Œ í›„ ì²˜ë¦¬
async afterSyncComplete(localMemo, serverMemo) {
    // 1. ì„œë²„ ID ì—…ë°ì´íŠ¸
    await dbManager.updateMemoWithServerId(localMemo.localId, serverMemo.id);
    
    // 2. í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ: ìµœê·¼ 7ì¼ ë©”ëª¨ë§Œ ë³´ê´€
    const sevenDaysAgo = new Date();
    sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
    const memoDate = new Date(localMemo.memoStartTime);
    
    if (memoDate < sevenDaysAgo) {
        // 7ì¼ ì´ìƒ ëœ ë©”ëª¨ëŠ” ì‚­ì œ (ì„œë²„ì—ì„œ ì¡°íšŒ ê°€ëŠ¥)
        await dbManager.deleteMemo(localMemo.localId);
    } else {
        // ìµœê·¼ 7ì¼ ë©”ëª¨ëŠ” ë³´ê´€ (ì˜¤í”„ë¼ì¸ ì¡°íšŒìš©)
        // syncStatusëŠ” 'synced'ë¡œ ìœ ì§€
    }
}

// ì£¼ê¸°ì  ì •ë¦¬ ì‘ì—…
async periodicCleanup() {
    // 30ì¼ ì´ìƒ ëœ ë™ê¸°í™” ì™„ë£Œ ë©”ëª¨ ì‚­ì œ
    const thirtyDaysAgo = new Date();
    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
    
    const syncedMemos = await dbManager.getSyncedMemos();
    for (const memo of syncedMemos) {
        const updatedAt = new Date(memo.updatedAt);
        if (updatedAt < thirtyDaysAgo) {
            await dbManager.deleteMemo(memo.localId);
        }
    }
}
```

**ì¥ì **:
- âœ… ìµœê·¼ ë©”ëª¨ëŠ” ì˜¤í”„ë¼ì¸ì—ì„œë„ ì¡°íšŒ ê°€ëŠ¥
- âœ… ìš©ëŸ‰ ìë™ ê´€ë¦¬ (ì˜¤ë˜ëœ ë©”ëª¨ ì‚­ì œ)
- âœ… ì„±ëŠ¥ ìœ ì§€ (IndexedDB í¬ê¸° ì œí•œ)
- âœ… ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ (ì˜¤í”„ë¼ì¸ì—ì„œë„ ìµœê·¼ ë©”ëª¨ í™•ì¸ ê°€ëŠ¥)

**ë³´ê´€ ê¸°ê°„ ì„¤ì •**:
- ìµœê·¼ ë©”ëª¨ ë³´ê´€ ê¸°ê°„: 7ì¼ (í•„ìš”ì— ë”°ë¼ ì¡°ì • ê°€ëŠ¥)
- ìë™ ì •ë¦¬ ê¸°ê°„: 30ì¼ (í•„ìš”ì— ë”°ë¼ ì¡°ì • ê°€ëŠ¥)

---

## ì¶©ëŒ í•´ê²°

### ì‹œë‚˜ë¦¬ì˜¤

**ì¶©ëŒì´ ë°œìƒí•˜ì§€ ì•ŠëŠ” ê²½ìš°**:
- ì˜¤í”„ë¼ì¸ ë©”ëª¨ ìƒì„±(CREATE): ì„œë²„ì—ì„œ IDë¥¼ ìƒì„±í•˜ë¯€ë¡œ ì¤‘ë³µ ìƒì„± ë¬¸ì œ ì—†ìŒ
- ì˜¤í”„ë¼ì¸ ë©”ëª¨ ì‚­ì œ(DELETE): ì„œë²„ì—ì„œ ì‚­ì œí•˜ë¯€ë¡œ ì¤‘ë³µ ì‚­ì œ ë¬¸ì œ ì—†ìŒ
- ë™ì¼í•œ ë©”ëª¨ë¥¼ ë‘ ë²ˆ ì‘ì„±í•œ ê²½ìš°ëŠ” ì‚¬ìš©ì ì˜ë„ë¡œ ê°„ì£¼

**ì¶©ëŒì´ ë°œìƒí•  ìˆ˜ ìˆëŠ” ê²½ìš°**:
- ë©”ëª¨ ìˆ˜ì •(UPDATE): ì˜¤í”„ë¼ì¸ì—ì„œ ìˆ˜ì •í•œ ë©”ëª¨ì™€ ì„œë²„ì˜ ë©”ëª¨ê°€ ë‹¤ë¥¼ ê²½ìš°
  - ì˜ˆ: ì˜¤í”„ë¼ì¸ì—ì„œ ë©”ëª¨ Aë¥¼ ìˆ˜ì • â†’ ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì „ì— ë‹¤ë¥¸ ë””ë°”ì´ìŠ¤ì—ì„œ ë©”ëª¨ Aë¥¼ ìˆ˜ì • â†’ ë™ê¸°í™” ì‹œ ì¶©ëŒ ê°€ëŠ¥

### ì¶©ëŒ í•´ê²° ì „ëµ

#### 1. Last-Write-Wins (ë§ˆì§€ë§‰ ì“°ê¸° ìš°ì„ ) ì „ëµ â­ (ê¶Œì¥)

**ì›ì¹™**: ê°€ì¥ ìµœê·¼ì— ìˆ˜ì •í•œ ë‚´ìš©ì„ ìš°ì„ ìœ¼ë¡œ ì ìš©

**ë™ì‘ ë°©ì‹**:
1. ì˜¤í”„ë¼ì¸ì—ì„œ ë©”ëª¨ ìˆ˜ì • ì‹œ `updatedAt` íƒ€ì„ìŠ¤íƒ¬í”„ ì €ì¥
2. ë™ê¸°í™” ì‹œ ì„œë²„ì˜ `updatedAt`ê³¼ ë¹„êµ
3. ë¡œì»¬ `updatedAt`ì´ ë” ìµœì‹ ì´ë©´ ë¡œì»¬ ë‚´ìš©ìœ¼ë¡œ ë®ì–´ì“°ê¸°
4. ì„œë²„ `updatedAt`ì´ ë” ìµœì‹ ì´ë©´ ì„œë²„ ë‚´ìš©ìœ¼ë¡œ ë®ì–´ì“°ê¸°

**êµ¬í˜„ ì˜ˆì‹œ**:
```javascript
async syncUpdateMemo(queueItem, localMemo) {
    try {
        // ì„œë²„ì—ì„œ ìµœì‹  ë©”ëª¨ ì¡°íšŒ
        const serverMemo = await apiClient.get(`/memos/${queueItem.serverMemoId}`);
        
        // updatedAt ë¹„êµ
        const localUpdatedAt = new Date(localMemo.updatedAt);
        const serverUpdatedAt = new Date(serverMemo.updatedAt);
        
        if (localUpdatedAt > serverUpdatedAt) {
            // ë¡œì»¬ì´ ë” ìµœì‹  â†’ ë¡œì»¬ ë‚´ìš©ìœ¼ë¡œ ì„œë²„ ì—…ë°ì´íŠ¸
            await apiClient.put(`/memos/${queueItem.serverMemoId}`, queueItem.data);
        } else if (serverUpdatedAt > localUpdatedAt) {
            // ì„œë²„ê°€ ë” ìµœì‹  â†’ ì„œë²„ ë‚´ìš©ìœ¼ë¡œ ë¡œì»¬ ì—…ë°ì´íŠ¸
            localMemo.content = serverMemo.content;
            localMemo.tags = serverMemo.tags;
            localMemo.pageNumber = serverMemo.pageNumber;
            localMemo.updatedAt = serverMemo.updatedAt;
            await dbManager.saveMemo(localMemo);
            
            // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ (ì„ íƒì )
            console.warn('ì„œë²„ì˜ ìµœì‹  ë‚´ìš©ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
        } else {
            // ë™ì¼í•œ ì‹œê°„ â†’ ë¡œì»¬ ë‚´ìš©ìœ¼ë¡œ ì—…ë°ì´íŠ¸
            await apiClient.put(`/memos/${queueItem.serverMemoId}`, queueItem.data);
        }
    } catch (error) {
        // ì¶©ëŒ í•´ê²° ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„
        throw error;
    }
}
```

**ì¥ì **:
- âœ… êµ¬í˜„ ë‹¨ìˆœ
- âœ… ìë™ ì¶©ëŒ í•´ê²°
- âœ… ì‚¬ìš©ì ê°œì… ë¶ˆí•„ìš”

**ë‹¨ì **:
- âš ï¸ ë°ì´í„° ì†ì‹¤ ê°€ëŠ¥ì„± (ë‚˜ì¤‘ì— ìˆ˜ì •í•œ ë‚´ìš©ì´ ì´ì „ ìˆ˜ì •ì„ ë®ì–´ì”€)

#### 2. ì‚¬ìš©ì í™•ì¸ ì „ëµ (ì„ íƒì )

**ì›ì¹™**: ì¶©ëŒ ë°œìƒ ì‹œ ì‚¬ìš©ìì—ê²Œ ì„ íƒê¶Œ ì œê³µ

**ë™ì‘ ë°©ì‹**:
1. ì¶©ëŒ ê°ì§€ ì‹œ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
2. ë¡œì»¬ ë‚´ìš©ê³¼ ì„œë²„ ë‚´ìš©ì„ ëª¨ë‘ í‘œì‹œ
3. ì‚¬ìš©ìê°€ ì„ íƒ (ë¡œì»¬ ìœ ì§€ / ì„œë²„ ìœ ì§€ / ìˆ˜ë™ ë³‘í•©)

**êµ¬í˜„ ì˜ˆì‹œ**:
```javascript
async syncUpdateMemoWithConflictResolution(queueItem, localMemo) {
    try {
        const serverMemo = await apiClient.get(`/memos/${queueItem.serverMemoId}`);
        
        const localUpdatedAt = new Date(localMemo.updatedAt);
        const serverUpdatedAt = new Date(serverMemo.updatedAt);
        
        if (localUpdatedAt > serverUpdatedAt) {
            // ë¡œì»¬ì´ ë” ìµœì‹  â†’ ì •ìƒ ì—…ë°ì´íŠ¸
            await apiClient.put(`/memos/${queueItem.serverMemoId}`, queueItem.data);
        } else if (serverUpdatedAt > localUpdatedAt) {
            // ì¶©ëŒ ê°ì§€ â†’ ì‚¬ìš©ì í™•ì¸
            const userChoice = await showConflictResolutionDialog({
                local: localMemo,
                server: serverMemo
            });
            
            if (userChoice === 'local') {
                await apiClient.put(`/memos/${queueItem.serverMemoId}`, queueItem.data);
            } else if (userChoice === 'server') {
                localMemo.content = serverMemo.content;
                localMemo.tags = serverMemo.tags;
                localMemo.pageNumber = serverMemo.pageNumber;
                localMemo.updatedAt = serverMemo.updatedAt;
                await dbManager.saveMemo(localMemo);
            } else if (userChoice === 'merge') {
                // ìˆ˜ë™ ë³‘í•© ë¡œì§
                const mergedMemo = await mergeMemos(localMemo, serverMemo);
                await apiClient.put(`/memos/${queueItem.serverMemoId}`, mergedMemo);
                await dbManager.saveMemo(mergedMemo);
            }
        }
    } catch (error) {
        throw error;
    }
}
```

**ì¥ì **:
- âœ… ë°ì´í„° ì†ì‹¤ ë°©ì§€
- âœ… ì‚¬ìš©ì ì œì–´

**ë‹¨ì **:
- âš ï¸ êµ¬í˜„ ë³µì¡ë„ ì¦ê°€
- âš ï¸ ì‚¬ìš©ì ê°œì… í•„ìš” (ì˜¤í”„ë¼ì¸ í™˜ê²½ì—ì„œ ë¶€ì í•©)

**ê²°ë¡ **: ë³¸ í”„ë¡œì íŠ¸ì—ì„œëŠ” **Last-Write-Wins ì „ëµ**ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì˜¤í”„ë¼ì¸ í™˜ê²½ì—ì„œ ìë™ìœ¼ë¡œ ì¶©ëŒì„ í•´ê²°í•˜ê³ , ì‚¬ìš©ì ê²½í—˜ì„ ìµœìš°ì„ ìœ¼ë¡œ ê³ ë ¤í•©ë‹ˆë‹¤.

### ì¤‘ë³µ ë°©ì§€

1. **ë¡œì»¬ ID ê¸°ì¤€**: ë¡œì»¬ ë©”ëª¨ëŠ” ê³ ìœ í•œ `localId`ë¡œ ì‹ë³„
2. **ì„œë²„ ID ë§¤í•‘**: ë™ê¸°í™” ì„±ê³µ ì‹œ `serverId` ì„¤ì •í•˜ì—¬ ë§¤í•‘
3. **ë™ê¸°í™” ìƒíƒœ ê´€ë¦¬**: `syncStatus`ë¡œ ì¤‘ë³µ ë™ê¸°í™” ë°©ì§€
4. **ë™ê¸°í™” í ìˆœì„œ ë³´ì¥**: `createdAt` ê¸°ì¤€ ì •ë ¬ë¡œ ì‘ì—… ìˆœì„œ ë³´ì¥
5. **ë©”ëª¨ ìˆ˜ì • ì‹œ ê¸°ì¡´ í í•­ëª© ì œê±°**: ë™ì¼í•œ ë©”ëª¨ë¥¼ ì—¬ëŸ¬ ë²ˆ ìˆ˜ì •í•œ ê²½ìš°, ìµœì‹  ìˆ˜ì • ë‚´ìš©ë§Œ ë™ê¸°í™”

---

## ì—ëŸ¬ ì²˜ë¦¬

### ë™ê¸°í™” ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤

1. **ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜**: ì¬ì‹œë„ íì— ì¶”ê°€
2. **ì„œë²„ ì—ëŸ¬ (4xx)**: 
   - ê²€ì¦ ì˜¤ë¥˜: ë¡œì»¬ ë©”ëª¨ì— ì—ëŸ¬ í‘œì‹œ, ìˆ˜ì • ìœ ë„
   - ì¸ì¦ ì˜¤ë¥˜: í† í° ê°±ì‹  í›„ ì¬ì‹œë„
   - ë©”ëª¨ ìˆ˜ì • ì‹œ 404 ì—ëŸ¬: ì„œë²„ì— ë©”ëª¨ê°€ ì—†ìŒ (ì´ë¯¸ ì‚­ì œë¨) â†’ ë¡œì»¬ ë©”ëª¨ë„ ì‚­ì œ
   - ë©”ëª¨ ì‚­ì œ ì‹œ 404 ì—ëŸ¬: ì„œë²„ì— ë©”ëª¨ê°€ ì—†ìŒ (ì´ë¯¸ ì‚­ì œë¨) â†’ ë¡œì»¬ ë©”ëª¨ë„ ì‚­ì œ, ë™ê¸°í™” ì„±ê³µìœ¼ë¡œ ì²˜ë¦¬
3. **ì„œë²„ ì—ëŸ¬ (5xx)**: ì¬ì‹œë„ íì— ì¶”ê°€

### ë©”ëª¨ ìˆ˜ì •/ì‚­ì œ ì‹œ íŠ¹ìˆ˜ ì¼€ì´ìŠ¤

#### 1. ì•„ì§ ë™ê¸°í™”ë˜ì§€ ì•Šì€ ë©”ëª¨ ìˆ˜ì •
- **ìƒí™©**: ì˜¤í”„ë¼ì¸ì—ì„œ ë©”ëª¨ë¥¼ ì‘ì„±í•œ í›„, ë™ê¸°í™” ì „ì— ìˆ˜ì • ì‹œë„
- **ì²˜ë¦¬**: ìˆ˜ì • ë¶ˆê°€ (ì„œë²„ IDê°€ ì—†ì–´ì„œ ìˆ˜ì •í•  ìˆ˜ ì—†ìŒ)
- **ì—ëŸ¬ ë©”ì‹œì§€**: "ì•„ì§ ë™ê¸°í™”ë˜ì§€ ì•Šì€ ë©”ëª¨ëŠ” ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë™ê¸°í™”ë¥¼ ì™„ë£Œí•´ì£¼ì„¸ìš”."

#### 2. ì•„ì§ ë™ê¸°í™”ë˜ì§€ ì•Šì€ ë©”ëª¨ ì‚­ì œ
- **ìƒí™©**: ì˜¤í”„ë¼ì¸ì—ì„œ ë©”ëª¨ë¥¼ ì‘ì„±í•œ í›„, ë™ê¸°í™” ì „ì— ì‚­ì œ ì‹œë„
- **ì²˜ë¦¬**: ë¡œì»¬ì—ì„œ ì¦‰ì‹œ ì‚­ì œ, ë™ê¸°í™” íì˜ CREATE í•­ëª©ë„ ì œê±°
- **ì´ìœ **: ì„œë²„ì— ì•„ì§ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë©”ëª¨ì´ë¯€ë¡œ ì„œë²„ ë™ê¸°í™” ë¶ˆí•„ìš”

#### 3. ë©”ëª¨ ìˆ˜ì • í›„ ë‹¤ì‹œ ìˆ˜ì •
- **ìƒí™©**: ì˜¤í”„ë¼ì¸ì—ì„œ ë©”ëª¨ë¥¼ ìˆ˜ì •í•œ í›„, ë™ê¸°í™” ì „ì— ë‹¤ì‹œ ìˆ˜ì •
- **ì²˜ë¦¬**: ê¸°ì¡´ ë™ê¸°í™” íì˜ UPDATE í•­ëª©ì„ ì œê±°í•˜ê³  ìƒˆë¡œìš´ UPDATE í•­ëª© ì¶”ê°€
- **ì´ìœ **: ìµœì‹  ìˆ˜ì • ë‚´ìš©ë§Œ ë™ê¸°í™”í•˜ì—¬ ì¤‘ë³µ ë™ê¸°í™” ë°©ì§€

#### 4. ë©”ëª¨ ìˆ˜ì • í›„ ì‚­ì œ
- **ìƒí™©**: ì˜¤í”„ë¼ì¸ì—ì„œ ë©”ëª¨ë¥¼ ìˆ˜ì •í•œ í›„, ë™ê¸°í™” ì „ì— ì‚­ì œ
- **ì²˜ë¦¬**: UPDATE í•­ëª©ì„ ì œê±°í•˜ê³  DELETE í•­ëª© ì¶”ê°€
- **ì´ìœ **: ìˆ˜ì • ë‚´ìš©ì€ ë¬´ì˜ë¯¸í•˜ë¯€ë¡œ ì‚­ì œë§Œ ë™ê¸°í™”

#### 5. ë©”ëª¨ ì‚­ì œ í›„ ë‹¤ì‹œ ì‚­ì œ
- **ìƒí™©**: ì˜¤í”„ë¼ì¸ì—ì„œ ë©”ëª¨ë¥¼ ì‚­ì œí•œ í›„, ë™ê¸°í™” ì „ì— ë‹¤ì‹œ ì‚­ì œ ì‹œë„
- **ì²˜ë¦¬**: ì´ë¯¸ ì‚­ì œ ëŒ€ê¸° ìƒíƒœì´ë¯€ë¡œ ì¶”ê°€ ì²˜ë¦¬ ì—†ìŒ
- **ì´ìœ **: ì¤‘ë³µ ì‚­ì œ ë°©ì§€

### ì‚¬ìš©ì í”¼ë“œë°±

```javascript
// UIì—ì„œ ë™ê¸°í™” ìƒíƒœ í‘œì‹œ
function renderMemo(memo) {
    const statusIcon = {
        'pending': 'â³ ëŒ€ê¸° ì¤‘',
        'syncing': 'ğŸ”„ ë™ê¸°í™” ì¤‘',
        'synced': 'âœ“ ë™ê¸°í™” ì™„ë£Œ',
        'failed': 'âŒ ë™ê¸°í™” ì‹¤íŒ¨'
    };

    return `
        <div class="memo-item" data-local-id="${memo.localId}">
            <div class="memo-content">${memo.content}</div>
            <div class="sync-status">${statusIcon[memo.syncStatus]}</div>
        </div>
    `;
}
```

---

## êµ¬í˜„ ë‹¨ê³„ë³„ ê°€ì´ë“œ

### Phase 1: ê¸°ë³¸ ì¸í”„ë¼ êµ¬ì¶•

1. **IndexedDB ì´ˆê¸°í™”**
   - ìŠ¤í‚¤ë§ˆ ì •ì˜
   - í…Œì´ë¸” ìƒì„±
   - CRUD ë©”ì„œë“œ êµ¬í˜„

2. **Service Worker ë“±ë¡**
   - Service Worker íŒŒì¼ ìƒì„±
   - ë“±ë¡ ë° ì„¤ì¹˜ ë¡œì§ êµ¬í˜„
   - ë¸Œë¼ìš°ì € í˜¸í™˜ì„± í™•ì¸ ë° í´ë°± ì „ëµ

3. **ë„¤íŠ¸ì›Œí¬ ëª¨ë‹ˆí„°ë§**
   - `navigator.onLine` ê°ì§€
   - ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
   - Service Workerì™€ í†µí•©

### Phase 2: ì˜¤í”„ë¼ì¸ ë©”ëª¨ ì‘ì„±

1. **ë¡œì»¬ ì €ì¥ ê¸°ëŠ¥**
   - ë©”ëª¨ ì‘ì„± ì‹œ IndexedDBì— ì €ì¥
   - ë¡œì»¬ ID ìƒì„±

2. **UI í†µí•©**
   - ê¸°ì¡´ ë©”ëª¨ ì‘ì„± UIì™€ í†µí•©
   - ë¡œì»¬ ë©”ëª¨ í‘œì‹œ

### Phase 3: ë™ê¸°í™” ê¸°ëŠ¥

1. **ë™ê¸°í™” í êµ¬í˜„**
   - í í•­ëª© ìƒì„±/ê´€ë¦¬
   - ìƒíƒœ ê´€ë¦¬

2. **ì„œë²„ ë™ê¸°í™”**
   - API í˜¸ì¶œ
   - ì„œë²„ ID ë§¤í•‘
   - ìƒíƒœ ì—…ë°ì´íŠ¸

3. **Background Sync êµ¬í˜„**
   - Service Workerì—ì„œ Background Sync ì´ë²¤íŠ¸ ì²˜ë¦¬
   - í˜ì´ì§€ ì¢…ë£Œ í›„ ë™ê¸°í™” ì§€ì›
   - ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìë™ ì¬ì‹œë„

### Phase 4: ìë™í™”

1. **ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ê°ì§€**
   - ìë™ ë™ê¸°í™” íŠ¸ë¦¬ê±°
   - Service Worker Background Syncì™€ í†µí•©

2. **ì¬ì‹œë„ ë¡œì§**
   - Exponential Backoff
   - ì‹¤íŒ¨ ì²˜ë¦¬
   - Service Workerì—ì„œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì¬ì‹œë„ ì œì–´

### Phase 5: UI ê°œì„ 

1. **ë™ê¸°í™” ìƒíƒœ í‘œì‹œ**
   - ëŒ€ê¸°/ë™ê¸°í™” ì¤‘/ì™„ë£Œ/ì‹¤íŒ¨ í‘œì‹œ

2. **ì—ëŸ¬ í”¼ë“œë°±**
   - ë™ê¸°í™” ì‹¤íŒ¨ ì‹œ ì‚¬ìš©ì ì•Œë¦¼
   - ìë™ ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜ (Exponential Backoff)

---

## í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. ì˜¤í”„ë¼ì¸ ë©”ëª¨ ì‘ì„± í…ŒìŠ¤íŠ¸

#### ë°©ë²• 1: ë¸Œë¼ìš°ì € DevTools ì´ìš© (ê°€ì¥ ê°„ë‹¨)

**ë‹¨ê³„ë³„ í…ŒìŠ¤íŠ¸:**

1. **ë¸Œë¼ìš°ì € DevTools ì—´ê¸°**
   - F12 í‚¤ ëˆ„ë¥´ê¸°
   - ë˜ëŠ” ìš°í´ë¦­ â†’ ê²€ì‚¬

2. **ë„¤íŠ¸ì›Œí¬ ì°¨ë‹¨ ì„¤ì •**
   ```
   DevTools â†’ Network íƒ­
   â†’ Throttling ë“œë¡­ë‹¤ìš´ ì„ íƒ
   â†’ "Offline" ì„ íƒ
   ```

3. **ë©”ëª¨ ì‘ì„±**
   - ì›¹ì‚¬ì´íŠ¸ì—ì„œ ë©”ëª¨ ì‘ì„± UI ì ‘ê·¼
   - ë©”ëª¨ ë‚´ìš© ì…ë ¥ (ì˜ˆ: "ì˜¤í”„ë¼ì¸ í…ŒìŠ¤íŠ¸ ë©”ëª¨")
   - `userBookId`, `pageNumber`, `content` ë“± í•„ìˆ˜ ì •ë³´ ì…ë ¥
   - ì €ì¥ ë²„íŠ¼ í´ë¦­

4. **í™•ì¸ ì‚¬í•­** âœ…
   - âœ… ë©”ëª¨ê°€ UIì— ì¦‰ì‹œ í‘œì‹œë˜ëŠ”ê°€?
   - âœ… ë™ê¸°í™” ìƒíƒœê°€ "â³ ëŒ€ê¸° ì¤‘"ìœ¼ë¡œ í‘œì‹œë˜ëŠ”ê°€?
   - âœ… ì—ëŸ¬ ë©”ì‹œì§€ê°€ í‘œì‹œë˜ì§€ ì•ŠëŠ”ê°€?
   - âœ… í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ë„ ë©”ëª¨ê°€ ìœ ì§€ë˜ëŠ”ê°€?

5. **IndexedDB í™•ì¸**
   ```
   DevTools â†’ Application íƒ­
   â†’ Storage â†’ IndexedDB â†’ reading-tracker
   â†’ offline_memos í…Œì´ë¸” í´ë¦­
   â†’ ì‘ì„±í•œ ë©”ëª¨ ë°ì´í„° í™•ì¸
   ```
   - `syncStatus`: "pending" í™•ì¸
   - `localId`: UUID í˜•ì‹ì˜ ë¡œì»¬ ID í™•ì¸
   - `serverId`: null í™•ì¸

6. **ë™ê¸°í™” í í™•ì¸**
   ```
   Application íƒ­ â†’ IndexedDB â†’ reading-tracker
   â†’ sync_queue í…Œì´ë¸” í´ë¦­
   â†’ í í•­ëª© í™•ì¸
   ```
   - `status`: "PENDING" í™•ì¸
   - `type`: "CREATE" í™•ì¸
   - `localMemoId`: ë©”ëª¨ì˜ localIdì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸

#### ë°©ë²• 2: Windows Firewallì„ ì´ìš©í•œ í¬íŠ¸ ì°¨ë‹¨

```powershell
# PowerShell (ê´€ë¦¬ì ê¶Œí•œ í•„ìš”)

# 1. í¬íŠ¸ ì°¨ë‹¨
New-NetFirewallRule -DisplayName "Block 8080" `
    -Direction Outbound `
    -LocalPort 8080 `
    -Protocol TCP `
    -Action Block

# 2. ë©”ëª¨ ì‘ì„± í…ŒìŠ¤íŠ¸
# ì›¹ì‚¬ì´íŠ¸ì—ì„œ ë©”ëª¨ ì‘ì„± â†’ ì˜¤í”„ë¼ì¸ ì²˜ë¦¬ í™•ì¸

# 3. í¬íŠ¸ ì°¨ë‹¨ í•´ì œ
Remove-NetFirewallRule -DisplayName "Block 8080"

# 4. ìë™ ë™ê¸°í™” í™•ì¸
```

---

### 2. ìë™ ë™ê¸°í™” í…ŒìŠ¤íŠ¸

#### ì‹œë‚˜ë¦¬ì˜¤: ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìë™ ë™ê¸°í™”

**í…ŒìŠ¤íŠ¸ ì¤€ë¹„:**
1. ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œ ë©”ëª¨ 2-3ê°œ ì‘ì„±
2. ê° ë©”ëª¨ì˜ ë™ê¸°í™” ìƒíƒœê°€ "â³ ëŒ€ê¸° ì¤‘"ì¸ì§€ í™•ì¸

**í…ŒìŠ¤íŠ¸ ë‹¨ê³„:**

1. **ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œë®¬ë ˆì´ì…˜**

   **ë°©ë²• A: ë¸Œë¼ìš°ì € DevTools**
   ```
   Network íƒ­ â†’ Throttling â†’ "Online" ì„ íƒ
   ```

   **ë°©ë²• B: Clumsy**
   ```
   Drop: 0%ë¡œ ë³€ê²½
   ë˜ëŠ” Enable ì²´í¬ í•´ì œ
   ```

   **ë°©ë²• C: ì„œë²„ ì¤‘ì§€ í›„ ì¬ì‹œì‘**
   ```powershell
   # ì„œë²„ ì¤‘ì§€ (Ctrl+C)
   # ì„œë²„ ì¬ì‹œì‘
   mvn spring-boot:run
   ```

2. **ìë™ ë™ê¸°í™” í™•ì¸**

   **í™•ì¸ ì‚¬í•­** âœ…:
   - âœ… 1ì´ˆ ì´ë‚´ì— ìë™ ë™ê¸°í™”ê°€ ì‹œì‘ë˜ëŠ”ê°€?
   - âœ… ë™ê¸°í™” ìƒíƒœê°€ "â³ ëŒ€ê¸° ì¤‘" â†’ "ğŸ”„ ë™ê¸°í™” ì¤‘" â†’ "âœ“ ë™ê¸°í™” ì™„ë£Œ"ë¡œ ë³€ê²½ë˜ëŠ”ê°€?
   - âœ… ì½˜ì†”ì— "ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë³µêµ¬" ë©”ì‹œì§€ê°€ ì¶œë ¥ë˜ëŠ”ê°€?
   - âœ… ì½˜ì†”ì— "ë™ê¸°í™”í•  ë©”ëª¨ ìˆ˜: N" ë©”ì‹œì§€ê°€ ì¶œë ¥ë˜ëŠ”ê°€?

3. **IndexedDB ìƒíƒœ í™•ì¸**
   ```
   DevTools â†’ Application â†’ IndexedDB â†’ offline_memos
   ```
   - ë™ê¸°í™” ì™„ë£Œëœ ë©”ëª¨ì˜ `syncStatus`: "synced" í™•ì¸
   - `serverId`: ì„œë²„ì—ì„œ ìƒì„±ëœ ID í™•ì¸ (nullì´ ì•„ë‹˜)

4. **ì„œë²„ì—ì„œ ë©”ëª¨ í™•ì¸**

   **ë°©ë²• A: API ì§ì ‘ í˜¸ì¶œ**
   ```javascript
   // ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì‹¤í–‰
   fetch('http://localhost:8080/api/v1/memos/books/{userBookId}', {
       headers: {
           'Authorization': 'Bearer YOUR_TOKEN'
       }
   })
   .then(res => res.json())
   .then(data => console.log('ì„œë²„ ë©”ëª¨:', data));
   ```

   **ë°©ë²• B: Swagger UI**
   ```
   http://localhost:8080/swagger-ui.html
   â†’ GET /api/v1/memos/books/{userBookId} ì‹¤í–‰
   ```

   **ë°©ë²• C: ë°ì´í„°ë² ì´ìŠ¤ ì§ì ‘ í™•ì¸**
   ```sql
   SELECT * FROM memos 
   WHERE user_id = (SELECT id FROM users WHERE login_id = 'test_user')
   ORDER BY created_at DESC 
   LIMIT 10;
   ```

5. **ë™ê¸°í™” í í™•ì¸**
   ```
   Application íƒ­ â†’ IndexedDB â†’ sync_queue
   ```
   - ë™ê¸°í™” ì™„ë£Œëœ í•­ëª©ì˜ `status`: "SUCCESS" í™•ì¸
   - ë˜ëŠ” íì—ì„œ ì œê±°ë˜ì—ˆëŠ”ì§€ í™•ì¸

---

### 3. ì¬ì‹œë„ ë¡œì§ í…ŒìŠ¤íŠ¸

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ì„œë²„ ì˜¤ë¥˜ ì‹œ ì¬ì‹œë„

**í…ŒìŠ¤íŠ¸ ì¤€ë¹„:**
1. Spring Boot ì„œë²„ ì‹¤í–‰ ì¤‘

**í…ŒìŠ¤íŠ¸ ë‹¨ê³„:**

1. **ì„œë²„ ì¤‘ì§€ ë˜ëŠ” ì—ëŸ¬ ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜**

   **ì„œë²„ ì¤‘ì§€**
   ```powershell
   # ì„œë²„ í”„ë¡œì„¸ìŠ¤ ì°¾ê¸°
   netstat -ano | findstr :8080
   
   # ì„œë²„ ê°•ì œ ì¢…ë£Œ
   taskkill /PID <PID> /F
   ```

2. **ë©”ëª¨ ì‘ì„±**
   - ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œ ë©”ëª¨ ì‘ì„±
   - ë¡œì»¬ ì €ì¥ í™•ì¸

3. **ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ (ì¼ì‹œì )**
   - ì„œë²„ ì¬ì‹œì‘

4. **ë™ê¸°í™” ì‹¤íŒ¨ í™•ì¸**
   - ë™ê¸°í™” ìƒíƒœ: "ğŸ”„ ë™ê¸°í™” ì¤‘" â†’ "âŒ ë™ê¸°í™” ì‹¤íŒ¨"
   - ì½˜ì†”ì— ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸

5. **ì¬ì‹œë„ í™•ì¸**

   **í™•ì¸ ì‚¬í•­** âœ…:
   - âœ… 5ì´ˆ í›„ ì²« ë²ˆì§¸ ì¬ì‹œë„ê°€ ì‹¤í–‰ë˜ëŠ”ê°€?
   - âœ… 10ì´ˆ í›„ ë‘ ë²ˆì§¸ ì¬ì‹œë„ê°€ ì‹¤í–‰ë˜ëŠ”ê°€?
   - âœ… 20ì´ˆ í›„ ì„¸ ë²ˆì§¸ ì¬ì‹œë„ê°€ ì‹¤í–‰ë˜ëŠ”ê°€?
   - âœ… ìµœëŒ€ 3íšŒ ì¬ì‹œë„ í›„ ì¤‘ë‹¨ë˜ëŠ”ê°€?

6. **IndexedDB ìƒíƒœ í™•ì¸**
   ```
   sync_queue í…Œì´ë¸” í™•ì¸
   ```
   - `retryCount`: ì¬ì‹œë„ íšŸìˆ˜ í™•ì¸ (ìµœëŒ€ 3)
   - `status`: "FAILED" í™•ì¸
   - `error`: ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸

7. **ìµœì¢… ì„±ê³µ ì‹œë‚˜ë¦¬ì˜¤**
   - ì„œë²„ ì •ìƒí™”
   - ë„¤íŠ¸ì›Œí¬ ì •ìƒí™”
   - ìë™ ì¬ì‹œë„ í™•ì¸

#### ì‹œë‚˜ë¦¬ì˜¤ 2: ê°„í—ì  ë„¤íŠ¸ì›Œí¬ ì¥ì• 

**í…ŒìŠ¤íŠ¸ ì„¤ì •:**

1. **Clumsy ì„¤ì •**
   ```
   Filter: outbound and tcp.DstPort == 8080
   Drop: 50%  # 50% íŒ¨í‚· ì†ì‹¤
   Enable ì²´í¬
   ```

2. **ë©”ëª¨ ì‘ì„± ë° ë™ê¸°í™” ì‹œë„**
   - ì˜¨ë¼ì¸ ìƒíƒœì—ì„œ ë©”ëª¨ ì‘ì„±
   - ë™ê¸°í™” ì‹œë„

3. **í™•ì¸ ì‚¬í•­** âœ…:
   - âœ… ì¼ë¶€ ë©”ëª¨ë§Œ ì„±ê³µí•˜ê³  ì¼ë¶€ëŠ” ì‹¤íŒ¨í•˜ëŠ”ê°€?
   - âœ… ì‹¤íŒ¨í•œ ë©”ëª¨ëŠ” ì¬ì‹œë„ íì— ì¶”ê°€ë˜ëŠ”ê°€?
   - âœ… ì„±ê³µí•œ ë©”ëª¨ëŠ” ì •ìƒì ìœ¼ë¡œ ë™ê¸°í™”ë˜ëŠ”ê°€?

---

### 4. ë‹¤ì¤‘ ë©”ëª¨ ë°°ì¹˜ ë™ê¸°í™” í…ŒìŠ¤íŠ¸

#### ì‹œë‚˜ë¦¬ì˜¤: ì—¬ëŸ¬ ë©”ëª¨ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ë™ê¸°í™”

**í…ŒìŠ¤íŠ¸ ì¤€ë¹„:**
1. ì˜¤í”„ë¼ì¸ ìƒíƒœë¡œ ì „í™˜
2. ì—¬ëŸ¬ ë©”ëª¨ ì‘ì„± (3-5ê°œ)
   - ë‹¤ë¥¸ `userBookId` ì‚¬ìš©
   - ë‹¤ë¥¸ `memoStartTime` ì„¤ì •

**í…ŒìŠ¤íŠ¸ ë‹¨ê³„:**

1. **ë©”ëª¨ ì‘ì„± ì‹œê°„ ìˆœì„œ í™•ì¸**
   ```
   IndexedDB â†’ offline_memos
   â†’ memoStartTime ì¸ë±ìŠ¤ë¡œ ì •ë ¬ í™•ì¸
   ```

2. **ë„¤íŠ¸ì›Œí¬ ë³µêµ¬**
   ```
   Network íƒ­ â†’ Online
   ```

3. **ìˆœì°¨ ë™ê¸°í™” í™•ì¸**

   **í™•ì¸ ì‚¬í•­** âœ…:
   - âœ… ë©”ëª¨ë“¤ì´ `memoStartTime` ìˆœì„œë¡œ ë™ê¸°í™”ë˜ëŠ”ê°€?
   - âœ… í•œ ë²ˆì— í•˜ë‚˜ì”© ìˆœì°¨ì ìœ¼ë¡œ ë™ê¸°í™”ë˜ëŠ”ê°€?
   - âœ… ì¼ë¶€ ì‹¤íŒ¨í•´ë„ ë‚˜ë¨¸ì§€ëŠ” ê³„ì† ë™ê¸°í™”ë˜ëŠ”ê°€?

4. **ì½˜ì†” ë¡œê·¸ í™•ì¸**
   ```javascript
   // ì˜ˆìƒ ë¡œê·¸:
   "ë™ê¸°í™”í•  ë©”ëª¨ ìˆ˜: 5"
   "ë©”ëª¨ ë™ê¸°í™” ì„±ê³µ: local-id-1 â†’ server-id-123"
   "ë©”ëª¨ ë™ê¸°í™” ì„±ê³µ: local-id-2 â†’ server-id-124"
   ...
   ```

---

### 5. IndexedDB ë°ì´í„° ë¬´ê²°ì„± í…ŒìŠ¤íŠ¸

#### ì‹œë‚˜ë¦¬ì˜¤: ë¸Œë¼ìš°ì € ì¬ì‹œì‘ í›„ ë°ì´í„° ìœ ì§€

**í…ŒìŠ¤íŠ¸ ë‹¨ê³„:**

1. **ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œ ë©”ëª¨ ì‘ì„±**
   - ì—¬ëŸ¬ ë©”ëª¨ ì‘ì„± (2-3ê°œ)

2. **ë¸Œë¼ìš°ì € ì™„ì „ ì¢…ë£Œ**
   - ëª¨ë“  ë¸Œë¼ìš°ì € íƒ­ ë‹«ê¸°
   - ë¸Œë¼ìš°ì € í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ í™•ì¸

3. **ë¸Œë¼ìš°ì € ì¬ì‹œì‘**

4. **ë°ì´í„° í™•ì¸**

   **í™•ì¸ ì‚¬í•­** âœ…:
   - âœ… IndexedDBì— ë©”ëª¨ ë°ì´í„°ê°€ ì—¬ì „íˆ ì¡´ì¬í•˜ëŠ”ê°€?
   - âœ… í˜ì´ì§€ ë¡œë“œ ì‹œ ë©”ëª¨ê°€ UIì— í‘œì‹œë˜ëŠ”ê°€?
   - âœ… ë™ê¸°í™” ìƒíƒœê°€ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œë˜ëŠ”ê°€?

5. **ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ í›„ ë™ê¸°í™”**
   - ìë™ ë™ê¸°í™”ê°€ ì •ìƒ ì‘ë™í•˜ëŠ”ê°€?

---

### 6. ë™ì‹œì„± í…ŒìŠ¤íŠ¸

#### ì‹œë‚˜ë¦¬ì˜¤: ë¹ ë¥´ê²Œ ì—°ì†ìœ¼ë¡œ ë©”ëª¨ ì‘ì„±

**í…ŒìŠ¤íŠ¸ ë‹¨ê³„:**

1. **ì˜¤í”„ë¼ì¸ ìƒíƒœë¡œ ì „í™˜**

2. **ì—°ì† ë©”ëª¨ ì‘ì„±**
   - 1ì´ˆ ê°„ê²©ìœ¼ë¡œ 5ê°œ ë©”ëª¨ ì‘ì„±
   - ë˜ëŠ” ë¹ ë¥´ê²Œ ì—¬ëŸ¬ ë²ˆ í´ë¦­

3. **í™•ì¸ ì‚¬í•­** âœ…:
   - âœ… ëª¨ë“  ë©”ëª¨ê°€ ë¡œì»¬ì— ì €ì¥ë˜ëŠ”ê°€?
   - âœ… ê° ë©”ëª¨ê°€ ê³ ìœ í•œ `localId`ë¥¼ ê°€ì§€ëŠ”ê°€?
   - âœ… ë™ê¸°í™” íì— ì¤‘ë³µ í•­ëª©ì´ ì—†ëŠ”ê°€?
   - âœ… UIì— ëª¨ë“  ë©”ëª¨ê°€ í‘œì‹œë˜ëŠ”ê°€?

4. **ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ í›„ ë™ê¸°í™”**
   - ëª¨ë“  ë©”ëª¨ê°€ ì •ìƒì ìœ¼ë¡œ ë™ê¸°í™”ë˜ëŠ”ê°€?

---

### 7. ì—ëŸ¬ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ì„œë²„ ê²€ì¦ ì˜¤ë¥˜ (4xx)

**í…ŒìŠ¤íŠ¸ ë°©ë²•:**

1. **ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œ ì˜ëª»ëœ ë°ì´í„°ë¡œ ë©”ëª¨ ì‘ì„±**
   - `userBookId`: ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ID
   - `content`: ë¹ˆ ë¬¸ìì—´ ë˜ëŠ” null
   - `pageNumber`: 0 ë˜ëŠ” ìŒìˆ˜

2. **ë¡œì»¬ ì €ì¥ í™•ì¸**
   - ì˜ëª»ëœ ë°ì´í„°ë„ ë¡œì»¬ì—ëŠ” ì €ì¥ë¨ (ì„œë²„ ê²€ì¦ ì „)

3. **ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ í›„ ë™ê¸°í™” ì‹œë„**

4. **ì„œë²„ ì—ëŸ¬ ì‘ë‹µ í™•ì¸**

   **í™•ì¸ ì‚¬í•­** âœ…:
   - âœ… ì„œë²„ì—ì„œ 400 Bad Request ì‘ë‹µ
   - âœ… ë™ê¸°í™” ìƒíƒœ: "âŒ ë™ê¸°í™” ì‹¤íŒ¨"
   - âœ… ì—ëŸ¬ ë©”ì‹œì§€ê°€ ì‚¬ìš©ìì—ê²Œ í‘œì‹œë˜ëŠ”ê°€?
   - âœ… ìˆ˜ì • ê°€ëŠ¥í•œ UIê°€ ì œê³µë˜ëŠ”ê°€?

#### ì‹œë‚˜ë¦¬ì˜¤ 2: ì¸ì¦ ì˜¤ë¥˜ (401)

**í…ŒìŠ¤íŠ¸ ë°©ë²•:**

1. **í† í° ë§Œë£Œ ë˜ëŠ” ë¬´íš¨í™”**
   - `localStorage`ì—ì„œ `accessToken` ì‚­ì œ
   - ë˜ëŠ” ë§Œë£Œëœ í† í° ì„¤ì •

2. **ë©”ëª¨ ì‘ì„± ë° ë™ê¸°í™” ì‹œë„**

   **í™•ì¸ ì‚¬í•­** âœ…:
   - âœ… 401 ì—ëŸ¬ ë°œìƒ
   - âœ… í† í° ê°±ì‹  ì‹œë„
   - âœ… í† í° ê°±ì‹  ì„±ê³µ ì‹œ ì¬ì‹œë„
   - âœ… í† í° ê°±ì‹  ì‹¤íŒ¨ ì‹œ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬

---

### 8. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

#### ì‹œë‚˜ë¦¬ì˜¤: ëŒ€ëŸ‰ ë©”ëª¨ ì‘ì„± ë° ë™ê¸°í™”

**í…ŒìŠ¤íŠ¸ ë‹¨ê³„:**

1. **ëŒ€ëŸ‰ ë©”ëª¨ ì‘ì„±**
   - ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œ 50-100ê°œ ë©”ëª¨ ì‘ì„±
   - ìŠ¤í¬ë¦½íŠ¸ë¡œ ìë™ ìƒì„± ê°€ëŠ¥

2. **ë¡œì»¬ ì €ì¥ ì„±ëŠ¥ í™•ì¸**

   **í™•ì¸ ì‚¬í•­** âœ…:
   - âœ… ëª¨ë“  ë©”ëª¨ê°€ ë¹ ë¥´ê²Œ ë¡œì»¬ì— ì €ì¥ë˜ëŠ”ê°€?
   - âœ… UIê°€ ë©ˆì¶”ì§€ ì•ŠëŠ”ê°€?
   - âœ… IndexedDB ìš©ëŸ‰ í™•ì¸

3. **ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ í›„ ë™ê¸°í™”**

   **í™•ì¸ ì‚¬í•­** âœ…:
   - âœ… ëª¨ë“  ë©”ëª¨ê°€ ìˆœì°¨ì ìœ¼ë¡œ ë™ê¸°í™”ë˜ëŠ”ê°€?
   - âœ… ë™ê¸°í™” ì‹œê°„ì´ ì ì ˆí•œê°€?
   - âœ… ë¸Œë¼ìš°ì €ê°€ ì‘ë‹µí•˜ëŠ”ê°€?

---

### 9. ë¸Œë¼ìš°ì € DevToolsë¥¼ ì´ìš©í•œ ìƒì„¸ ëª¨ë‹ˆí„°ë§

#### Network íƒ­ ëª¨ë‹ˆí„°ë§

1. **ì˜¤í”„ë¼ì¸ ë©”ëª¨ ì‘ì„± ì‹œ**
   ```
   Network íƒ­ â†’ ìš”ì²­ì´ ì—†ëŠ”ì§€ í™•ì¸
   (ì˜¤í”„ë¼ì¸ì´ë¯€ë¡œ API í˜¸ì¶œ ì—†ìŒ)
   ```

2. **ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ**
   ```
   Network íƒ­ â†’ POST /api/v1/memos ìš”ì²­ í™•ì¸
   â†’ ìš”ì²­ íƒ­ì—ì„œ Request/Response í™•ì¸
   â†’ Timing íƒ­ì—ì„œ ì‘ë‹µ ì‹œê°„ í™•ì¸
   ```

#### Application íƒ­ ëª¨ë‹ˆí„°ë§

1. **IndexedDB ì‹¤ì‹œê°„ í™•ì¸**
   ```
   Application â†’ IndexedDB â†’ reading-tracker
   â†’ offline_memos í…Œì´ë¸”
   â†’ ë°ì´í„° ë³€ê²½ ì‹œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ í™•ì¸
   ```

2. **LocalStorage í™•ì¸**
   ```
   Application â†’ Local Storage
   â†’ í† í° ì •ë³´ í™•ì¸
   â†’ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ìºì‹œ í™•ì¸ (ìˆëŠ” ê²½ìš°)
   ```

#### Console íƒ­ ë¡œê¹…

**í™•ì¸í•  ë¡œê·¸:**

```javascript
// ì •ìƒ ë™ê¸°í™”
"ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë³µêµ¬"
"ë™ê¸°í™”í•  ë©”ëª¨ ìˆ˜: 3"
"ë©”ëª¨ ë™ê¸°í™” ì„±ê³µ: local-id â†’ server-id"

// ì¬ì‹œë„
"ë©”ëª¨ ë™ê¸°í™” ì‹¤íŒ¨ (local-id): Network error"
"ì¬ì‹œë„ ì˜ˆì•½: 5ì´ˆ í›„"

// ì—ëŸ¬
"ìë™ ë™ê¸°í™” ì‹¤íŒ¨: [ì—ëŸ¬ ë©”ì‹œì§€]"
```

---

### 10. ìë™í™”ëœ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

#### JavaScript í…ŒìŠ¤íŠ¸ í•¨ìˆ˜

```javascript
// í…ŒìŠ¤íŠ¸ í—¬í¼ í•¨ìˆ˜ (ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì‹¤í–‰)

// 1. IndexedDB ë©”ëª¨ í™•ì¸
async function checkOfflineMemos() {
    const db = await new Promise((resolve, reject) => {
        const request = indexedDB.open('reading-tracker', 1);
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
    });
    
    const transaction = db.transaction(['offline_memos'], 'readonly');
    const store = transaction.objectStore('offline_memos');
    const memos = await store.getAll();
    
    console.log('ë¡œì»¬ ë©”ëª¨ ëª©ë¡:', memos);
    return memos;
}

// 2. ë™ê¸°í™” í í™•ì¸
async function checkSyncQueue() {
    const db = await new Promise((resolve, reject) => {
        const request = indexedDB.open('reading-tracker', 1);
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
    });
    
    const transaction = db.transaction(['sync_queue'], 'readonly');
    const store = transaction.objectStore('sync_queue');
    const items = await store.getAll();
    
    console.log('ë™ê¸°í™” í:', items);
    return items;
}

// 3. í†µí•© ìƒíƒœ í™•ì¸
async function checkSyncStatus() {
    const memos = await checkOfflineMemos();
    const queue = await checkSyncQueue();
    
    const status = {
        totalMemos: memos.length,
        pending: memos.filter(m => m.syncStatus === 'pending').length,
        syncing: memos.filter(m => m.syncStatus === 'syncing').length,
        synced: memos.filter(m => m.syncStatus === 'synced').length,
        failed: memos.filter(m => m.syncStatus === 'failed').length,
        queueItems: queue.length
    };
    
    console.table(status);
    return status;
}

// ì‚¬ìš© ì˜ˆì‹œ
checkSyncStatus();
```

---

### 11. í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

#### ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

- [ ] ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œ ë©”ëª¨ ì‘ì„± ê°€ëŠ¥
- [ ] ë©”ëª¨ê°€ UIì— ì¦‰ì‹œ í‘œì‹œë¨
- [ ] IndexedDBì— ë©”ëª¨ê°€ ì €ì¥ë¨
- [ ] ë¸Œë¼ìš°ì € ì¬ì‹œì‘ í›„ ë©”ëª¨ ìœ ì§€
- [ ] ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìë™ ë™ê¸°í™”
- [ ] ë™ê¸°í™” ìƒíƒœ UI í‘œì‹œ (ëŒ€ê¸°/ë™ê¸°í™” ì¤‘/ì™„ë£Œ/ì‹¤íŒ¨)

#### ë™ê¸°í™” í…ŒìŠ¤íŠ¸

- [ ] ë‹¨ì¼ ë©”ëª¨ ë™ê¸°í™” ì„±ê³µ
- [ ] ë‹¤ì¤‘ ë©”ëª¨ ìˆœì°¨ ë™ê¸°í™”
- [ ] ë™ê¸°í™” ìˆœì„œê°€ `memoStartTime` ê¸°ì¤€
- [ ] ì„œë²„ ID ë§¤í•‘ ì •í™•
- [ ] ë™ê¸°í™” ì™„ë£Œ í›„ ìƒíƒœ ì—…ë°ì´íŠ¸

#### ì¬ì‹œë„ í…ŒìŠ¤íŠ¸

- [ ] ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ì¬ì‹œë„
- [ ] Exponential Backoff ì ìš©
- [ ] ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì œí•œ
- [ ] ì¬ì‹œë„ ê°„ê²© ì •í™•

#### ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸

- [ ] ì„œë²„ ê²€ì¦ ì˜¤ë¥˜ ì²˜ë¦¬
- [ ] ì¸ì¦ ì˜¤ë¥˜ ì²˜ë¦¬
- [ ] ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì²˜ë¦¬
- [ ] ì‚¬ìš©ìì—ê²Œ ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€

#### ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

- [ ] ëŒ€ëŸ‰ ë©”ëª¨ ì‘ì„± ì„±ëŠ¥
- [ ] ë™ê¸°í™” ì„±ëŠ¥
- [ ] UI ì‘ë‹µì„±

---

### 12. Clumsyë¥¼ ì´ìš©í•œ ê³ ê¸‰ í…ŒìŠ¤íŠ¸

#### ë„¤íŠ¸ì›Œí¬ ì§€ì—° í…ŒìŠ¤íŠ¸

```
Filter: outbound and tcp.DstPort == 8080
Lag: 2000ms  # 2ì´ˆ ì§€ì—°
Drop: 0%
Enable ì²´í¬
```

**í™•ì¸ ì‚¬í•­:**
- âœ… ë™ê¸°í™”ê°€ ëŠë¦¬ê²Œ ì§„í–‰ë˜ëŠ”ê°€?
- âœ… íƒ€ì„ì•„ì›ƒ ì„¤ì •ì´ ì ì ˆí•œê°€?

#### íŒ¨í‚· ì†ì‹¤ í…ŒìŠ¤íŠ¸

```
Filter: outbound and tcp.DstPort == 8080
Lag: 0ms
Drop: 30%  # 30% íŒ¨í‚· ì†ì‹¤
Enable ì²´í¬
```

**í™•ì¸ ì‚¬í•­:**
- âœ… ì¼ë¶€ ìš”ì²­ì´ ì‹¤íŒ¨í•˜ëŠ”ê°€?
- âœ… ì¬ì‹œë„ ë¡œì§ì´ ì‘ë™í•˜ëŠ”ê°€?

#### ì™„ì „ ì°¨ë‹¨ â†’ ë³µêµ¬ ì‹œë®¬ë ˆì´ì…˜

```
1. Drop: 100% â†’ ë©”ëª¨ ì‘ì„± (ì˜¤í”„ë¼ì¸)
2. Drop: 0% â†’ ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ â†’ ìë™ ë™ê¸°í™” í™•ì¸
3. Drop: 100% â†’ ë™ê¸°í™” ì¤‘ ë„¤íŠ¸ì›Œí¬ ëŠê¹€ â†’ ì¬ì‹œë„ í™•ì¸
4. Drop: 0% â†’ ìµœì¢… ë™ê¸°í™” í™•ì¸
```

---

### 13. ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ

> **ëª©ì **: ë„¤íŠ¸ì›Œí¬ ëŠê¹€, ë™ê¸°í™” ì‹¤íŒ¨, ì—ëŸ¬ ë“± ë¬¸ì œë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°ì§€í•˜ê³  ì¶”ì 

#### ëª¨ë‹ˆí„°ë§ì´ í•„ìš”í•œ í•­ëª©

1. **ë„¤íŠ¸ì›Œí¬ ìƒíƒœ**
   - ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ìƒíƒœ ë³€í™”
   - ë„¤íŠ¸ì›Œí¬ ì—°ê²°/ëŠê¹€ ì´ë²¤íŠ¸
   - ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ì§€ì† ì‹œê°„

2. **ë™ê¸°í™” ìƒíƒœ**
   - ëŒ€ê¸° ì¤‘ì¸ ë©”ëª¨ ìˆ˜
   - ë™ê¸°í™” ì¤‘ì¸ ë©”ëª¨ ìˆ˜
   - ë™ê¸°í™” ì™„ë£Œ/ì‹¤íŒ¨ í†µê³„
   - ë™ê¸°í™” ì‹œê°„

3. **ì—ëŸ¬ ì¶”ì **
   - ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬
   - ì„œë²„ ì—ëŸ¬ (4xx, 5xx)
   - ë™ê¸°í™” ì‹¤íŒ¨ ì›ì¸
   - ì¬ì‹œë„ íšŸìˆ˜

4. **ì„±ëŠ¥ ë©”íŠ¸ë¦­**
   - ë™ê¸°í™” ì†Œìš” ì‹œê°„
   - API ì‘ë‹µ ì‹œê°„
   - IndexedDB ì‘ì—… ì‹œê°„

---

#### ëª¨ë‹ˆí„°ë§ ë°©ë²• 1: ë¸Œë¼ìš°ì € DevTools (ì¶”ì²œ, ì¶”ê°€ ì„¤ì¹˜ ë¶ˆí•„ìš”) â­

**ì¥ì :**
- âœ… ì¶”ê°€ ì†Œí”„íŠ¸ì›¨ì–´ ì„¤ì¹˜ ë¶ˆí•„ìš”
- âœ… ë¸Œë¼ìš°ì €ì— ê¸°ë³¸ ë‚´ì¥
- âœ… ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥
- âœ… ë¬´ë£Œ

**ì‚¬ìš© ë°©ë²•:**

##### 1. Network ìƒíƒœ ëª¨ë‹ˆí„°ë§

```
1. F12 â†’ Network íƒ­ ì—´ê¸°
2. ìƒíƒœ í‘œì‹œ í™•ì¸:
   - Online/Offline ë²„íŠ¼
   - Throttling ì„¤ì •
3. ìš”ì²­/ì‘ë‹µ ì‹¤ì‹œê°„ í™•ì¸:
   - ì„±ê³µí•œ ìš”ì²­: ì´ˆë¡ìƒ‰ (200)
   - ì‹¤íŒ¨í•œ ìš”ì²­: ë¹¨ê°„ìƒ‰ (4xx, 5xx)
   - ì·¨ì†Œëœ ìš”ì²­: íšŒìƒ‰
```

**ëª¨ë‹ˆí„°ë§ í•­ëª©:**
- API í˜¸ì¶œ íšŸìˆ˜
- ì„±ê³µ/ì‹¤íŒ¨ ë¹„ìœ¨
- ì‘ë‹µ ì‹œê°„
- ìš”ì²­ í¬ê¸°

##### 2. Application íƒ­ - IndexedDB ëª¨ë‹ˆí„°ë§

```
1. F12 â†’ Application íƒ­
2. Storage â†’ IndexedDB â†’ reading-tracker
3. í…Œì´ë¸” ì„ íƒ:
   - offline_memos: ë™ê¸°í™” ìƒíƒœ í™•ì¸
   - sync_queue: ë™ê¸°í™” í ìƒíƒœ í™•ì¸
4. ì‹¤ì‹œê°„ ë°ì´í„° í™•ì¸:
   - ë°ì´í„° ì¶”ê°€/ìˆ˜ì • ì‹œ ìë™ ìƒˆë¡œê³ ì¹¨
   - í•„í„°ë§ ë° ê²€ìƒ‰ ê°€ëŠ¥
```

**ëª¨ë‹ˆí„°ë§ í•­ëª©:**
- `syncStatus`ë³„ ë©”ëª¨ ê°œìˆ˜
- `serverId` ë§¤í•‘ ìƒíƒœ
- í í•­ëª© ìƒíƒœ ë¶„í¬

##### 3. Console íƒ­ - ë¡œê·¸ ëª¨ë‹ˆí„°ë§

```javascript
// í•„í„°ë§ ì˜µì…˜ ì‚¬ìš©:
// - All levels: ëª¨ë“  ë¡œê·¸
// - Errors: ì—ëŸ¬ë§Œ
// - Warnings: ê²½ê³ ë§Œ
// - Info: ì •ë³´ë§Œ

// ë¡œê·¸ ë ˆë²¨ë³„ í™•ì¸:
console.error('âŒ [Error]', ...);     // ë¹¨ê°„ìƒ‰
console.warn('âš ï¸ [Warning]', ...);   // ë…¸ë€ìƒ‰
console.log('â„¹ï¸ [Info]', ...);        // ê¸°ë³¸ìƒ‰
```

**ëª¨ë‹ˆí„°ë§ í•­ëª©:**
- ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ë³€ê²½ ë¡œê·¸
- ë™ê¸°í™” ì§„í–‰ ìƒí™©
- ì—ëŸ¬ ë©”ì‹œì§€
- ì¬ì‹œë„ ì•Œë¦¼

##### 4. Performance íƒ­ - ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

```
1. F12 â†’ Performance íƒ­
2. Record ë²„íŠ¼ í´ë¦­
3. ë™ê¸°í™” ì‘ì—… ìˆ˜í–‰
4. Stop ë²„íŠ¼ í´ë¦­
5. ì„±ëŠ¥ ë¶„ì„:
   - í•¨ìˆ˜ ì‹¤í–‰ ì‹œê°„
   - ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
   - ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì‹œê°„
```

---

#### ëª¨ë‹ˆí„°ë§ ì²´í¬ë¦¬ìŠ¤íŠ¸

**ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ í™•ì¸ í•­ëª©:**

- [ ] ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ì‹¤ì‹œê°„ í‘œì‹œ
- [ ] ë™ê¸°í™” í†µê³„ (ëŒ€ê¸°/ì§„í–‰/ì™„ë£Œ/ì‹¤íŒ¨)
- [ ] ì—ëŸ¬ ë°œìƒ ì‹œ ì¦‰ì‹œ ì•Œë¦¼
- [ ] ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ì•Œë¦¼
- [ ] ë™ê¸°í™” ì§„í–‰ ìƒí™© í‘œì‹œ
- [ ] ì—ëŸ¬ ë¡œê·¸ ì¡°íšŒ ê°€ëŠ¥
- [ ] ì„±ëŠ¥ ë©”íŠ¸ë¦­ í™•ì¸ ê°€ëŠ¥
- [ ] **UI í”¼ë“œë°± (í† ìŠ¤íŠ¸ ë©”ì‹œì§€)**: ì‚¬ìš©ìê°€ ë™ê¸°í™” ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ ìš°ì¸¡ í•˜ë‹¨ì— í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ

**ëª¨ë‹ˆí„°ë§ ë°©ë²•:**

1. **ë¸Œë¼ìš°ì € DevTools** (1ì°¨ í™•ì¸)
   - Network íƒ­: API ìš”ì²­/ì‘ë‹µ í™•ì¸
   - Application íƒ­: IndexedDB ë°ì´í„° í™•ì¸
   - Console íƒ­: ë¡œê·¸ ë©”ì‹œì§€ í™•ì¸
   - Performance íƒ­: ì„±ëŠ¥ ë¶„ì„

2. **ì„œë²„ Console ë¡œê·¸** (2ì°¨ í™•ì¸)
   - ì„œë²„ ì• í”Œë¦¬ì¼€ì´ì…˜ ì½˜ì†”ì—ì„œ ë¡œê·¸ í™•ì¸
   - ì—ëŸ¬ ë° ì˜ˆì™¸ ìƒí™© ì¶”ì 

3. **DB ë°ì´í„° í™•ì¸** (3ì°¨ í™•ì¸)
   - ì„œë²„ DBì—ì„œ ì‹¤ì œ ì €ì¥ëœ ë°ì´í„° í™•ì¸
   - ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦

4. **UI í”¼ë“œë°± (í† ìŠ¤íŠ¸ ë©”ì‹œì§€)** (ì‚¬ìš©ì ëŒ€ìƒ)
   - Heartbeat ì„±ê³µ í›„, ëª¨ë“  ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì‘ì—…ì´ ì™„ë£Œëœ ì§í›„
   - ìš°ì¸¡ í•˜ë‹¨ì— ê°„ê²°í•œ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
   - ì‚¬ìš©ìê°€ ì‹œìŠ¤í…œ ë‚´ë¶€ ê³¼ì •ì„ ì•Œ í•„ìš” ì—†ì´ ê²°ê³¼ë§Œ í™•ì¸

---

### 14. ë””ë²„ê¹… íŒ

#### ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§

1. **ì½˜ì†” ë¡œê·¸ í™œì„±í™”**
   ```javascript
   // ê°œë°œ ëª¨ë“œì—ì„œ ìƒì„¸ ë¡œê·¸
   console.log('ğŸ” [OfflineMemo]', ...args);
   console.log('ğŸ”„ [SyncQueue]', ...args);
   console.log('ğŸŒ [Network]', ...args);
   ```

2. **IndexedDB ë³€ê²½ ê°ì§€**
   ```
   Application íƒ­ì—ì„œ IndexedDB í…Œì´ë¸” ì„ íƒ
   â†’ ë°ì´í„° ë³€ê²½ ì‹œ ìë™ ìƒˆë¡œê³ ì¹¨ í™•ì¸
   ```

3. **Network íƒ­ í•„í„°ë§**
   ```
   Network íƒ­ â†’ Filter: "memos"
   â†’ ë©”ëª¨ ê´€ë ¨ ìš”ì²­ë§Œ í™•ì¸
   ```

#### ë””ë²„ê¹…

1. **ë™ê¸°í™” ì‹¤íŒ¨ ì‹œ**
   - ì½˜ì†” ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸
   - Network íƒ­ì—ì„œ ìš”ì²­/ì‘ë‹µ í™•ì¸
   - ì„œë²„ ë¡œê·¸ í™•ì¸

2. **ë°ì´í„° ë¶ˆì¼ì¹˜ ì‹œ**
   - IndexedDB ë°ì´í„° í™•ì¸
   - ì„œë²„ ë°ì´í„° í™•ì¸
   - `localId`ì™€ `serverId` ë§¤í•‘ í™•ì¸

3. **ì„±ëŠ¥ ì´ìŠˆ ì‹œ**
   - Performance íƒ­ì—ì„œ í”„ë¡œíŒŒì¼ë§
   - ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
   - IndexedDB ì¿¼ë¦¬ ì„±ëŠ¥ í™•ì¸

---

## ì¶”ê°€ ê³ ë ¤ì‚¬í•­

### 1. ë°ì´í„° ì •ë¦¬ (í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ ì ìš©) â­

**ì „ëµ**: í•˜ì´ë¸Œë¦¬ë“œ ë°ì´í„° ì •ë¦¬ ì „ëµì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

**ì •ë¦¬ ê·œì¹™**:
1. **ìµœê·¼ 7ì¼ ë©”ëª¨**: IndexedDBì— ë³´ê´€ (ì˜¤í”„ë¼ì¸ ì¡°íšŒ ì§€ì›)
2. **7ì¼ ì´ìƒ ëœ ë©”ëª¨**: ë™ê¸°í™” ì™„ë£Œ í›„ ì¦‰ì‹œ ì‚­ì œ
3. **30ì¼ ì´ìƒ ëœ ë™ê¸°í™” ì™„ë£Œ ë©”ëª¨**: ì£¼ê¸°ì  ì •ë¦¬ ì‘ì—…ìœ¼ë¡œ ì‚­ì œ
4. **ë™ê¸°í™” ëŒ€ê¸°/ì‹¤íŒ¨ ë©”ëª¨**: ì¬ì‹œë„ë¥¼ ìœ„í•´ ìœ ì§€

**ì£¼ê¸°ì  ì •ë¦¬ ì‘ì—…**:
```javascript
// ì•± ì‹œì‘ ì‹œ ë˜ëŠ” ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰
async function startPeriodicCleanup() {
    // 24ì‹œê°„ë§ˆë‹¤ ì •ë¦¬ ì‘ì—… ì‹¤í–‰
    setInterval(async () => {
        await offlineMemoService.periodicCleanup();
    }, 24 * 60 * 60 * 1000);
    
    // ì´ˆê¸° ì‹¤í–‰
    await offlineMemoService.periodicCleanup();
}
```

**ì¥ì **:
- âœ… ìµœê·¼ ë©”ëª¨ëŠ” ì˜¤í”„ë¼ì¸ì—ì„œë„ ì¡°íšŒ ê°€ëŠ¥
- âœ… ìš©ëŸ‰ ìë™ ê´€ë¦¬ (ì˜¤ë˜ëœ ë©”ëª¨ ì‚­ì œ)
- âœ… ì„±ëŠ¥ ìœ ì§€ (IndexedDB í¬ê¸° ì œí•œ)

### 2. ìš©ëŸ‰ ê´€ë¦¬

- IndexedDB ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
- ì˜¤ë˜ëœ ë©”ëª¨ ì‚­ì œ ì •ì±… (ì„ íƒì‚¬í•­)

### 3. ë³´ì•ˆ

- ë¡œì»¬ ì €ì¥ì†Œ ë°ì´í„° ì•”í˜¸í™” (ì„ íƒì‚¬í•­)
- ë¯¼ê°í•œ ì •ë³´ ì €ì¥ ì‹œ ê³ ë ¤

### 4. í™•ì¥ì„±

- ë©”ëª¨ ìˆ˜ì •/ì‚­ì œ ì˜¤í”„ë¼ì¸ ì§€ì› êµ¬í˜„ ì™„ë£Œ
- ë‹¤ë¥¸ ê¸°ëŠ¥ì—ë„ ì˜¤í”„ë¼ì¸ ì§€ì› í™•ì¥ ê°€ëŠ¥

---

## ì°¸ê³  ìë£Œ

### ê´€ë ¨ ë¬¸ì„œ

- [Offline-First ì•„í‚¤í…ì²˜ ì„¤ê³„ ë° ì „ëµ](./OFFLINE_FIRST.md): Service Worker ì‚¬ìš© ê²°ì • ë° ë°ì´í„° ì •ë¦¬ ì „ëµ

### ì™¸ë¶€ ìë£Œ

- [IndexedDB API](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API)
- [Service Worker API](https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API)
- [Background Sync API](https://developer.mozilla.org/en-US/docs/Web/API/Background_Sync_API)
- [Offline-First Architecture](https://offlinefirst.org/)
- [Progressive Web Apps](https://web.dev/progressive-web-apps/)
- [Network Information API](https://developer.mozilla.org/en-US/docs/Web/API/Network_Information_API)

---

## ë‹¤ìŒ ë‹¨ê³„

1. Service Worker ë“±ë¡ ë° ì„¤ì¹˜
2. IndexedDB ìŠ¤í‚¤ë§ˆ êµ¬í˜„
3. ì˜¤í”„ë¼ì¸ ë©”ëª¨ ì‘ì„± ê¸°ëŠ¥ êµ¬í˜„
4. ë™ê¸°í™” í êµ¬í˜„
5. Background Sync êµ¬í˜„ (í˜ì´ì§€ ì¢…ë£Œ í›„ ë™ê¸°í™”)
6. ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ê°ì§€ ë° ìë™ ë™ê¸°í™”
7. UI í†µí•© ë° í…ŒìŠ¤íŠ¸

